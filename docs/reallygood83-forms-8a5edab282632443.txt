Directory structure:
â””â”€â”€ reallygood83-forms/
    â”œâ”€â”€ README.md
    â”œâ”€â”€ components.json
    â”œâ”€â”€ eslint.config.mjs
    â”œâ”€â”€ firestore.rules
    â”œâ”€â”€ GOOGLE_OAUTH_SETUP.md
    â”œâ”€â”€ LICENSE
    â”œâ”€â”€ next.config.ts
    â”œâ”€â”€ package.json
    â”œâ”€â”€ postcss.config.mjs
    â”œâ”€â”€ tailwind.config.ts
    â”œâ”€â”€ tsconfig.json
    â”œâ”€â”€ vercel.json
    â”œâ”€â”€ VERCEL_DEPLOYMENT_FIX.md
    â”œâ”€â”€ .env.example
    â”œâ”€â”€ docs/
    â”‚   â”œâ”€â”€ OAUTH_SCOPE_JUSTIFICATION.md
    â”‚   â”œâ”€â”€ OAUTH_VERIFICATION_MANUAL_GUIDE.md
    â”‚   â””â”€â”€ ì„œë¹„ìŠ¤_ê³ ë„í™”_ì œì•ˆì„œ_2025-11-03.md
    â”œâ”€â”€ scripts/
    â”‚   â””â”€â”€ generate-og-image.mjs
    â””â”€â”€ src/
        â”œâ”€â”€ app/
        â”‚   â”œâ”€â”€ globals.css
        â”‚   â”œâ”€â”€ kakao-meta.tsx
        â”‚   â”œâ”€â”€ layout.tsx
        â”‚   â”œâ”€â”€ opengraph-image.tsx
        â”‚   â”œâ”€â”€ page.tsx
        â”‚   â”œâ”€â”€ api/
        â”‚   â”‚   â”œâ”€â”€ ai/
        â”‚   â”‚   â”‚   â””â”€â”€ preview/
        â”‚   â”‚   â”‚       â””â”€â”€ route.ts
        â”‚   â”‚   â”œâ”€â”€ auth/
        â”‚   â”‚   â”‚   â”œâ”€â”€ [...nextauth]/
        â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
        â”‚   â”‚   â”‚   â””â”€â”€ firebase-token/
        â”‚   â”‚   â”‚       â””â”€â”€ route.ts
        â”‚   â”‚   â”œâ”€â”€ forms/
        â”‚   â”‚   â”‚   â””â”€â”€ create/
        â”‚   â”‚   â”‚       â””â”€â”€ route.ts
        â”‚   â”‚   â”œâ”€â”€ generate/
        â”‚   â”‚   â”‚   â””â”€â”€ route.ts
        â”‚   â”‚   â””â”€â”€ secrets/
        â”‚   â”‚       â”œâ”€â”€ get/
        â”‚   â”‚       â”‚   â””â”€â”€ route.ts
        â”‚   â”‚       â””â”€â”€ set/
        â”‚   â”‚           â””â”€â”€ route.ts
        â”‚   â”œâ”€â”€ create/
        â”‚   â”‚   â””â”€â”€ page.tsx
        â”‚   â”œâ”€â”€ dashboard/
        â”‚   â”‚   â””â”€â”€ page.tsx
        â”‚   â”œâ”€â”€ privacy/
        â”‚   â”‚   â”œâ”€â”€ page.tsx
        â”‚   â”‚   â””â”€â”€ en/
        â”‚   â”‚       â””â”€â”€ page.tsx
        â”‚   â””â”€â”€ terms/
        â”‚       â””â”€â”€ page.tsx
        â”œâ”€â”€ components/
        â”‚   â”œâ”€â”€ GeminiKeyInput.tsx
        â”‚   â”œâ”€â”€ login-button.tsx
        â”‚   â”œâ”€â”€ Navbar.tsx
        â”‚   â”œâ”€â”€ session-provider.tsx
        â”‚   â””â”€â”€ ui/
        â”‚       â”œâ”€â”€ button.tsx
        â”‚       â”œâ”€â”€ card.tsx
        â”‚       â”œâ”€â”€ checkbox.tsx
        â”‚       â”œâ”€â”€ input.tsx
        â”‚       â”œâ”€â”€ label.tsx
        â”‚       â”œâ”€â”€ navigation-menu.tsx
        â”‚       â”œâ”€â”€ select.tsx
        â”‚       â”œâ”€â”€ sheet.tsx
        â”‚       â”œâ”€â”€ tabs.tsx
        â”‚       â””â”€â”€ textarea.tsx
        â”œâ”€â”€ lib/
        â”‚   â”œâ”€â”€ auth.ts
        â”‚   â”œâ”€â”€ crypto.ts
        â”‚   â”œâ”€â”€ firebase-admin.ts
        â”‚   â”œâ”€â”€ firebase-client.ts
        â”‚   â”œâ”€â”€ form-spec.ts
        â”‚   â”œâ”€â”€ google-forms-api.ts
        â”‚   â”œâ”€â”€ google-forms.ts
        â”‚   â”œâ”€â”€ google-tokens.ts
        â”‚   â””â”€â”€ utils.ts
        â””â”€â”€ types/
            â””â”€â”€ next-auth.d.ts

================================================
FILE: README.md
================================================
[Binary file]


================================================
FILE: components.json
================================================
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "src/app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "registries": {}
}



================================================
FILE: eslint.config.mjs
================================================
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;



================================================
FILE: firestore.rules
================================================
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ========================================
    // í—¬í¼ í•¨ìˆ˜
    // ========================================

    // ì‚¬ìš©ìê°€ ì¸ì¦ë˜ì—ˆëŠ”ì§€ í™•ì¸
    function isSignedIn() {
      return request.auth != null;
    }

    // ìš”ì²­í•œ ì‚¬ìš©ìê°€ í•´ë‹¹ ì´ë©”ì¼ì˜ ì†Œìœ ìì¸ì§€ í™•ì¸
    function isOwner(email) {
      return isSignedIn() && request.auth.token.email == email;
    }

    // ========================================
    // users ì»¬ë ‰ì…˜ ê·œì¹™
    // ========================================

    match /users/{email} {
      // users ë¬¸ì„œ ìì²´ëŠ” ì½ê¸°/ì“°ê¸° ë¶ˆê°€ (í•˜ìœ„ ì»¬ë ‰ì…˜ë§Œ ì‚¬ìš©)
      allow read, write: if false;

      // ========================================
      // auth ì„œë¸Œì»¬ë ‰ì…˜ (Google OAuth í† í°)
      // ========================================
      match /auth/{provider} {
        // ìì‹ ì˜ ì¸ì¦ í† í°ë§Œ ì½ê¸° ê°€ëŠ¥
        allow read: if isOwner(email);

        // ì“°ê¸°ëŠ” ì„œë²„ì‚¬ì´ë“œ(Admin SDK)ì—ì„œë§Œ ê°€ëŠ¥
        // í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ì ˆëŒ€ ì“¸ ìˆ˜ ì—†ìŒ
        allow write: if false;
      }

      // ========================================
      // secrets ì„œë¸Œì»¬ë ‰ì…˜ (Gemini API í‚¤ ë“±)
      // ========================================
      match /secrets/{secretType} {
        // ìì‹ ì˜ ì‹œí¬ë¦¿ë§Œ ì½ê¸°/ì“°ê¸° ê°€ëŠ¥
        allow read, write: if isOwner(email);

        // ë°ì´í„° ê²€ì¦: í•„ìˆ˜ í•„ë“œ í™•ì¸
        allow create, update: if isOwner(email)
          && request.resource.data.keys().hasAll(['ciphertext', 'iv', 'tag', 'createdAt'])
          && request.resource.data.ciphertext is string
          && request.resource.data.iv is string
          && request.resource.data.tag is string
          && request.resource.data.createdAt is number;
      }
    }

    // ========================================
    // ê¸°ë³¸ ê·œì¹™: ëª¨ë“  ë‹¤ë¥¸ ì ‘ê·¼ ê±°ë¶€
    // ========================================
    match /{document=**} {
      allow read, write: if false;
    }
  }
}



================================================
FILE: GOOGLE_OAUTH_SETUP.md
================================================
[Binary file]


================================================
FILE: LICENSE
================================================
[Binary file]


================================================
FILE: next.config.ts
================================================
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;



================================================
FILE: package.json
================================================
{
  "name": "teaboard-forms",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@google/generative-ai": "^0.24.1",
    "@radix-ui/react-checkbox": "^1.3.3",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-navigation-menu": "^1.2.14",
    "@radix-ui/react-select": "^2.2.6",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-tabs": "^1.1.13",
    "@vercel/og": "^0.8.5",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "firebase": "^12.5.0",
    "firebase-admin": "^13.5.0",
    "googleapis": "^164.1.0",
    "lucide-react": "^0.552.0",
    "next": "15.1.3",
    "next-auth": "^4.24.13",
    "react": "18.3.1",
    "react-dom": "18.3.1",
    "tailwind-merge": "^3.3.1",
    "tailwindcss-animate": "^1.0.7"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "eslint": "^9",
    "eslint-config-next": "15.1.3",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}



================================================
FILE: postcss.config.mjs
================================================
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;



================================================
FILE: tailwind.config.ts
================================================
import type { Config } from "tailwindcss";

export default {
  content: [
    "./src/app/**/*.{ts,tsx}",
    "./src/components/**/*.{ts,tsx}",
    "./src/lib/**/*.{ts,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
} satisfies Config;


================================================
FILE: tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": [
        "./src/*"
      ]
    }
  },
  "include": [
    "next-env.d.ts",
    "src/types/next-auth.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": [
    "node_modules"
  ]
}



================================================
FILE: vercel.json
================================================
{
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "nextjs",
  "outputDirectory": ".next",
  "regions": ["icn1"]
}



================================================
FILE: VERCEL_DEPLOYMENT_FIX.md
================================================
# ğŸ”§ Vercel 404 ì—ëŸ¬ í•´ê²° ê°€ì´ë“œ

## ğŸ“Š Root Cause Analysis

### ë¬¸ì œ ì¦ìƒ
- Vercel ë°°í¬ í›„ `404: NOT_FOUND` ì—ëŸ¬ ë°œìƒ
- í™˜ê²½ë³€ìˆ˜ëŠ” 16ê°œ ëª¨ë‘ ì…ë ¥ë˜ì–´ ìˆìŒ
- ë¡œì»¬ ë¹Œë“œëŠ” ì •ìƒ ì‘ë™

### Root Cause (ê·¼ë³¸ ì›ì¸)
**Firebase Admin SDK Private Keyì˜ multiline ì²˜ë¦¬ ì˜¤ë¥˜**

Vercel í™˜ê²½ë³€ìˆ˜ ì…ë ¥ ì‹œ `FIREBASE_ADMIN_PRIVATE_KEY`ì˜ ê°œí–‰ ë¬¸ì(`\n`)ê°€ ì œëŒ€ë¡œ íŒŒì‹±ë˜ì§€ ì•Šì•„ Firebase Admin SDK ì´ˆê¸°í™” ì‹¤íŒ¨ â†’ ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ ì‹¤íŒ¨ â†’ 404 ì—ëŸ¬

---

## âœ… í•´ê²° ë°©ë²•

### 1ë‹¨ê³„: Firebase Admin Private Key ì˜¬ë°”ë¥¸ ì…ë ¥ ë°©ë²•

#### âš ï¸ ì˜ëª»ëœ ë°©ë²• (Vercelì—ì„œ ì‘ë™í•˜ì§€ ì•ŠìŒ)
```
"-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC8PGoRvtK9TQtw\novRlSNPI79jWiGQ3ADUKWkgkYXUymYk0dIcqJF3IurXt/sM9SRLIy8Sf1VAGgo5V\n...\n-----END PRIVATE KEY-----\n"
```

#### âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (Vercel ì „ìš©)

**Option 1: ì‹¤ì œ ê°œí–‰ ë¬¸ì ì‚¬ìš© (ê¶Œì¥)**

Vercel Dashboardì—ì„œ í™˜ê²½ë³€ìˆ˜ ì…ë ¥ ì‹œ:
1. Value í•„ë“œì— **í°ë”°ì˜´í‘œ ì—†ì´** ë‹¤ìŒê³¼ ê°™ì´ ì…ë ¥:
```
-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC8PGoRvtK9TQtw
ovRlSNPI79jWiGQ3ADUKWkgkYXUymYk0dIcqJF3IurXt/sM9SRLIy8Sf1VAGgo5V
mtmcL9B4vvGzjb/G5ztJGn8LF58DHAxnoSZwfyxz9JeQnn1p4V2MiqwnLFf4ly/b
5rgRmBC5V2BVlgmki2O+lbwH561978uoxfLSvs9+zBMtlYe9TX8+nNjPE2CVeOvg
S8Mao4tT38zeGudMl7m57rCLY/rdS1hDg7nPo8TUeQdA4DDOGxU2wrM0qY1okiwD
aQh5uk8JqHd9nYIcSK0EmVLabHbAdDh4QAaawsWgDIqHt4cAQDQZG/prX7qBeq/3
OFTGCdj1AgMBAAECggEAIzx77o52DJGbjp4yebNEUdz0DlTBzbnwM9vqnUTRF4O+
N1+I3c6o76Zj4AVMrvA63/Ok/vaDYHSYCFZQXfhlYfT8ccwbFjS62FhpZ74oOgDK
Iav88hocTCiBJsVEXMmfJWvgBgU7AoHqp5Ns6X45wzgkBGFttKuTJF4LML+hrm0e
tENQTpeOAfcb72kunuBmXCTxGha67CfDBKY2MTaQHSm560chVUTHJIIdAmqihYhj
2aA+gNtqPZQG7YyEtEp/N9sh0/PY8epl6vO9HNdB1v5XizBgj+ZTsu7bgDVGIINf
ym5L9y/DTEdYGCOpUoTIxOylNrXWnN3rj6Zzt+ixgQKBgQDohnqDRP1C5wOGfowk
szgae0TvU9WGcvVYAhcyKsjItS4SobtILBLsEPi2q3y1+03ncv4GBXgtVkC0qni+
sf4dLKcqV8OCxu7YmpzldqjEXUgZCxWDjPT4CR2O/+DV5sqp4UFH63naPNODHpzZ
NHCrLG8LUU/gfZR/7lmFOm8NeQKBgQDPPUvst75yxOq7dRXyxajGPmQ9TgE7e6/A
A72lkNnQe0PRVfoG3vOO8qNPVgUMSYO2uDsUAbiBr9Y8WhFCLn44gxa94oofi52n
RImG6ZpKsGERNNlhzIh3xe0mHc4wISoCfakOMyv8v5FqP7Vmd8v15k1mj0W+v3F9
IJ335SiUXQKBgQDATwhgLNyxSlJ2F49cgwTxkeXPcix0x/r10LTSfuQUaxQxwKUd
6aW0q8ynd2jrMW6a71X8MOXVyTI2uY6nWJpsEpQmxvMh49mCN01v0hV+Yg/Q9oPS
iu/He/KAZEvVXM1cdroA+1WKEyhzlwvt8BsG1vb4C0Xeyr3YmI5dS5ixMQKBgGZ/
rLOx1XIyTt7UdDyU4nralP11PUrMTAquTvg6gmCI9uvsmDMZxmDnRTqSEwEWwxx2
VlH43+bUryM+cNbI5AjTXUYha6tahGkcjuC5XWSfhALcnr+uR7jlnfuCNl67qGl+
+URaruDdZvCj/fZmPeyrMZEOP7KuQVVf8oGPR9jJAoGAI4SmRoc9ZoVl82XHRPwO
dZfN+hKnk3BRoX5fHSFN6GcQMSGhIo2h3tl228T76Q7uG/h8q5owBhmcp1jB/PUw
n4iXKf4EcjEITA9bx1XyPuVXk0zBgIgniI4m52kdjKH1ayS/iceymUP3SPlONYKK
v9mbMK7kLbAlwAZ+iLYzyYU=
-----END PRIVATE KEY-----
```

2. **ì¤‘ìš”**: ê° ì¤„ì´ ì‹¤ì œë¡œ ê°œí–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤ (Enter í‚¤ë¡œ ì¤„ë°”ê¿ˆ)
3. í°ë”°ì˜´í‘œ(`"`)ë¥¼ **ì ˆëŒ€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”**

**Option 2: Base64 ì¸ì½”ë”© ì‚¬ìš©**

Private keyë¥¼ Base64ë¡œ ì¸ì½”ë”©í•˜ì—¬ í•œ ì¤„ë¡œ ë§Œë“¤ê¸°:
```bash
# ë¡œì»¬ì—ì„œ ì‹¤í–‰
echo "-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC8PGoRvtK9TQtw
...
-----END PRIVATE KEY-----" | base64
```

ê·¸ ë‹¤ìŒ ì„œë²„ ì½”ë“œì—ì„œ ë””ì½”ë”©:
```typescript
const privateKey = Buffer.from(process.env.FIREBASE_ADMIN_PRIVATE_KEY_BASE64 || '', 'base64').toString('utf-8');
```

---

### 2ë‹¨ê³„: Vercel í™˜ê²½ë³€ìˆ˜ ì¬ì„¤ì •

1. **Vercel Dashboard ì ‘ì†**: https://vercel.com/dashboard
2. **í”„ë¡œì íŠ¸ ì„ íƒ**: forms4labs
3. **Settings â†’ Environment Variables**
4. **`FIREBASE_ADMIN_PRIVATE_KEY` ì‚­ì œ í›„ ì¬ì…ë ¥**
   - Option 1 ë°©ì‹ ì‚¬ìš© (ì‹¤ì œ ê°œí–‰ ë¬¸ì)
   - í°ë”°ì˜´í‘œ ì—†ì´ ì…ë ¥
   - ê° ì¤„ì´ ì‹¤ì œë¡œ Enter í‚¤ë¡œ ê°œí–‰ë˜ì–´ì•¼ í•¨

---

### 3ë‹¨ê³„: ì¬ë°°í¬ íŠ¸ë¦¬ê±°

í™˜ê²½ë³€ìˆ˜ ë³€ê²½ í›„:
1. **Deployments íƒ­**ìœ¼ë¡œ ì´ë™
2. **ìµœì‹  ë°°í¬**ì˜ `...` ë©”ë‰´ í´ë¦­
3. **Redeploy** ì„ íƒ
4. **Use existing Build Cache ì²´í¬ í•´ì œ**
5. **Redeploy** í´ë¦­

---

## ğŸ” ê²€ì¦ ë°©ë²•

### Vercel ë¹Œë“œ ë¡œê·¸ í™•ì¸
1. Deployments â†’ ìµœì‹  ë°°í¬ í´ë¦­
2. **Building** ë‹¨ê³„ ë¡œê·¸ í™•ì¸
3. ì—ëŸ¬ ë©”ì‹œì§€ ê²€ìƒ‰:
   - `Firebase Admin SDK initialization failed`
   - `Invalid PEM formatted message`
   - `error:0909006C:PEM routines`

### ì •ìƒ ì‘ë™ í™•ì¸
- https://forms.teaboard.link ì ‘ì†
- í™ˆí˜ì´ì§€ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë¨
- Google ë¡œê·¸ì¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- í€´ì¦ˆ/ì„¤ë¬¸ ìƒì„± í˜ì´ì§€ ì ‘ì†

---

## ğŸ“ ì¶”ê°€ ë””ë²„ê¹… íŒ

### Firebase Admin SDK ì´ˆê¸°í™” í™•ì¸
`src/lib/firebase-admin.ts` íŒŒì¼ì—ì„œ:
```typescript
console.log('FIREBASE_ADMIN_PRIVATE_KEY length:', process.env.FIREBASE_ADMIN_PRIVATE_KEY?.length);
console.log('FIREBASE_ADMIN_PRIVATE_KEY starts with:', process.env.FIREBASE_ADMIN_PRIVATE_KEY?.substring(0, 50));
```

### í™˜ê²½ë³€ìˆ˜ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
```typescript
console.log('Required env vars:', {
  hasPrivateKey: !!process.env.FIREBASE_ADMIN_PRIVATE_KEY,
  hasClientEmail: !!process.env.FIREBASE_ADMIN_CLIENT_EMAIL,
  hasProjectId: !!process.env.FIREBASE_ADMIN_PROJECT_ID,
});
```

---

## ğŸ¯ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `FIREBASE_ADMIN_PRIVATE_KEY` í™˜ê²½ë³€ìˆ˜ë¥¼ ì‹¤ì œ ê°œí–‰ ë¬¸ìë¡œ ì¬ì…ë ¥
- [ ] í°ë”°ì˜´í‘œ(`"`) ì—†ì´ ì…ë ¥í–ˆëŠ”ì§€ í™•ì¸
- [ ] ê° ì¤„ì´ Enter í‚¤ë¡œ ê°œí–‰ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
- [ ] Vercelì—ì„œ ì¬ë°°í¬ (Build Cache ë¹„í™œì„±í™”)
- [ ] ë¹Œë“œ ë¡œê·¸ì—ì„œ Firebase ê´€ë ¨ ì—ëŸ¬ ì—†ëŠ”ì§€ í™•ì¸
- [ ] https://forms.teaboard.link ì •ìƒ ì‘ë™ í™•ì¸

---

**ì‘ì„±ì¼**: 2025-11-03
**í”„ë¡œì íŠ¸**: forms4labs
**ë„ë©”ì¸**: https://forms.teaboard.link



================================================
FILE: .env.example
================================================
# ==============================================
# Firebase Client (Public - ë¸Œë¼ìš°ì €ì—ì„œ ì‚¬ìš©)
# ==============================================
NEXT_PUBLIC_FIREBASE_API_KEY=your_api_key_here
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_project_id.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your_project_id.firebasestorage.app
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your_messaging_sender_id
NEXT_PUBLIC_FIREBASE_APP_ID=your_app_id
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=your_measurement_id

# ==============================================
# Firebase Admin SDK (Private - ì„œë²„ì‚¬ì´ë“œ ì „ìš©)
# ==============================================
# Firebase Console > Project Settings > Service Accounts > Generate New Private Key
FIREBASE_ADMIN_PROJECT_ID=your_project_id
FIREBASE_ADMIN_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your_project_id.iam.gserviceaccount.com
# Private KeyëŠ” JSON íŒŒì¼ì—ì„œ private_key í•„ë“œ ê°’ì„ ë³µì‚¬ (ë”°ì˜´í‘œ í¬í•¨)
FIREBASE_ADMIN_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYour_Private_Key_Here\n-----END PRIVATE KEY-----\n"

# ==============================================
# Google OAuth (NextAuth.js)
# ==============================================
GOOGLE_CLIENT_ID=your_client_id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your_client_secret

# ==============================================
# NextAuth.js
# ==============================================
# Production URL (Vercelì—ì„œëŠ” ìë™ ì„¤ì •ë¨)
NEXTAUTH_URL=https://forms.teaboard.link
# 32ì ì´ìƒì˜ ëœë¤ ë¬¸ìì—´ (openssl rand -base64 32 ëª…ë ¹ì–´ë¡œ ìƒì„± ê°€ëŠ¥)
NEXTAUTH_SECRET=your_nextauth_secret_key_here

# ==============================================
# Encryption (BYOK - Bring Your Own Key)
# ==============================================
# Gemini API í‚¤ ë“± ë¯¼ê°í•œ ì •ë³´ ì•”í˜¸í™”ì— ì‚¬ìš©
# 32ì ì´ìƒì˜ ëœë¤ ë¬¸ìì—´ (openssl rand -base64 32 ëª…ë ¹ì–´ë¡œ ìƒì„± ê°€ëŠ¥)
BYOK_ENCRYPTION_KEY=your_encryption_key_here

# ==============================================
# Application
# ==============================================
NEXT_PUBLIC_APP_URL=https://forms.teaboard.link



================================================
FILE: docs/OAUTH_SCOPE_JUSTIFICATION.md
================================================
# OAuth Scope Justification for Teaboard Forms

**Application Name**: Teaboard Forms
**Website**: https://forms.teaboard.link
**Submission Date**: November 7, 2025
**Contact**: usmjkim23@gmail.com

---

## Executive Summary

Teaboard Forms is an educational web application designed specifically for teachers to automatically generate Google Forms quizzes from text input. The application requires the `https://www.googleapis.com/auth/forms.body` scope to provide its core functionality: automated quiz creation that saves teachers valuable time and improves educational content quality.

---

## Scope Request Details

### Requested Scope
**`https://www.googleapis.com/auth/forms.body`** (Restricted Scope)

### Classification
- **Category**: Restricted (Sensitive)
- **API**: Google Forms API
- **Access Level**: Full form creation, reading, and editing capabilities

---

## 1. Purpose and Functionality

### Primary Use Case
Teaboard Forms enables teachers to:
1. Input educational content (text, questions, learning materials)
2. Automatically generate well-structured Google Forms quizzes
3. Edit and refine the generated forms through the application interface
4. Manage multiple quiz forms efficiently

### Technical Implementation
The application uses the `forms.body` scope to:
- **Create new Google Forms** with proper structure (title, description, sections)
- **Add questions** with multiple choice options, correct answers, and point values
- **Configure form settings** including quiz mode, shuffle options, and response validation
- **Update existing forms** when users want to refine or modify generated quizzes
- **Read form metadata** to display user's created forms in the application dashboard

### User Workflow
```
User Input (Text/Questions)
    â†“
AI Processing (Gemini API)
    â†“
Google Forms Creation (forms.body scope)
    â†“
User Reviews & Edits
    â†“
Final Quiz Published
```

---

## 2. User Benefits

### Time Savings
- **Manual Process**: 15-20 minutes to create a 10-question quiz manually
- **Automated Process**: 2-3 minutes with Teaboard Forms
- **Time Saved**: ~85% reduction in quiz creation time
- **Impact**: Teachers can create 5-7x more quizzes in the same time

### Quality Improvements
1. **Consistent Structure**: AI ensures properly formatted questions and options
2. **Error Reduction**: Automated process minimizes manual entry mistakes
3. **Best Practices**: Built-in quiz design principles (clear questions, balanced options)
4. **Accessibility**: Properly structured forms improve accessibility for all students

### Educational Impact
- **Focus on Content**: Teachers spend more time on educational content quality, not formatting
- **Rapid Iteration**: Easy to create multiple versions for different learning levels
- **Data-Driven**: Quick quiz generation enables more frequent student assessments
- **Student Engagement**: Well-designed quizzes improve student participation

### Cost Efficiency
- **Free Service**: No additional cost for teachers or schools
- **No Training Required**: Intuitive interface requires minimal learning curve
- **Cloud-Based**: No software installation or maintenance needed

---

## 3. Why Narrower Scope Is Insufficient

### Alternative Scopes Considered

#### Option 1: `drive.file` Only
**Why Insufficient**:
- âŒ Cannot create Google Forms (only creates generic Drive files)
- âŒ No access to Forms-specific features (questions, quiz settings, validation)
- âŒ Cannot structure content as interactive quizzes
- âŒ No quiz mode, grading, or answer validation capabilities

**Result**: Would require manual form creation, defeating the application's core purpose

#### Option 2: `forms.responses.readonly`
**Why Insufficient**:
- âŒ Read-only access to form responses only
- âŒ Cannot create or edit form questions
- âŒ No access to form structure or settings
- âŒ Does not support the creation workflow

**Result**: Only useful for viewing responses, not creating quizzes

#### Option 3: Limited Manual Process
**Why Insufficient**:
- âŒ Users would need to manually copy-paste generated questions
- âŒ Defeats automation purpose and time-saving benefits
- âŒ Increases error rates significantly
- âŒ Poor user experience and low adoption

**Result**: Application becomes a simple text generator without real value

### Why `forms.body` Is Required

The `forms.body` scope is the **minimum necessary** scope that provides:

1. **Form Creation**: Ability to create new Google Forms programmatically
2. **Question Management**: Add, edit, and structure questions with options
3. **Quiz Configuration**: Set quiz mode, point values, correct answers, and feedback
4. **Form Settings**: Configure shuffle options, response limits, and submission behavior
5. **Update Capability**: Allow users to refine generated quizzes through the app interface

**Critical Point**: Google Forms API provides no "create-only" or "limited-edit" scope. The `forms.body` scope is the **narrowest available scope** that enables our core functionality.

---

## 4. Data Handling and Privacy

### Data Access Scope
- **Only User-Created Forms**: Application accesses only forms created through Teaboard Forms
- **No Pre-Existing Forms**: Does not access or modify user's existing Google Forms
- **User-Initiated Only**: All form operations require explicit user action
- **No Background Access**: Application never accesses forms when user is not actively using the service

### Data Protection Measures
1. **Encryption in Transit**: TLS 1.3 for all data transmission
2. **Encryption at Rest**: AES-256 for stored metadata
3. **Access Control**: Firebase Security Rules limit data access to form owners only
4. **No Data Sharing**: Form content never shared with third parties
5. **Immediate Deletion**: User data deleted immediately upon account deletion

### Compliance
- âœ… **GDPR Compliant**: Full user rights (access, deletion, portability)
- âœ… **Korean Privacy Law**: Compliant with Personal Information Protection Act
- âœ… **COPPA**: Safe for educational use with students under 13
- âœ… **FERPA**: Appropriate for educational institutions

### Privacy Policy
Detailed privacy policy available at:
- **Korean**: https://forms.teaboard.link/privacy
- **English**: https://forms.teaboard.link/privacy/en

---

## 5. Security Measures

### OAuth Implementation
- **Standard OAuth 2.0**: Follows Google's OAuth best practices
- **Token Storage**: Secure token storage using Firebase Authentication
- **Token Refresh**: Automatic token refresh with proper error handling
- **Scope Minimization**: Requests only required scopes (no unnecessary permissions)

### Application Security
1. **Next.js 15**: Modern, secure web framework with built-in protections
2. **Vercel Hosting**: Enterprise-grade security and DDoS protection
3. **Firebase**: Google Cloud Platform infrastructure (ISO 27001, SOC 2 Type II)
4. **Regular Updates**: Automated security patches and dependency updates
5. **Security Monitoring**: Real-time monitoring via Vercel Analytics

### Audit Trail
- **Access Logging**: All API calls logged with timestamps
- **Anomaly Detection**: Automated detection of unusual access patterns
- **Incident Response**: 72-hour notification policy for security incidents
- **Annual Audit**: External security assessment every 12 months

---

## 6. User Consent and Control

### Transparent Consent
- **Clear OAuth Screen**: App name and permissions clearly displayed during authorization
- **Privacy Policy Link**: Prominently displayed on consent screen
- **Scope Explanation**: Each permission explained in user-friendly language

### User Controls
Users can:
1. **Revoke Access Anytime**: Via Google Account settings > Security > Third-party apps
2. **Delete All Data**: Complete data deletion through account deletion
3. **Export Data**: Request data export in JSON format
4. **View Access History**: See when and how the app accessed their data

### No Surprises Policy
- **No Background Sync**: App never accesses data without active user session
- **No Data Mining**: User content not used for analytics or AI training
- **No Cross-User Access**: Users only see their own forms
- **No Advertisements**: Free service with no advertising or data monetization

---

## 7. Educational Context and Target Audience

### Primary Users
- **K-12 Teachers**: Elementary through high school educators
- **University Instructors**: College and university faculty
- **Corporate Trainers**: Professional development and training specialists
- **Tutors**: Private tutors and supplemental education providers

### Use Cases
1. **Classroom Quizzes**: Quick comprehension checks during or after lessons
2. **Homework Assignments**: Take-home assessments with automated grading
3. **Formative Assessment**: Frequent low-stakes assessments to guide instruction
4. **Test Preparation**: Practice quizzes for standardized test preparation
5. **Training Evaluations**: Corporate training completion assessments

### Educational Impact
- **Increased Assessment Frequency**: Teachers create 5-7x more quizzes, improving learning outcomes
- **Differentiated Instruction**: Easy to create multiple versions for different skill levels
- **Immediate Feedback**: Quiz mode provides instant feedback to students
- **Data-Driven Decisions**: More frequent assessments enable better instructional decisions

---

## 8. Alternative Solutions Comparison

| Solution | Time Required | Cost | Features | Limitations |
|----------|--------------|------|----------|-------------|
| **Manual Google Forms** | 15-20 min/quiz | Free | Full control | Time-consuming, error-prone |
| **Google Forms Add-ons** | 10-15 min/quiz | $5-20/month | Limited automation | Still requires manual work |
| **Commercial Quiz Tools** | 5-10 min/quiz | $30-100/month | AI features | Expensive, not Google-integrated |
| **Teaboard Forms** | 2-3 min/quiz | Free | Full automation | Requires OAuth permission |

**Conclusion**: Teaboard Forms provides the fastest, most cost-effective solution while maintaining full Google ecosystem integration.

---

## 9. Compliance with Google Policies

### Google API Services User Data Policy
âœ… **Transparency**: Clear privacy policy and consent screen
âœ… **Limitation**: Only accesses user-created forms
âœ… **Security**: Industry-standard encryption and access controls
âœ… **No Unexpected Access**: All operations user-initiated
âœ… **Data Deletion**: Immediate deletion upon user request

### Limited Use Requirements
âœ… **Use Limitation**: Data used only for stated purpose (quiz creation)
âœ… **No Human Review**: No manual review of form content by staff
âœ… **No AI Training**: User content not used to train AI models
âœ… **No Sharing**: Data never shared with third parties
âœ… **No Advertising**: User data not used for advertising

### Restricted Scope Compliance
âœ… **Necessity**: Scope demonstrably necessary for core functionality
âœ… **Minimization**: Requests only minimum required scope
âœ… **User Benefit**: Clear, significant benefits to users
âœ… **Security**: Comprehensive security measures implemented
âœ… **Privacy**: Privacy policy compliant with all regulations

---

## 10. Technical Documentation

### API Endpoints Used
```
POST /forms - Create new Google Form
GET /forms/{formId} - Retrieve form metadata
PUT /forms/{formId} - Update form content
PATCH /forms/{formId} - Partial form updates
```

### Required Permissions
The `forms.body` scope enables:
- `forms.create` - Create new forms
- `forms.update` - Modify form questions and settings
- `forms.read` - Read form structure and metadata
- `forms.delete` - Remove user-created forms (optional)

### Data Flow
1. **User Input** â†’ Gemini AI (question generation)
2. **Generated Questions** â†’ Teaboard Backend (formatting)
3. **Formatted Data** â†’ Google Forms API (`forms.body` scope)
4. **Created Form** â†’ User's Google Drive (user ownership)
5. **Form Metadata** â†’ Firebase Database (for app dashboard)

**Note**: Form content stored in user's Google Drive, not Teaboard servers.

---

## 11. Support and Contact Information

### Application Support
- **Website**: https://forms.teaboard.link
- **Email**: usmjkim23@gmail.com
- **Live Chat**: https://open.kakao.com/o/gubGYQ7g (24/7 Korean support)
- **Documentation**: Available on website

### Privacy and Security Concerns
- **Data Protection Officer**: Moon-Jung Kim (usmjkim23@gmail.com)
- **Privacy Policy**: https://forms.teaboard.link/privacy
- **Security Issues**: Report to usmjkim23@gmail.com

### Developer Information
- **Developer**: Moon-Jung Kim
- **Organization**: Teaboard Forms / Anyang Bakdal Elementary School
- **Location**: South Korea
- **Experience**: Educational technology developer with focus on teacher productivity

---

## 12. Conclusion

### Summary of Justification

**Teaboard Forms requires the `forms.body` scope because:**

1. âœ… **Core Functionality**: Automated quiz creation is impossible without full form creation/editing capabilities
2. âœ… **No Alternative**: No narrower scope provides necessary functionality
3. âœ… **Significant Benefits**: Saves teachers 85% of time (15-20 min â†’ 2-3 min per quiz)
4. âœ… **Educational Impact**: Enables more frequent assessments, improving student learning outcomes
5. âœ… **Privacy-First**: Comprehensive data protection measures exceed industry standards
6. âœ… **User Control**: Users maintain full ownership and control of their forms
7. âœ… **Policy Compliant**: Fully compliant with Google API Services User Data Policy
8. âœ… **Transparent**: Clear privacy policy and user consent process

### Scope Usage Statement

**We commit to:**
- Using `forms.body` scope **exclusively** for creating and managing user-requested quiz forms
- **Never** accessing forms not created through Teaboard Forms
- **Never** accessing user data outside of active user sessions
- **Never** sharing form content with third parties
- **Immediately** deleting all user data upon account deletion request
- Maintaining **industry-leading** security and privacy standards
- Providing **full transparency** through detailed privacy policy and user controls

### Educational Mission

Teaboard Forms exists to empower teachers with AI-powered tools that save time and improve educational quality. The `forms.body` scope is essential to fulfilling this mission. We take our responsibility seriously and commit to maintaining the highest standards of security, privacy, and ethical use of user data.

---

**Prepared by**: Moon-Jung Kim, Developer and Data Protection Officer
**Date**: November 7, 2025
**Version**: 1.0

**Contact for Questions**: usmjkim23@gmail.com
**Privacy Policy**: https://forms.teaboard.link/privacy



================================================
FILE: docs/OAUTH_VERIFICATION_MANUAL_GUIDE.md
================================================
[Binary file]


================================================
FILE: docs/ì„œë¹„ìŠ¤_ê³ ë„í™”_ì œì•ˆì„œ_2025-11-03.md
================================================
# TeaBoard Forms ì„œë¹„ìŠ¤ ê³ ë„í™” ì œì•ˆì„œ

**ì‘ì„±ì¼**: 2025ë…„ 11ì›” 3ì¼
**ëŒ€ìƒ**: í•œêµ­ ì´ˆì¤‘ê³  êµì‚¬
**í˜„ì¬ ê¸°ìˆ **: Next.js 15.1.3, Google Forms API, Gemini AI 2.0-flash-latest

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì‹œì¥ ë¶„ì„ ë° ê¸°íšŒ](#ì‹œì¥-ë¶„ì„-ë°-ê¸°íšŒ)
3. [êµì‚¬ ë‹ˆì¦ˆ ë¶„ì„](#êµì‚¬-ë‹ˆì¦ˆ-ë¶„ì„)
4. [ê²½ìŸì‚¬ ë¶„ì„](#ê²½ìŸì‚¬-ë¶„ì„)
5. [ê¸°ìˆ  ê³ ë„í™” ì œì•ˆ](#ê¸°ìˆ -ê³ ë„í™”-ì œì•ˆ)
6. [Google Forms API ë³€ê²½ ëŒ€ì‘](#google-forms-api-ë³€ê²½-ëŒ€ì‘)
7. [êµ¬í˜„ ë¡œë“œë§µ](#êµ¬í˜„-ë¡œë“œë§µ)
8. [ê¸°ëŒ€ íš¨ê³¼](#ê¸°ëŒ€-íš¨ê³¼)

---

## ê°œìš”

### í˜„ì¬ ì„œë¹„ìŠ¤ í˜„í™©
- **í•µì‹¬ ê¸°ëŠ¥**: AI ê¸°ë°˜ í€´ì¦ˆ ë° ì„¤ë¬¸ ìë™ ìƒì„±
- **ê¸°ìˆ  ìŠ¤íƒ**: Gemini AI 2.5-flash-latest, Google Forms API
- **íƒ€ê²Ÿ**: í•œêµ­ ì´ˆì¤‘ê³  êµì‚¬ (ì•½ 40ë§Œëª…)
- **ì°¨ë³„ì **:
  - ë¬´ë£Œ AI í€´ì¦ˆ ìƒì„±
  - í•œêµ­ì–´ ì™„ì „ ì§€ì›
  - 1ë¶„ ì´ë‚´ í€´ì¦ˆ ìƒì„±

### ì‹œì¥ ê¸°íšŒ
- **ê¸€ë¡œë²Œ AI êµìœ¡ ì‹œì¥**: $7.57B (2025) â†’ $112.30B (2034) **(14ë°° ì„±ì¥)**
- **í•œêµ­ ì •ë¶€ AI êµìœ¡ íˆ¬ì**: 2024-2026ë…„ **7,400ì–µì›** íˆ¬ì…
- **êµì‚¬ AI ì—­ëŸ‰ ê°•í™”**: 2026ë…„ê¹Œì§€ ì „ì²´ êµì‚¬ ë””ì§€í„¸ êµìœ¡ ì˜ë¬´í™”

---

## ì‹œì¥ ë¶„ì„ ë° ê¸°íšŒ

### ğŸ“ˆ EdTech íŠ¸ë Œë“œ (2024-2025)

#### 1. **AI ê¸°ë°˜ ì¦‰ì‹œ í€´ì¦ˆ ìƒì„±**
- **ì‹œì¥ í‘œì¤€**: 1ë¶„ ì´ë‚´ ì™„ì„±í˜• í‰ê°€ ìƒì„±
- **ì„ ë‘ ê¸°ì—…**: Curipod, Classpoint.io, Quizlet AI, Gemini for Education
- **ìš°ë¦¬ì˜ ìœ„ì¹˜**: âœ… ì´ë¯¸ êµ¬í˜„ë¨ (Gemini 2.0-flash-latest)

#### 2. **ìë™ ì±„ì  ë° ì‹¤ì‹œê°„ í”¼ë“œë°±**
- **ì‹œì¥ ìš”êµ¬**: ì±„ì  ì‹œê°„ 70-75% ë‹¨ì¶•
- **ì£¼ìš” ê¸°ëŠ¥**: ì¦‰ê° í”¼ë“œë°±, ë£¨ë¸Œë¦­ ê¸°ë°˜ ì±„ì , ì†ê¸€ì”¨ ì¸ì‹
- **ëŒ€í‘œ ë„êµ¬**: CoGrader, Marking.ai, ClassMarker
- **ìš°ë¦¬ì˜ ê°­**: âŒ ìë™ ì±„ì  ë¯¸êµ¬í˜„ â†’ **ìµœìš°ì„  ê°œë°œ í•„ìš”**

#### 3. **ì ì‘í˜• ê°œì¸í™” í‰ê°€**
- **íŠ¸ë Œë“œ**: ì‹¤ì‹œê°„ ë‚œì´ë„ ì¡°ì •, í•™ìŠµ ê³µë°± íŒŒì•…
- **ì‹œì¥ ì „ë§**: 2025-2026ë…„ ê°œì¸í™” í•™ìŠµ AI ì£¼ë„ ì˜ˆìƒ
- **ìš°ë¦¬ì˜ ê°­**: âŒ ì ì‘í˜• ê¸°ëŠ¥ ì—†ìŒ â†’ ì¤‘ê¸° ê°œë°œ ê³¼ì œ

#### 4. **ë‹¤ì–‘í•œ ì…ë ¥ í˜•ì‹ ì§€ì›**
- **ì‹œì¥ ìš”êµ¬**: í…ìŠ¤íŠ¸, PDF, ë™ì˜ìƒ, ì†ê¸€ì”¨ ë…¸íŠ¸ ë“±
- **ì˜ˆì‹œ**: Coursebox (10ë¶„ ì´ë‚´ ë³€í™˜), PrepAI (ì˜ìƒ â†’ í€´ì¦ˆ)
- **ìš°ë¦¬ì˜ ìœ„ì¹˜**: ğŸ”¶ í…ìŠ¤íŠ¸ë§Œ ì§€ì› â†’ **PDF/ì˜ìƒ ì…ë ¥ ì¶”ê°€ í•„ìš”**

#### 5. **ê²Œì´ë¯¸í”¼ì¼€ì´ì…˜**
- **ì‹œì¥ ì£¼ë„**: Kahoot (ì‹¤ì‹œê°„), Quizizz (ìê¸°ì£¼ë„), Blooket, Gimkit
- **í•µì‹¬ ìš”ì†Œ**: ë¦¬ë”ë³´ë“œ, íŒŒì›Œì—…, ì¸í„°ë™í‹°ë¸Œ íˆ¬í‘œ
- **ìš°ë¦¬ì˜ ê°­**: âŒ ê²Œì„ ìš”ì†Œ ì—†ìŒ â†’ í•™ìƒ ì°¸ì—¬ë„ í–¥ìƒ ê³¼ì œ

#### 6. **í”Œë«í¼ í†µí•©**
- **ì‹œì¥ í‘œì¤€**: ì›í´ë¦­ ë‚´ë³´ë‚´ê¸° (Google Forms, Kahoot, Quizizz ë“±)
- **ì˜ˆì‹œ**: QuestionWell (8ê°œ í”Œë«í¼ ì§€ì›)
- **ìš°ë¦¬ì˜ ìœ„ì¹˜**: ğŸ”¶ Google Formsë§Œ ì§€ì› â†’ **ë‹¤ì¤‘ í”Œë«í¼ ë‚´ë³´ë‚´ê¸° í•„ìš”**

#### 7. **ê³ ê¸‰ ë¶„ì„ ë° ì§„ë„ ì¶”ì **
- **íŠ¸ë Œë“œ**: AI ëŒ€ì‹œë³´ë“œ, í•™ìŠµ íŒ¨í„´ ë¶„ì„, ê°œì… ì¶”ì²œ
- **êµì‚¬ ê°€ì¹˜**: ë°ì´í„° ê¸°ë°˜ êµìœ¡ ì˜ì‚¬ê²°ì •
- **ìš°ë¦¬ì˜ ê°­**: âŒ ë¶„ì„ ê¸°ëŠ¥ ì—†ìŒ â†’ ì¤‘ì¥ê¸° ê°œë°œ ê³¼ì œ

---

## êµì‚¬ ë‹ˆì¦ˆ ë¶„ì„

### ğŸ’” êµì‚¬ ê³ ì¶© Top 10

#### ì‹œê°„ ê´€ë¦¬ ë¬¸ì œ
1. **í€´ì¦ˆ ì œì‘ ì‹œê°„ ê³¼ë‹¤** (í‰ê·  40-60ë¶„/í€´ì¦ˆ)
   - ìˆ˜ì—… ì¤€ë¹„, ì±„ì , êµì‹¤ ê´€ë¦¬ ë³‘í–‰
   - ì˜¨ë¼ì¸ ìˆ˜ì—…ì—ì„œ ë”ìš± ì‹¬í™”

2. **ìˆ˜ë™ ì±„ì  ì—…ë¬´ ë¶€ë‹´** (êµì‚¬ ì‹œê°„ì˜ 30-50%)
   - ëŒ€ê·œëª¨ í•™ê¸‰ì—ì„œ í•„ê¸° ë‹µì•ˆ ê²€í†  ë¶€ë‹´
   - ê³ ì°¨ì› ì‚¬ê³  í‰ê°€ ëŒ€ì‹  ë§ì¶¤ë²• ê²€ì‚¬ì— ì‹œê°„ ì†Œë¹„

3. **ë°˜ë³µ í–‰ì • ì—…ë¬´**
   - ë‹¤ë¥¸ í•™ê¸‰ì— ë™ì¼ ìœ í˜• ë¬¸ì œ ì¬ìƒì„±
   - í”Œë«í¼ë³„ í˜•ì‹ ì¬ì¡°ì •

#### í’ˆì§ˆ ë° êµìœ¡í•™ì  ê³¼ì œ
4. **ê³ ì°¨ì› ì‚¬ê³ ë ¥ ë¬¸í•­ ì œì‘ ì–´ë ¤ì›€** (HOTS)
   - ë‹¨ìˆœ ì•”ê¸°ë¥¼ ë„˜ì–´ì„  ë¬¸ì œ ìƒì„± ë‚œì´ë„
   - Bloom's Taxonomy ì •ë ¬ í•„ìš”

5. **ìˆ˜ì¤€ë³„ ì°¨ë³„í™” ì–´ë ¤ì›€**
   - ë‹¤ì–‘í•œ í•™ìŠµìë¥¼ ìœ„í•œ ë‚œì´ë„ë³„ ë¬¸í•­ ì œì‘
   - ëŒ€ê·œëª¨ ê°œì¸í™” í”¼ë“œë°±

6. **í˜•ì„±í‰ê°€ ë„êµ¬ ë¶€ì¡±**
   - ìˆ˜ì—… ì¤‘ ì‹¤ì‹œê°„ ì´í•´ë„ ì²´í¬ í•„ìš”
   - ê°œë³„ í•™ìƒ ì§„ë„ ëª¨ë‹ˆí„°ë§ ì–´ë ¤ì›€

#### ê¸°ìˆ  ë° í”Œë«í¼ í•œê³„
7. **Google Forms ì œì•½**
   - ì œí•œì  í…œí”Œë¦¿ (ì»¤ìŠ¤í„°ë§ˆì´ì§• ì‹œê°„ ì†Œìš”)
   - ì „ë¬¸ ì‘ì—…ìš© ê³ ê¸‰ ê¸°ëŠ¥ ë¶€ì¡±
   - ì˜¨ë¼ì¸ í† ë¡  í¬ëŸ¼ì—ì„œ ì‚¬ìš© ë¶ˆê°€

8. **í”Œë«í¼ ì „í™˜ í”¼ë¡œê°**
   - ì‹œìŠ¤í…œ ê°„ ìˆ˜ë™ ì½˜í…ì¸  ì´ì „
   - í”Œë«í¼ë³„ í•™ìƒ ë°ì´í„° ë¶ˆì¼ì¹˜

#### í”¼ë“œë°± ë° ì°¸ì—¬ë„ ë¬¸ì œ
9. **ì§€ì—°ëœ í”¼ë“œë°± ë£¨í”„**
   - í•™ìƒì´ ê²°ê³¼ë¥¼ ë©°ì¹  ëŒ€ê¸°
   - ì¦‰ê° êµì • ê¸°íšŒ ìƒì‹¤

10. **ì „í†µì  í€´ì¦ˆì— ëŒ€í•œ í•™ìƒ ë¬´ê´€ì‹¬**
    - ì¸í„°ë™í‹°ë¸Œ ë° ê²Œì„í™” ìš”ì†Œ í•„ìš”
    - ì˜¨ë¼ì¸/í•˜ì´ë¸Œë¦¬ë“œ í™˜ê²½ì—ì„œ ì£¼ì˜ë ¥ ìœ ì§€ ì–´ë ¤ì›€

---

## ê²½ìŸì‚¬ ë¶„ì„

### ğŸ† ì£¼ìš” ê²½ìŸ í”Œë«í¼ 5ê°œ

#### 1. **Kahoot! (ê²Œì´ë¯¸í”¼ì¼€ì´ì…˜ ì„ ë‘)**
**ê°•ì :**
- ì‹¤ì‹œê°„ ë™ê¸°ì‹ í”Œë ˆì´ (ê³µìœ  í™”ë©´ + ë¦¬ë”ë³´ë“œ)
- ê³ ì—ë„ˆì§€ êµì‹¤ ì°¸ì—¬
- ê³ ê¸‰ ë¬¸ì œ ìœ í˜•: í¼ì¦, íˆ¬í‘œ, ê°œë°©í˜•, ìŠ¬ë¼ì´ë“œ
- ë°±ë§Œ+ ì´ë¯¸ì§€ ë¼ì´ë¸ŒëŸ¬ë¦¬ (í”„ë¦¬ë¯¸ì—„)

**ê°€ê²©:** $3.99-$9.99/ì›” (êµì‚¬ë‹¹)

**ì ìš© ê°€ëŠ¥ ìš”ì†Œ:**
- ì‹¤ì‹œê°„ ì°¸ì—¬ ê¸°ëŠ¥
- ë¦¬ë”ë³´ë“œ ì‹œìŠ¤í…œ
- ì´ë¯¸ì§€ ë¼ì´ë¸ŒëŸ¬ë¦¬

#### 2. **Quizizz (ìê¸°ì£¼ë„ í•™ìŠµ ì„ ë‘)**
**ê°•ì :**
- í•™ìƒ ì†ë„ ì¡°ì ˆ ê°€ëŠ¥ (ë°ˆ + íŒŒì›Œì—…)
- ChatGPT í†µí•© AI í€´ì¦ˆ ìƒì„±
- í€´ì¦ˆ ì¢…ë£Œ í›„ ë³µìŠµ ê¸°ëŠ¥
- ê°•ë ¥í•œ ë¬´ë£Œ í”Œëœ

**ì ìš© ê°€ëŠ¥ ìš”ì†Œ:**
- ìê¸°ì£¼ë„ ëª¨ë“œ
- AI ìƒì„± ê¸°ëŠ¥ (ì´ë¯¸ ìš°ë¦¬ê°€ ì•ì„œ ìˆìŒ)
- ë³µìŠµ ì‹œìŠ¤í…œ

#### 3. **Quizlet (AI í•™ìŠµ í”Œë«í¼)**
**ê°•ì :**
- Magic Notes: ìˆ˜ì—… ë…¸íŠ¸/êµê³¼ì„œ â†’ í”Œë˜ì‹œì¹´ë“œ/í€´ì¦ˆ ìë™ ë³€í™˜
- Q-Chat: AI í•™ìŠµ ë„ìš°ë¯¸
- ë‹¤ì¤‘ í•™ìŠµ ëª¨ë“œ (í”Œë˜ì‹œì¹´ë“œ, ë§¤ì¹­, í…ŒìŠ¤íŠ¸)
- í•™ìŠµ ì„ í˜¸ë„ ê¸°ë°˜ AI ê°œì¸í™”

**ì ìš© ê°€ëŠ¥ ìš”ì†Œ:**
- ë‹¤ì–‘í•œ ì…ë ¥ í˜•ì‹ (ë…¸íŠ¸ â†’ í€´ì¦ˆ)
- ë‹¤ì¤‘ í•™ìŠµ ëª¨ë“œ
- AI ê°œì¸í™”

#### 4. **QuizMaker (AI ìš°ì„  í”Œë«í¼)**
**ê°•ì :**
- AI ê¸°ë°˜ í€´ì¦ˆ ìƒì„± (#1 Quizizz ëŒ€ì•ˆ 2024-2025)
- ê¸°ì„± í€´ì¦ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬
- ê°•ë ¥í•œ ë¶„ì„ ë° ì§„ë„ ì¶”ì 
- ë‹¤ì¤‘ í”Œë«í¼ ì›í´ë¦­ ë‚´ë³´ë‚´ê¸°

**ì ìš© ê°€ëŠ¥ ìš”ì†Œ:**
- ì»¤ë®¤ë‹ˆí‹° í€´ì¦ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬
- ë¶„ì„ ëŒ€ì‹œë³´ë“œ
- ë‹¤ì¤‘ í”Œë«í¼ ë‚´ë³´ë‚´ê¸°

#### 5. **CoGrader (ì±„ì  ì „ë¬¸)**
**ê°•ì :**
- ë£¨ë¸Œë¦­ ê¸°ë°˜ AI ì±„ì  (ì„œìˆ í˜• ê³¼ì œ)
- ì±„ì  ì‹œê°„ 70% ë‹¨ì¶•
- ìƒì„¸í•˜ê³  ê°œì¸í™”ëœ í”¼ë“œë°±
- ì†ê¸€ì”¨ ì œì¶œ ì§€ì› (Marking.ai í†µí•©)

**ì ìš© ê°€ëŠ¥ ìš”ì†Œ:**
- ìë™ ì±„ì  (ìµœìš°ì„  ê°œë°œ í•„ìš”)
- ë£¨ë¸Œë¦­ ê¸°ë°˜ ì±„ì 
- ì†ê¸€ì”¨ ì¸ì‹

---

## ğŸ‡°ğŸ‡· í•œêµ­ êµìœ¡ ì‹œì¥ íŠ¹ìˆ˜ì„±

### 1. **ì •ë¶€ AI êµìœ¡ ì´ë‹ˆì…”í‹°ë¸Œ (2024-2026)**
- **7,400ì–µì› ì˜ˆì‚°** êµì‚¬ í›ˆë ¨ ë°°ì •
- **ëª©í‘œ**: 2026ë…„ê¹Œì§€ ëª¨ë“  êµì‚¬ ë””ì§€í„¸ ê¸°ìˆ  êµìœ¡
- **ì´ˆì **: KERIS (í•œêµ­êµìœ¡í•™ìˆ ì •ë³´ì›) AI ì—­ëŸ‰ í”„ë ˆì„ì›Œí¬
- **ì‹œì‚¬ì **: êµì‚¬ë“¤ì˜ AI ë„êµ¬ ì±„íƒ ì˜ë¬´í™” â†’ **ì™„ë²½í•œ ì‹œì¥ íƒ€ì´ë°**

### 2. **í•œêµ­ êµì‚¬ í”Œë«í¼ ë° ì„ í˜¸ë„**

**ì¸ê¸° ë„êµ¬:**
- **í¬ì»¤ìŠ¤íŒ¡ (Focuspang AI)**: í€´ì¦ˆ ë°°í‹€, ë””ì§€í„¸ ì‹œí—˜, ì»¤ë®¤ë‹ˆí‹° ë¬¸ì œ ì €ì¥ì†Œ
  - **í•µì‹¬**: ì„œìš¸ì‹œêµìœ¡ì²­ ì´ˆì¤‘ê³ ì— **ê³µì‹ ì œê³µ**
- **í€´ì¦ˆì•¤ (Quizn)**: ë§ì€ ë¬´ë£Œ ê¸°ëŠ¥, ì›ê²© í˜‘ì—… ì§€ì›
  - ì½”ë¡œë‚˜ ì´í›„ ì˜¨ë¼ì¸ í•™ìŠµì—ì„œ ì¸ê¸°
- **Kahoot!**: í•œêµ­ êµì‚¬ ë° í•™ìƒì—ê²Œ ë¬´ë£Œ
- **Google Forms**: ë„ë¦¬ ì‚¬ìš©ë˜ì§€ë§Œ ì œí•œì  ì»¤ìŠ¤í„°ë§ˆì´ì§•

**í•œêµ­ êµì‚¬ ìš”êµ¬ì‚¬í•­:**
- âœ… **í•œêµ­ì–´ ì§€ì›** (í•„ìˆ˜, ì„ íƒ ì•„ë‹˜)
- âœ… **í•œêµ­ LMS í†µí•©** (ì˜ˆ: NEIS - êµìœ¡í–‰ì •ì •ë³´ì‹œìŠ¤í…œ)
- âœ… **ì •ë¶€ ê·œì • ì¤€ìˆ˜** (êµìœ¡ë¶€ í‘œì¤€)

### 3. **TPACK í”„ë ˆì„ì›Œí¬**
- í•œêµ­ í˜„ì§ êµì‚¬ ì—°ìˆ˜ëŠ” TPACK (ê¸°ìˆ êµìœ¡ë‚´ìš©ì§€ì‹) í†µí•© ì¤‘ì‹¬
- AI êµìœ¡ êµ¬í˜„ ì¸ì‹ ì—°êµ¬ ê°•ì¡°
- **ì‹œì‚¬ì **: êµì‚¬ë“¤ì€ ë‹¨ìˆœ ê¸°ìˆ ì´ ì•„ë‹Œ **êµìœ¡í•™ì  ëª¨ë²” ì‚¬ë¡€ì™€ ì¼ì¹˜í•˜ëŠ” ë„êµ¬** í•„ìš”

### 4. **ë°ì´í„° í”„ë¼ì´ë²„ì‹œ ë° ë³´ì•ˆ**
- í•œêµ­ êµìœ¡ ê·œì •ì€ ì—„ê²©í•œ í•™ìƒ ë°ì´í„° ë³´í˜¸ ìš”êµ¬
- PIPA (ê°œì¸ì •ë³´ë³´í˜¸ë²•) ì¤€ìˆ˜ í•„ìš”
- ì œ3ì í”Œë«í¼ í•™êµ ìŠ¹ì¸ ì ˆì°¨
- **ì‹œì‚¬ì **: í•œêµ­ ê°œì¸ì •ë³´ ë³´í˜¸ë²• ì¤€ìˆ˜ í•„ìˆ˜

### 5. **ì»¤ë®¤ë‹ˆí‹° ê¸°ë°˜ ì½˜í…ì¸  ê³µìœ **
- í•œêµ­ êµì‚¬ë“¤ì€ í˜‘ì—… ë¦¬ì†ŒìŠ¤ ì¤‘ì‹œ
- í¬ì»¤ìŠ¤íŒ¡ AIì˜ "ì»¤ë®¤ë‹ˆí‹° ë¬¸ì œ ì €ì¥ì†Œ" ë§¤ìš° ì¸ê¸°
- **ì‹œì‚¬ì **: í•œêµ­ êµì‚¬ ì»¤ë®¤ë‹ˆí‹° êµ¬ì¶• + ê³µìœ  í€´ì¦ˆ í…œí”Œë¦¿/ë¬¸ì œ

---

## ê¸°ìˆ  ê³ ë„í™” ì œì•ˆ

### ğŸ¯ ìš°ì„ ìˆœìœ„ë³„ ê¸°ëŠ¥ ì œì•ˆ

### Phase 1: í•µì‹¬ ì°¨ë³„í™” (3ê°œì›”)

#### 1. **ìë™ ì±„ì  ì‹œìŠ¤í…œ** â­â­â­ (ìµœìš°ì„ )
**ë¬¸ì œì :**
- êµì‚¬ ì‹œê°„ì˜ 30-50%ë¥¼ ì±„ì ì— ì†Œë¹„
- ëŒ€ê·œëª¨ í•™ê¸‰ì—ì„œ ì„œìˆ í˜• í‰ê°€ ë¶€ë‹´

**ì†”ë£¨ì…˜:**
```typescript
// êµ¬í˜„ ë°©í–¥: Gemini AI í™œìš© ìë™ ì±„ì 
interface AutoGradingRequest {
  questionType: 'short_answer' | 'paragraph' | 'multiple_choice';
  studentAnswer: string;
  correctAnswer: string;
  rubric?: {
    criteria: string;
    points: number;
  }[];
}

// API ì—”ë“œí¬ì¸íŠ¸: /api/grading/auto-grade
// Gemini 2.0-flash-latestë¡œ ë‹µì•ˆ í‰ê°€
// - ê°ê´€ì‹: ìë™ ì •ë‹µ ë§¤ì¹­
// - ë‹¨ë‹µí˜•: ì˜ë¯¸ë¡ ì  ìœ ì‚¬ë„ ê²€ì‚¬
// - ì„œìˆ í˜•: ë£¨ë¸Œë¦­ ê¸°ë°˜ ì±„ì  + í”¼ë“œë°± ìƒì„±
```

**ê¸°ëŒ€ íš¨ê³¼:**
- ì±„ì  ì‹œê°„ **70% ë‹¨ì¶•**
- ì¼ê´€ì„± ìˆëŠ” í‰ê°€ ê¸°ì¤€
- ì¦‰ê°ì ì¸ í•™ìƒ í”¼ë“œë°±

**ê¸°ìˆ  ìŠ¤íƒ:**
- Gemini AI: ì˜ë¯¸ë¡ ì  ë‹µì•ˆ ë¶„ì„
- Google Forms API: ì±„ì  ê²°ê³¼ ìë™ ì…ë ¥
- ë£¨ë¸Œë¦­ ì—”ì§„: ê¸°ì¤€ ê¸°ë°˜ í‰ê°€

**ì˜ˆìƒ ê°œë°œ ê¸°ê°„:** 4-6ì£¼

---

#### 2. **HOTS (ê³ ì°¨ì› ì‚¬ê³ ë ¥) ë¬¸í•­ ìƒì„±** â­â­â­
**ë¬¸ì œì :**
- ë‹¨ìˆœ ì•”ê¸° ë¬¸ì œë§Œ ìƒì„±ë˜ëŠ” ê²½í–¥
- Bloom's Taxonomy ì •ë ¬ ì–´ë ¤ì›€

**ì†”ë£¨ì…˜:**
```typescript
// Bloom's Taxonomy ìˆ˜ì¤€ë³„ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§
enum BloomLevel {
  Remember = "ê¸°ì–µí•˜ê¸°",      // 1ë‹¨ê³„: ì‚¬ì‹¤ íšŒìƒ
  Understand = "ì´í•´í•˜ê¸°",    // 2ë‹¨ê³„: ê°œë… ì„¤ëª…
  Apply = "ì ìš©í•˜ê¸°",         // 3ë‹¨ê³„: ìƒí™© ì ìš©
  Analyze = "ë¶„ì„í•˜ê¸°",       // 4ë‹¨ê³„: ìš”ì†Œ ë¶„í•´
  Evaluate = "í‰ê°€í•˜ê¸°",      // 5ë‹¨ê³„: íŒë‹¨/ë¹„í‰
  Create = "ì°½ì¡°í•˜ê¸°"         // 6ë‹¨ê³„: ìƒˆë¡œìš´ ì°½ì¶œ
}

interface HOTSQuizRequest {
  content: string;
  bloomLevel: BloomLevel;
  questionCount: number;
  grade: string;
}

// Gemini í”„ë¡¬í”„íŠ¸ ê°•í™”:
// "ë¶„ì„í•˜ê¸°(4ë‹¨ê³„) ìˆ˜ì¤€ì˜ ë¬¸ì œë¥¼ ìƒì„±í•˜ì„¸ìš”.
//  - ì›ì¸ê³¼ ê²°ê³¼ ê´€ê³„ë¥¼ íŒŒì•…í•˜ëŠ” ë¬¸ì œ
//  - ì¦ê±°ë¥¼ í‰ê°€í•˜ëŠ” ë¬¸ì œ
//  - íŒ¨í„´ì„ ì¸ì‹í•˜ëŠ” ë¬¸ì œ"
```

**ê¸°ëŒ€ íš¨ê³¼:**
- ì‚¬ê³ ë ¥ ì¤‘ì‹¬ í‰ê°€
- êµìœ¡ê³¼ì • ì„±ì·¨ê¸°ì¤€ ì •ë ¬
- í•™ìƒ ê³ ì°¨ì› ì‚¬ê³ ë ¥ ë°œë‹¬

**êµ¬í˜„ ë°©ë²•:**
1. `src/app/api/generate/route.ts`ì— Bloom ìˆ˜ì¤€ íŒŒë¼ë¯¸í„° ì¶”ê°€
2. ìˆ˜ì¤€ë³„ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì‘ì„±
3. UIì— Bloom ìˆ˜ì¤€ ì„ íƒ ì˜µì…˜ ì¶”ê°€

**ì˜ˆìƒ ê°œë°œ ê¸°ê°„:** 2-3ì£¼

---

#### 3. **ì»¤ë®¤ë‹ˆí‹° ë¬¸ì œ ì €ì¥ì†Œ** â­â­â­
**ë¬¸ì œì :**
- êµì‚¬ë“¤ì´ ë°˜ë³µì ìœ¼ë¡œ ë™ì¼í•œ ë¬¸ì œ ìƒì„±
- ì¢‹ì€ ë¬¸ì œë¥¼ ê³µìœ í•  ë°©ë²• ì—†ìŒ

**ì†”ë£¨ì…˜:**
```typescript
// Firebase Firestore ìŠ¤í‚¤ë§ˆ
interface QuestionRepository {
  id: string;
  title: string;
  questions: Question[];
  subject: string;        // ê³¼ëª©
  grade: string;          // í•™ë…„
  tags: string[];         // íƒœê·¸
  createdBy: string;      // êµì‚¬ ID
  likes: number;          // ì¢‹ì•„ìš” ìˆ˜
  downloads: number;      // ë‹¤ìš´ë¡œë“œ ìˆ˜
  isPublic: boolean;      // ê³µê°œ ì—¬ë¶€
  createdAt: Date;
}

// ê¸°ëŠ¥:
// - ë‚´ í€´ì¦ˆ ê³µê°œ/ë¹„ê³µê°œ ì„¤ì •
// - ë‹¤ë¥¸ êµì‚¬ í€´ì¦ˆ ê²€ìƒ‰ ë° ë³µì œ
// - ê³¼ëª©/í•™ë…„ë³„ í•„í„°ë§
// - ì¸ê¸° í€´ì¦ˆ ë­í‚¹
// - ì»¤ë®¤ë‹ˆí‹° í‰ê°€ ë° ëŒ“ê¸€
```

**ê¸°ëŒ€ íš¨ê³¼:**
- êµì‚¬ í˜‘ì—… ë¬¸í™” ì¡°ì„±
- í€´ì¦ˆ ì œì‘ ì‹œê°„ ì¶”ê°€ ë‹¨ì¶•
- í”Œë«í¼ í™œì„±í™” ë° ì¬ë°©ë¬¸ìœ¨ í–¥ìƒ

**ê¸°ìˆ  ìŠ¤íƒ:**
- Firebase Firestore: í€´ì¦ˆ ì €ì¥ì†Œ
- Algolia Search: ë¹ ë¥¸ ê²€ìƒ‰ ê¸°ëŠ¥
- NextAuth: ì‚¬ìš©ì ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬

**ì˜ˆìƒ ê°œë°œ ê¸°ê°„:** 6-8ì£¼

---

### Phase 2: í”Œë«í¼ í™•ì¥ (6ê°œì›”)

#### 4. **ë‹¤ì¤‘ ì…ë ¥ í˜•ì‹ ì§€ì›** â­â­
**í˜„ì¬ ìƒíƒœ:** í…ìŠ¤íŠ¸ë§Œ ì§€ì›
**ëª©í‘œ:** PDF, PPT, YouTube ì˜ìƒ, ì´ë¯¸ì§€

**ì†”ë£¨ì…˜:**
```typescript
interface MultiFormatInput {
  type: 'text' | 'pdf' | 'pptx' | 'youtube' | 'image';
  content: File | string;
}

// PDF ì²˜ë¦¬: pdf-parse ë¼ì´ë¸ŒëŸ¬ë¦¬
// PPT ì²˜ë¦¬: node-pptx ë¼ì´ë¸ŒëŸ¬ë¦¬
// YouTube: youtube-transcript-api + Gemini ì˜ìƒ ë¶„ì„
// ì´ë¯¸ì§€: Google Cloud Vision API (OCR)
```

**ê¸°ëŒ€ íš¨ê³¼:**
- êµì‚¬ ì½˜í…ì¸  í™œìš© ìœ ì—°ì„± ì¦ëŒ€
- ê¸°ì¡´ ìë£Œ ì¬í™œìš© ê°€ëŠ¥
- ê²½ìŸì‚¬ ëŒ€ë¹„ ì°¨ë³„í™”

**ì˜ˆìƒ ê°œë°œ ê¸°ê°„:** 8-10ì£¼

---

#### 5. **ë‹¤ì¤‘ í”Œë«í¼ ë‚´ë³´ë‚´ê¸°** â­â­
**í˜„ì¬ ìƒíƒœ:** Google Formsë§Œ ì§€ì›
**ëª©í‘œ:** Kahoot, Quizizz, Quizlet, Nearpod ë“±

**ì†”ë£¨ì…˜:**
```typescript
interface ExportFormat {
  platform: 'kahoot' | 'quizizz' | 'quizlet' | 'nearpod';
  quiz: Quiz;
}

// Kahoot API í†µí•©
// Quizizz API í†µí•©
// Quizlet API í†µí•©
// ê° í”Œë«í¼ë³„ í˜•ì‹ ë³€í™˜ ì—”ì§„
```

**ê¸°ëŒ€ íš¨ê³¼:**
- êµì‚¬ ì›Œí¬í”Œë¡œìš° í†µí•©
- í”Œë«í¼ ì¢…ì†ì„± ì œê±°
- ì‚¬ìš©ì ë§Œì¡±ë„ í–¥ìƒ

**ì˜ˆìƒ ê°œë°œ ê¸°ê°„:** 10-12ì£¼

---

#### 6. **ì‹¤ì‹œê°„ í˜•ì„±í‰ê°€ ëª¨ë“œ** â­â­
**ë¬¸ì œì :**
- ìˆ˜ì—… ì¤‘ í•™ìƒ ì´í•´ë„ íŒŒì•… ì–´ë ¤ì›€
- ì¦‰ê°ì ì¸ êµìˆ˜ ì¡°ì • í•„ìš”

**ì†”ë£¨ì…˜:**
```typescript
interface LiveAssessment {
  sessionId: string;
  teacherCode: string;
  studentCode: string;
  questions: Question[];
  responses: Map<string, Response>;
  analytics: {
    totalStudents: number;
    respondedCount: number;
    correctRate: number;
    difficultQuestions: string[];
  };
}

// ê¸°ëŠ¥:
// - êµì‚¬: ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ (ì •ë‹µë¥ , ì‘ë‹µ ë¶„í¬)
// - í•™ìƒ: ëª¨ë°”ì¼ ì°¸ì—¬ (QR ì½”ë“œ ì ‘ì†)
// - ì¦‰ì‹œ í”¼ë“œë°±: ì „ì²´ ì •ë‹µë¥  í‘œì‹œ
// - ì–´ë ¤ìš´ ë¬¸ì œ ìë™ í•˜ì´ë¼ì´íŠ¸
```

**ê¸°ëŒ€ íš¨ê³¼:**
- ìˆ˜ì—… ì¤‘ ì¦‰ê°ì ì¸ ì´í•´ë„ ì²´í¬
- ë°ì´í„° ê¸°ë°˜ êµìˆ˜ ì¡°ì •
- í•™ìƒ ì°¸ì—¬ë„ í–¥ìƒ

**ê¸°ìˆ  ìŠ¤íƒ:**
- WebSocket (Socket.io): ì‹¤ì‹œê°„ í†µì‹ 
- Redis: ì„¸ì…˜ ë°ì´í„° ìºì‹±
- Chart.js: ì‹¤ì‹œê°„ ì°¨íŠ¸

**ì˜ˆìƒ ê°œë°œ ê¸°ê°„:** 8-10ì£¼

---

### Phase 3: ê³ ê¸‰ ê¸°ëŠ¥ (12ê°œì›”)

#### 7. **ì ì‘í˜• í•™ìŠµ ê²½ë¡œ** â­
**ê°œë…:**
- í•™ìƒ ë‹µë³€ íŒ¨í„´ ë¶„ì„
- ì‹¤ì‹œê°„ ë‚œì´ë„ ì¡°ì •
- ê°œì¸í™”ëœ ë³´ì¶© ë¬¸ì œ ì œê³µ

**ì†”ë£¨ì…˜:**
```typescript
interface AdaptiveLearning {
  studentId: string;
  knowledgeMap: {
    topic: string;
    masteryLevel: number; // 0-1
    weakPoints: string[];
  }[];
  nextQuestion: Question; // AI ì¶”ì²œ ë‹¤ìŒ ë¬¸ì œ
  learningPath: Question[]; // ê°œì¸í™” ê²½ë¡œ
}

// Gemini AIë¡œ í•™ìŠµ íŒ¨í„´ ë¶„ì„
// Item Response Theory (IRT) ì ìš©
// ê°œì¸ë³„ ìµœì  ë‚œì´ë„ ë¬¸ì œ ì œê³µ
```

**ê¸°ëŒ€ íš¨ê³¼:**
- í•™ìƒë³„ ë§ì¶¤ í•™ìŠµ
- í•™ìŠµ íš¨ìœ¨ì„± ê·¹ëŒ€í™”
- êµì‚¬ ê°œë³„í™” êµìœ¡ ì§€ì›

**ì˜ˆìƒ ê°œë°œ ê¸°ê°„:** 12-16ì£¼

---

#### 8. **ê³ ê¸‰ ë¶„ì„ ëŒ€ì‹œë³´ë“œ** â­
**ê¸°ëŠ¥:**
- í•™ê¸‰ë³„ ì„±ì·¨ë„ ì¶”ì´
- ê°œì¸ë³„ ê°•ì /ì•½ì  ë¶„ì„
- ë¬¸ì œë³„ ì •ë‹µë¥  ë° ì†Œìš” ì‹œê°„
- ê°œì… í•„ìš” í•™ìƒ ìë™ ì‹ë³„

**ì†”ë£¨ì…˜:**
```typescript
interface AnalyticsDashboard {
  classPerformance: {
    averageScore: number;
    trend: number[]; // ì‹œê°„ë³„ ì¶”ì´
    topicMastery: Map<string, number>;
  };
  studentProfiles: {
    studentId: string;
    strengths: string[];
    weaknesses: string[];
    riskLevel: 'high' | 'medium' | 'low';
  }[];
  questionAnalytics: {
    questionId: string;
    correctRate: number;
    averageTime: number;
    commonMistakes: string[];
  }[];
}

// Chart.js + D3.js: ê³ ê¸‰ ì‹œê°í™”
// BigQuery: ëŒ€ìš©ëŸ‰ ë°ì´í„° ë¶„ì„
// Gemini AI: ì¸ì‚¬ì´íŠ¸ ìë™ ìƒì„±
```

**ê¸°ëŒ€ íš¨ê³¼:**
- ë°ì´í„° ê¸°ë°˜ êµìœ¡ ì˜ì‚¬ê²°ì •
- ì¡°ê¸° ê°œì…ìœ¼ë¡œ í•™ìŠµ ë¶€ì§„ ì˜ˆë°©
- êµìœ¡ í’ˆì§ˆ í–¥ìƒ

**ì˜ˆìƒ ê°œë°œ ê¸°ê°„:** 10-12ì£¼

---

#### 9. **ì†ê¸€ì”¨ ë‹µì•ˆ ì¸ì‹ ë° ì±„ì ** â­
**ë¬¸ì œì :**
- í•œêµ­ í•™êµëŠ” ì—¬ì „íˆ ì¢…ì´ ì‹œí—˜ ë§ìŒ
- ì†ê¸€ì”¨ ì±„ì ì— ë§ì€ ì‹œê°„ ì†Œìš”

**ì†”ë£¨ì…˜:**
```typescript
interface HandwritingGrading {
  imageFile: File; // ë‹µì•ˆì§€ ì‚¬ì§„
  questions: Question[];
  extractedAnswers: {
    questionId: string;
    handwrittenText: string; // OCR ê²°ê³¼
    confidence: number;
  }[];
  grades: {
    questionId: string;
    score: number;
    feedback: string;
  }[];
}

// Google Cloud Vision API: í•œêµ­ì–´ ì†ê¸€ì”¨ OCR
// Gemini AI: ì¶”ì¶œëœ í…ìŠ¤íŠ¸ ì±„ì 
// í‹€ë¦° ë¶€ë¶„ í•˜ì´ë¼ì´íŠ¸ ì´ë¯¸ì§€ ìƒì„±
```

**ê¸°ëŒ€ íš¨ê³¼:**
- ì˜¤í”„ë¼ì¸ ì‹œí—˜ë„ ìë™ ì±„ì 
- í•œêµ­ êµìœ¡ í˜„ì¥ ì‹¤ì • ë°˜ì˜
- êµì‚¬ ì±„ì  ë¶€ë‹´ íšê¸°ì  ê°ì†Œ

**ê¸°ìˆ  ìŠ¤íƒ:**
- Google Cloud Vision API
- Gemini AI
- Canvas API: ì´ë¯¸ì§€ ì£¼ì„

**ì˜ˆìƒ ê°œë°œ ê¸°ê°„:** 12-16ì£¼

---

### Phase 4: ìƒíƒœê³„ êµ¬ì¶• (18ê°œì›”)

#### 10. **í•™ë¶€ëª¨ í¬í„¸**
- ìë…€ í•™ìŠµ ì§„ë„ í™•ì¸
- ì•½ì  íŒŒì•… ë° ê°€ì • í•™ìŠµ ê°€ì´ë“œ
- êµì‚¬ì™€ ì†Œí†µ ì±„ë„

#### 11. **í•™ìƒ ìê¸°ì£¼ë„ í•™ìŠµ ëª¨ë“œ**
- AI íŠœí„° ì±—ë´‡ (Gemini)
- ê°œë… ì„¤ëª… ë° ë¬¸ì œ í’€ì´ ë„ì›€
- í•™ìŠµ ê³„íš ìˆ˜ë¦½ ì§€ì›

#### 12. **NEIS (êµìœ¡í–‰ì •ì •ë³´ì‹œìŠ¤í…œ) ì—°ë™**
- í•™ìƒ ì •ë³´ ìë™ ë™ê¸°í™”
- ì„±ì  ì²˜ë¦¬ ìë™í™”
- êµìœ¡ì²­ ë³´ê³  ìë™ ìƒì„±

---

## Google Forms API ë³€ê²½ ëŒ€ì‘

### ğŸ“… ì¤‘ìš” ë³€ê²½ ì‚¬í•­ (2026ë…„ 3ì›” 31ì¼ ì‹œí–‰)

#### ë³€ê²½ ë‚´ìš©
**í˜„ì¬ (2025ë…„ 11ì›” ê¸°ì¤€):**
- APIë¡œ ìƒì„±ëœ í¼ì€ **ìë™ìœ¼ë¡œ ê²Œì‹œ(published)** ìƒíƒœ
- ì¦‰ì‹œ ì‘ë‹µ ìˆ˜ì§‘ ê°€ëŠ¥

**ë³€ê²½ í›„ (2026ë…„ 3ì›” 31ì¼ ì´í›„):**
- APIë¡œ ìƒì„±ëœ í¼ì€ **ë¯¸ê²Œì‹œ(unpublished)** ìƒíƒœë¡œ ìƒì„±
- **ëª…ì‹œì ìœ¼ë¡œ ê²Œì‹œí•´ì•¼** ì‘ë‹µ ìˆ˜ì§‘ ê°€ëŠ¥

#### ì˜í–¥ ë¶„ì„
**ìš°ë¦¬ ì„œë¹„ìŠ¤ì— ë¯¸ì¹˜ëŠ” ì˜í–¥:**
- âŒ **í˜„ì¬ ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš© ì‹œ**: 2026ë…„ 3ì›” 31ì¼ ì´í›„ ìƒì„±ëœ í¼ì´ ì‘ë‹µ ë°›ì§€ ëª»í•¨
- âœ… **ëŒ€ì‘ í•„ìš”**: í¼ ìƒì„± í›„ ìë™ ê²Œì‹œ ë¡œì§ ì¶”ê°€

---

### ğŸ”§ ëŒ€ì‘ ë°©ì•ˆ

#### 1. **ì¦‰ì‹œ êµ¬í˜„ (2025ë…„ 11ì›”-12ì›”)**

**ë°©ë²• A: forms.setPublishSettings() ë©”ì„œë“œ ì¶”ê°€**

```typescript
// src/lib/google-forms-api.ts (ìƒˆ íŒŒì¼ ìƒì„±)

import { google } from 'googleapis';

/**
 * Google Forms APIë¥¼ ì‚¬ìš©í•˜ì—¬ í¼ì„ ê²Œì‹œ ìƒíƒœë¡œ ì„¤ì •
 *
 * @param formId - ê²Œì‹œí•  í¼ì˜ ID
 * @param accessToken - Google OAuth ì•¡ì„¸ìŠ¤ í† í°
 */
export async function publishForm(
  formId: string,
  accessToken: string
): Promise<void> {
  const forms = google.forms({ version: 'v1' });

  try {
    await forms.forms.setPublishSettings({
      formId: formId,
      requestBody: {
        publishSettings: {
          // í¼ì„ ê²Œì‹œ ìƒíƒœë¡œ ì„¤ì •
          // published: trueëŠ” ê¸°ë³¸ê°’ì´ë¯€ë¡œ ìƒëµ ê°€ëŠ¥
        }
      },
      auth: accessToken
    });

    console.log(`âœ… Form ${formId} successfully published`);
  } catch (error) {
    console.error(`âŒ Failed to publish form ${formId}:`, error);
    throw new Error(`Form publishing failed: ${error.message}`);
  }
}

/**
 * í¼ ìƒì„± ë° ìë™ ê²Œì‹œ (2026ë…„ 3ì›” 31ì¼ ì´í›„ ëŒ€ë¹„)
 *
 * @param formSpec - FormSpec ê°ì²´
 * @param accessToken - Google OAuth ì•¡ì„¸ìŠ¤ í† í°
 * @returns ìƒì„±ëœ í¼ ID
 */
export async function createAndPublishForm(
  formSpec: any,
  accessToken: string
): Promise<string> {
  // 1. í¼ ìƒì„± (ê¸°ì¡´ ë¡œì§)
  const forms = google.forms({ version: 'v1' });
  const createResponse = await forms.forms.create({
    requestBody: formSpec,
    auth: accessToken
  });

  const formId = createResponse.data.formId!;

  // 2. í¼ ê²Œì‹œ (2026ë…„ 3ì›” 31ì¼ ì´í›„ í•„ìˆ˜)
  await publishForm(formId, accessToken);

  return formId;
}
```

**src/app/api/forms/create/route.ts ìˆ˜ì •:**

```typescript
import { createAndPublishForm } from '@/lib/google-forms-api';

// ê¸°ì¡´:
// const response = await fetch(
//   `https://forms.googleapis.com/v1/forms`,
//   {
//     method: "POST",
//     headers: { /* ... */ },
//     body: JSON.stringify(formSpec),
//   }
// );

// ë³€ê²½:
const formId = await createAndPublishForm(formSpec, accessToken);
const formUrl = `https://docs.google.com/forms/d/${formId}/edit`;

return NextResponse.json({
  success: true,
  formId: formId,
  formUrl: formUrl,
  message: "Form created and published successfully"
});
```

---

#### 2. **ë‹¨ê³„ë³„ ë§ˆì´ê·¸ë ˆì´ì…˜ (2025ë…„ 12ì›” - 2026ë…„ 3ì›”)**

**Phase 1 (2025ë…„ 12ì›”):**
- âœ… `publishForm()` í•¨ìˆ˜ êµ¬í˜„
- âœ… í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ê²€ì¦
- âœ… ê²Œì‹œ ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ë¡œì§ ì¶”ê°€

**Phase 2 (2026ë…„ 1ì›”-2ì›”):**
- âœ… í”„ë¡œë•ì…˜ ë°°í¬ (ê¸°ì¡´ ë™ì‘ ìœ ì§€ + ì¶”ê°€ ê²Œì‹œ)
- âœ… ëª¨ë‹ˆí„°ë§: ê²Œì‹œ ì„±ê³µë¥  ì¶”ì 
- âœ… ì—ëŸ¬ ë¡œê¹… ê°•í™”

**Phase 3 (2026ë…„ 3ì›”):**
- âœ… 2026ë…„ 3ì›” 31ì¼ ì´ì „ ìµœì¢… í™•ì¸
- âœ… ê¸´ê¸‰ ëŒ€ì‘ ê³„íš ìˆ˜ë¦½
- âœ… ì‚¬ìš©ì ê³µì§€ (ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì—†ìŒ ì•ˆë‚´)

---

#### 3. **ê¶Œí•œ ê´€ë¦¬ ì¶”ê°€ ê³ ë ¤**

**ì„ íƒì  ê¸°ëŠ¥: íŠ¹ì • ì‚¬ìš©ìì™€ í¼ ê³µìœ **

```typescript
/**
 * Drive APIë¥¼ ì‚¬ìš©í•˜ì—¬ í¼ì„ íŠ¹ì • ì‚¬ìš©ìì™€ ê³µìœ 
 *
 * @param formId - ê³µìœ í•  í¼ì˜ ID
 * @param emails - ê³µìœ  ëŒ€ìƒ ì´ë©”ì¼ ëª©ë¡
 * @param role - ê¶Œí•œ ('reader', 'writer', 'commenter')
 * @param accessToken - Google OAuth ì•¡ì„¸ìŠ¤ í† í°
 */
export async function shareForm(
  formId: string,
  emails: string[],
  role: 'reader' | 'writer' | 'commenter',
  accessToken: string
): Promise<void> {
  const drive = google.drive({ version: 'v3' });

  for (const email of emails) {
    try {
      await drive.permissions.create({
        fileId: formId,
        requestBody: {
          type: 'user',
          role: role,
          emailAddress: email
        },
        auth: accessToken
      });

      console.log(`âœ… Form ${formId} shared with ${email}`);
    } catch (error) {
      console.error(`âŒ Failed to share form ${formId} with ${email}:`, error);
    }
  }
}
```

**UI ì¶”ê°€:**
- í¼ ìƒì„± í›„ "ê³µìœ  ëŒ€ìƒ ì¶”ê°€" ì˜µì…˜
- í•™ìƒ ì´ë©”ì¼ ëª©ë¡ ì…ë ¥ ë˜ëŠ” CSV ì—…ë¡œë“œ
- êµì‚¬ë§Œ ë³´ê¸° / í•™ìƒë„ ìˆ˜ì • ê°€ëŠ¥ ë“± ê¶Œí•œ ì„ íƒ

---

### ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸: Google Forms API ë³€ê²½ ëŒ€ì‘

#### í•„ìˆ˜ ì‘ì—… (2026ë…„ 3ì›” 31ì¼ ì „ê¹Œì§€)
- [ ] `google-forms-api.ts` íŒŒì¼ ìƒì„±
- [ ] `publishForm()` í•¨ìˆ˜ êµ¬í˜„
- [ ] `createAndPublishForm()` í•¨ìˆ˜ êµ¬í˜„
- [ ] `/api/forms/create` ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì •
- [ ] í…ŒìŠ¤íŠ¸ í™˜ê²½ ê²€ì¦
- [ ] í”„ë¡œë•ì…˜ ë°°í¬
- [ ] ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”

#### ì„ íƒ ì‘ì—… (ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ)
- [ ] `shareForm()` í•¨ìˆ˜ êµ¬í˜„ (Drive API)
- [ ] í¼ ê³µìœ  UI ì¶”ê°€
- [ ] í•™ìƒ ëª©ë¡ CSV ì—…ë¡œë“œ ê¸°ëŠ¥
- [ ] ê¶Œí•œ ê´€ë¦¬ í˜ì´ì§€ ìƒì„±

#### ë¬¸ì„œí™”
- [ ] API ë³€ê²½ì‚¬í•­ ê°œë°œì ë¬¸ì„œ ì‘ì„±
- [ ] ì‚¬ìš©ì ê°€ì´ë“œ ì—…ë°ì´íŠ¸
- [ ] FAQ ì¶”ê°€ (ê²Œì‹œ/ê³µìœ  ê´€ë ¨)

---

## êµ¬í˜„ ë¡œë“œë§µ

### ğŸ“… 18ê°œì›” ê°œë°œ ê³„íš

```
2025 Q4 (10-12ì›”)
â”œâ”€ [í•„ìˆ˜] Google Forms API ë³€ê²½ ëŒ€ì‘ (2026.3.31 ëŒ€ë¹„)
â”œâ”€ [Phase 1] ìë™ ì±„ì  ì‹œìŠ¤í…œ (4-6ì£¼)
â”œâ”€ [Phase 1] HOTS ë¬¸í•­ ìƒì„± (2-3ì£¼)
â””â”€ [Phase 1] ì»¤ë®¤ë‹ˆí‹° ë¬¸ì œ ì €ì¥ì†Œ ì„¤ê³„ (ê¸°íš)

2026 Q1 (1-3ì›”)
â”œâ”€ [Phase 1] ì»¤ë®¤ë‹ˆí‹° ë¬¸ì œ ì €ì¥ì†Œ êµ¬í˜„ (6-8ì£¼)
â”œâ”€ [Phase 2] ë‹¤ì¤‘ ì…ë ¥ í˜•ì‹ ì§€ì› (PDF, PPT) (8-10ì£¼)
â””â”€ Google Forms API ë³€ê²½ ìµœì¢… ì ê²€ (3ì›”)

2026 Q2 (4-6ì›”)
â”œâ”€ [Phase 2] ë‹¤ì¤‘ í”Œë«í¼ ë‚´ë³´ë‚´ê¸° (Kahoot, Quizizz) (10-12ì£¼)
â””â”€ [Phase 2] ì‹¤ì‹œê°„ í˜•ì„±í‰ê°€ ëª¨ë“œ (8-10ì£¼)

2026 Q3 (7-9ì›”)
â”œâ”€ [Phase 3] ì ì‘í˜• í•™ìŠµ ê²½ë¡œ (12-16ì£¼)
â””â”€ [Phase 3] ê³ ê¸‰ ë¶„ì„ ëŒ€ì‹œë³´ë“œ (10-12ì£¼)

2026 Q4 (10-12ì›”)
â”œâ”€ [Phase 3] ì†ê¸€ì”¨ ë‹µì•ˆ ì¸ì‹ ë° ì±„ì  (12-16ì£¼)
â””â”€ ì•ˆì •í™” ë° ìµœì í™”

2027 Q1-Q2 (1-6ì›”)
â”œâ”€ [Phase 4] í•™ë¶€ëª¨ í¬í„¸
â”œâ”€ [Phase 4] í•™ìƒ ìê¸°ì£¼ë„ í•™ìŠµ ëª¨ë“œ
â””â”€ [Phase 4] NEIS ì—°ë™ (ê°€ëŠ¥ì„± ê²€í† )
```

---

### ğŸ’° ì˜ˆìƒ ë¹„ìš© ë° ë¦¬ì†ŒìŠ¤

#### ê°œë°œ ì¸ë ¥
- **í’€ìŠ¤íƒ ê°œë°œì**: 2ëª… (ë°±ì—”ë“œ 1ëª…, í”„ë¡ íŠ¸ì—”ë“œ 1ëª…)
- **AI/ML ì—”ì§€ë‹ˆì–´**: 1ëª… (ì±„ì  ì‹œìŠ¤í…œ, ì ì‘í˜• í•™ìŠµ)
- **UI/UX ë””ìì´ë„ˆ**: 1ëª…
- **ì´ ì¸ë ¥**: 4ëª…

#### ì™¸ë¶€ ì„œë¹„ìŠ¤ ë¹„ìš© (ì›”ê°„)
- **Google Cloud Platform**:
  - Forms API: ë¬´ë£Œ (í• ë‹¹ëŸ‰ ë‚´)
  - Vision API (OCR): ~$150/ì›” (1,000ì¥ ê¸°ì¤€)
  - Gemini AI API: ~$500/ì›” (ëŒ€ëŸ‰ ì‚¬ìš© ì‹œ)
- **Firebase**:
  - Firestore: ~$200/ì›”
  - Hosting: ~$50/ì›”
  - Authentication: ë¬´ë£Œ (10ë§Œ ì‚¬ìš©ìê¹Œì§€)
- **Vercel**: ~$20/ì›” (Pro í”Œëœ)
- **ì´ ì›”ê°„ ë¹„ìš©**: ~$920/ì›” (ì•½ 120ë§Œì›)

#### ì—°ê°„ ì˜ˆì‚° (1ì°¨ ì—°ë„)
- ê°œë°œ ì¸ë ¥: 4ëª… Ã— ì›” í‰ê·  600ë§Œì› Ã— 12ê°œì›” = **2ì–µ 8,800ë§Œì›**
- ì™¸ë¶€ ì„œë¹„ìŠ¤: 120ë§Œì› Ã— 12ê°œì›” = **1,440ë§Œì›**
- ë§ˆì¼€íŒ… ë° ìš´ì˜: **5,000ë§Œì›**
- **ì´ ì˜ˆì‚°**: ì•½ **3ì–µ 5,000ë§Œì›**

---

## ê¸°ëŒ€ íš¨ê³¼

### ğŸ“Š ì •ëŸ‰ì  íš¨ê³¼

#### êµì‚¬ ì‹œê°„ ì ˆì•½
- **í€´ì¦ˆ ì œì‘**: 40-60ë¶„ â†’ **5ë¶„ ì´í•˜** (90% ì ˆê°)
- **ì±„ì **: 30ë¶„ â†’ **5ë¶„ ì´í•˜** (83% ì ˆê°)
- **ì „ì²´ í‰ê°€ í”„ë¡œì„¸ìŠ¤**: **í‰ê·  75% ì‹œê°„ ë‹¨ì¶•**

#### ì‹œì¥ ì ìœ ìœ¨
- **íƒ€ê²Ÿ ì‹œì¥**: í•œêµ­ êµì‚¬ 40ë§Œëª…
- **1ì°¨ ë…„ë„ ëª©í‘œ**: 5% ì ìœ  (2ë§Œëª…)
- **2ì°¨ ë…„ë„ ëª©í‘œ**: 15% ì ìœ  (6ë§Œëª…)
- **3ì°¨ ë…„ë„ ëª©í‘œ**: 30% ì ìœ  (12ë§Œëª…)

#### ìˆ˜ìµ ëª¨ë¸
**Freemium ì „ëµ:**
- **ë¬´ë£Œ í”Œëœ**: ê¸°ë³¸ AI í€´ì¦ˆ ìƒì„± (ì›” 10íšŒ)
- **ë² ì´ì§ í”Œëœ**: $9.99/ì›” (ë¬´ì œí•œ ìƒì„± + ìë™ ì±„ì )
- **í”„ë¦¬ë¯¸ì—„ í”Œëœ**: $19.99/ì›” (HOTS + ë¶„ì„ + ì»¤ë®¤ë‹ˆí‹°)
- **í•™êµ í”Œëœ**: $299/ë…„ (í•™êµ ì „ì²´ êµì‚¬ ë¬´ì œí•œ)

**ì˜ˆìƒ ë§¤ì¶œ (3ì°¨ ë…„ë„):**
- ìœ ë£Œ ì „í™˜ìœ¨: 20% (24,000ëª…)
- í‰ê·  ARPU: $12/ì›”
- **ì—°ê°„ ë§¤ì¶œ**: 24,000ëª… Ã— $12 Ã— 12ê°œì›” = **$3,456,000 (ì•½ 45ì–µì›)**

---

### ğŸ“ ì •ì„±ì  íš¨ê³¼

#### êµìœ¡ì˜ ì§ˆ í–¥ìƒ
- ê³ ì°¨ì› ì‚¬ê³ ë ¥ ì¤‘ì‹¬ í‰ê°€ í™•ëŒ€
- ë°ì´í„° ê¸°ë°˜ ë§ì¶¤í˜• êµìœ¡ ê°€ëŠ¥
- ì¦‰ê°ì  í”¼ë“œë°±ìœ¼ë¡œ í•™ìŠµ íš¨ìœ¨ ì¦ëŒ€

#### êµì‚¬ ì—…ë¬´ íš¨ìœ¨í™”
- í–‰ì • ì—…ë¬´ ë¶€ë‹´ ê°ì†Œ â†’ êµìœ¡ ë³¸ì§ˆì— ì§‘ì¤‘
- ì°½ì˜ì  êµìˆ˜ë²• ê°œë°œ ì‹œê°„ í™•ë³´
- êµì‚¬ í˜‘ì—… ë¬¸í™” ì¡°ì„±

#### í•™ìƒ í•™ìŠµ ê²½í—˜ ê°œì„ 
- ê°œì¸í™”ëœ í•™ìŠµ ê²½ë¡œ
- ì¦‰ì‹œ í”¼ë“œë°±ì„ í†µí•œ ë¹ ë¥¸ ê°œì„ 
- ê²Œì´ë¯¸í”¼ì¼€ì´ì…˜ìœ¼ë¡œ ì°¸ì—¬ë„ í–¥ìƒ

#### í•œêµ­ êµìœ¡ ìƒíƒœê³„ ê¸°ì—¬
- ì •ë¶€ AI êµìœ¡ ì •ì±… ì§€ì›
- êµì‚¬ AI ì—­ëŸ‰ ê°•í™”
- êµìœ¡ ê²©ì°¨ í•´ì†Œ (ë¬´ë£Œ/ì €ë ´í•œ AI ë„êµ¬ ì œê³µ)

---

## ê²°ë¡  ë° ì œì–¸

### ğŸ¯ í•µì‹¬ ë©”ì‹œì§€

1. **ì‹œì¥ ê¸°íšŒëŠ” ì§€ê¸ˆ**: ì •ë¶€ì˜ 7,400ì–µì› AI êµìœ¡ íˆ¬ì + 2026ë…„ êµì‚¬ ë””ì§€í„¸ êµìœ¡ ì˜ë¬´í™”
2. **ê¸°ìˆ ì  ìš°ìœ„ í™•ë³´**: Gemini 2.0-flash-latest ê¸°ë°˜ ì°¨ë³„í™”ëœ AI ê¸°ëŠ¥
3. **í•œêµ­ êµìœ¡ íŠ¹í™”**: í•œêµ­ì–´ ì™„ì „ ì§€ì› + KERIS í”„ë ˆì„ì›Œí¬ ì •ë ¬ + ì»¤ë®¤ë‹ˆí‹° ì¤‘ì‹¬
4. **ë‹¨ê³„ì  ì„±ì¥**: Phase 1-4 ë¡œë“œë§µìœ¼ë¡œ ì•ˆì •ì  ê¸°ëŠ¥ í™•ì¥

### ğŸš€ ìš°ì„  ì‹¤í–‰ ê³¼ì œ (í–¥í›„ 3ê°œì›”)

#### Critical (ì¦‰ì‹œ ì°©ìˆ˜)
1. âœ… **Google Forms API ë³€ê²½ ëŒ€ì‘** (2026.3.31 ì „ê¹Œì§€ í•„ìˆ˜)
2. â­ **ìë™ ì±„ì  ì‹œìŠ¤í…œ** (êµì‚¬ #1 ë‹ˆì¦ˆ)
3. â­ **HOTS ë¬¸í•­ ìƒì„±** (êµìœ¡ì˜ ì§ˆ í–¥ìƒ)

#### High Priority (Q4 2025)
4. â­ **ì»¤ë®¤ë‹ˆí‹° ë¬¸ì œ ì €ì¥ì†Œ** (ì°¨ë³„í™” + ì»¤ë®¤ë‹ˆí‹° í™œì„±í™”)
5. ğŸ”¶ **ë‹¤ì¤‘ ì…ë ¥ í˜•ì‹ ì§€ì›** (PDF ìš°ì„ )

### ğŸ’¡ ì„±ê³µì„ ìœ„í•œ í•µì‹¬ ì „ëµ

1. **êµì‚¬ ì»¤ë®¤ë‹ˆí‹° ìš°ì„ **: í¬ì»¤ìŠ¤íŒ¡ AIì²˜ëŸ¼ ì»¤ë®¤ë‹ˆí‹°ê°€ ì„±ê³µì˜ ì—´ì‡ 
2. **ë¬´ë£Œ + í”„ë¦¬ë¯¸ì—„ ì „ëµ**: ì •ë¶€ ì •ì±… í™œìš© + ìˆ˜ìµ ëª¨ë¸ ë³‘í–‰
3. **ì„œìš¸ì‹œêµìœ¡ì²­ íŒŒíŠ¸ë„ˆì‹­**: ê³µì‹ ì¶”ì²œ ë„êµ¬ë¡œ í¬ì§€ì…”ë‹
4. **ì§€ì†ì  AI ëª¨ë¸ ì—…ê·¸ë ˆì´ë“œ**: Gemini ìµœì‹  ëª¨ë¸ ì¦‰ì‹œ ë°˜ì˜

### ğŸ“ Next Steps

1. **ì´í•´ê´€ê³„ì ë¦¬ë·°**: í˜„ì§ êµì‚¬ 10ëª… ì¸í„°ë·° (ë‹ˆì¦ˆ ì¬ê²€ì¦)
2. **ê¸°ìˆ  ê²€ì¦**: Google Forms API ë³€ê²½ í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•
3. **MVP ì •ì˜**: Phase 1 í•µì‹¬ ê¸°ëŠ¥ ìš°ì„ ìˆœìœ„ ì¬ì¡°ì •
4. **ì˜ˆì‚° ìŠ¹ì¸**: 1ì°¨ ë…„ë„ ê°œë°œ ì˜ˆì‚° í™•ì •
5. **íŒ€ êµ¬ì„±**: ê°œë°œì ì±„ìš© ì‹œì‘

---

## ë¶€ë¡

### A. Google Forms API ë³€ê²½ ìƒì„¸ ê°€ì´ë“œ

#### ìƒˆë¡œìš´ API ë©”ì„œë“œ: `forms.setPublishSettings()`

**ìš”ì²­ í˜•ì‹:**
```json
POST https://forms.googleapis.com/v1/forms/{formId}:setPublishSettings

{
  "publishSettings": {
    // ë¹ˆ ê°ì²´ë¡œë„ ê²Œì‹œ ê°€ëŠ¥ (ê¸°ë³¸ê°’: published)
  }
}
```

**ì‘ë‹µ í˜•ì‹:**
```json
{
  "formId": "1a2b3c4d5e6f",
  "publishSettings": {
    "published": true
  }
}
```

**ì—ëŸ¬ ì²˜ë¦¬:**
```typescript
try {
  await publishForm(formId, accessToken);
} catch (error) {
  if (error.code === 403) {
    // ê¶Œí•œ ì—†ìŒ: OAuth ìŠ¤ì½”í”„ í™•ì¸
    console.error("Insufficient permissions to publish form");
  } else if (error.code === 404) {
    // í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
    console.error("Form not found");
  } else {
    // ê¸°íƒ€ ì—ëŸ¬
    console.error("Unknown error:", error);
  }

  // ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
  throw new Error("Failed to publish form. Please try again.");
}
```

---

### B. ì°¸ê³  ìë£Œ

#### ê³µì‹ ë¬¸ì„œ
- [Google Forms API - Publish Form Guide](https://developers.google.com/workspace/forms/api/guides/publish-form)
- [Google Forms API - setPublishSettings](https://developers.google.com/workspace/forms/api/reference/rest/v1/forms/setPublishSettings)
- [Google Drive API - Permissions](https://developers.google.com/workspace/drive/api/reference/rest/v3/permissions)

#### ì‹œì¥ ì¡°ì‚¬ ì¶œì²˜
- EdTech ì‹œì¥ ë³´ê³ ì„œ (2024-2025)
- KERIS í•œêµ­êµìœ¡í•™ìˆ ì •ë³´ì› AI ì—­ëŸ‰ í”„ë ˆì„ì›Œí¬
- í•œêµ­ êµìœ¡ë¶€ ë””ì§€í„¸ êµìœ¡ ì •ì±… ë°±ì„œ
- êµì‚¬ ë‹ˆì¦ˆ ì„¤ë¬¸ ì¡°ì‚¬ (Kahoot, Quizizz, Quizlet ì‚¬ìš©ì ë¦¬ë·° ë¶„ì„)

---

**ë¬¸ì„œ ë²„ì „**: 1.0
**ì‘ì„±ì¼**: 2025ë…„ 11ì›” 3ì¼
**ì‘ì„±ì**: Claude (Anthropic) + Moon-Jung Kim
**ë‹¤ìŒ ì—…ë°ì´íŠ¸**: 2026ë…„ 1ì›” (Phase 1 ì™„ë£Œ í›„)

---

## ğŸ™‹â€â™‚ï¸ ë¬¸ì˜ ë° í”¼ë“œë°±

ì´ ì œì•ˆì„œì— ëŒ€í•œ ì§ˆë¬¸ì´ë‚˜ ì˜ê²¬ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì—°ë½ ì£¼ì„¸ìš”!

**Contact:**
- ğŸ“§ Email: [Your Email]
- ğŸ’¬ Kakao: [ê°œë°œì ì—°ë½í•˜ê¸°](https://open.kakao.com/o/gubGYQ7g)
- ğŸŒ Website: https://forms.teaboard.link

**GitHub Repository:**
- https://github.com/reallygood83/forms4labs

---

**ê°ì‚¬í•©ë‹ˆë‹¤! í•¨ê»˜ í•œêµ­ êµìœ¡ì˜ ë¯¸ë˜ë¥¼ ë§Œë“¤ì–´ê°‘ì‹œë‹¤! ğŸš€ğŸ“š**



================================================
FILE: scripts/generate-og-image.mjs
================================================
import { writeFileSync } from 'fs';
import { ImageResponse } from '@vercel/og';

async function generateOGImage() {
  const imageResponse = new ImageResponse(
    {
      type: 'div',
      props: {
        style: {
          height: '100%',
          width: '100%',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          backgroundColor: '#000000',
          backgroundImage: 'linear-gradient(135deg, #000000 0%, #1a1a1a 100%)',
        },
        children: [
          // Icon
          {
            type: 'div',
            props: {
              style: {
                display: 'flex',
                width: '160px',
                height: '160px',
                backgroundColor: 'white',
                borderRadius: '32px',
                alignItems: 'center',
                justifyContent: 'center',
                marginBottom: '48px',
                boxShadow: '0 20px 50px rgba(37, 99, 235, 0.3)',
              },
              children: {
                type: 'svg',
                props: {
                  width: '100',
                  height: '100',
                  viewBox: '0 0 100 100',
                  style: {
                    fill: '#2563eb',
                  },
                  children: [
                    {
                      type: 'rect',
                      props: { x: '20', y: '10', width: '60', height: '80', rx: '6', fill: '#2563eb' }
                    },
                    {
                      type: 'rect',
                      props: { x: '30', y: '25', width: '40', height: '5', rx: '2', fill: 'white' }
                    },
                    {
                      type: 'rect',
                      props: { x: '30', y: '40', width: '40', height: '5', rx: '2', fill: 'white' }
                    },
                    {
                      type: 'rect',
                      props: { x: '30', y: '55', width: '40', height: '5', rx: '2', fill: 'white' }
                    },
                    {
                      type: 'circle',
                      props: { cx: '68', cy: '78', r: '12', fill: 'white' }
                    },
                    {
                      type: 'path',
                      props: {
                        d: 'M 64 78 L 67 81 L 72 76',
                        stroke: '#2563eb',
                        strokeWidth: '3',
                        fill: 'none',
                        strokeLinecap: 'round',
                        strokeLinejoin: 'round',
                      }
                    },
                  ],
                },
              },
            },
          },
          // Title
          {
            type: 'div',
            props: {
              style: {
                fontSize: '72px',
                fontWeight: 'bold',
                color: 'white',
                marginBottom: '24px',
                textAlign: 'center',
                letterSpacing: '-0.02em',
              },
              children: 'Teaboard Forms',
            },
          },
          // Subtitle
          {
            type: 'div',
            props: {
              style: {
                fontSize: '36px',
                color: '#94a3b8',
                textAlign: 'center',
                maxWidth: '900px',
                lineHeight: 1.4,
              },
              children: 'AI ê¸°ë°˜ êµ¬ê¸€í¼ ìë™ ìƒì„±',
            },
          },
          // Features
          {
            type: 'div',
            props: {
              style: {
                display: 'flex',
                gap: '40px',
                marginTop: '48px',
              },
              children: [
                {
                  type: 'div',
                  props: {
                    style: {
                      display: 'flex',
                      alignItems: 'center',
                      gap: '12px',
                      fontSize: '24px',
                      color: '#2563eb',
                    },
                    children: [
                      {
                        type: 'div',
                        props: {
                          style: {
                            width: '8px',
                            height: '8px',
                            borderRadius: '50%',
                            backgroundColor: '#2563eb',
                          },
                        },
                      },
                      'í€´ì¦ˆ ìë™ ìƒì„±',
                    ],
                  },
                },
                {
                  type: 'div',
                  props: {
                    style: {
                      display: 'flex',
                      alignItems: 'center',
                      gap: '12px',
                      fontSize: '24px',
                      color: '#2563eb',
                    },
                    children: [
                      {
                        type: 'div',
                        props: {
                          style: {
                            width: '8px',
                            height: '8px',
                            borderRadius: '50%',
                            backgroundColor: '#2563eb',
                          },
                        },
                      },
                      'ì„¤ë¬¸ì¡°ì‚¬ ìƒì„±',
                    ],
                  },
                },
                {
                  type: 'div',
                  props: {
                    style: {
                      display: 'flex',
                      alignItems: 'center',
                      gap: '12px',
                      fontSize: '24px',
                      color: '#2563eb',
                    },
                    children: [
                      {
                        type: 'div',
                        props: {
                          style: {
                            width: '8px',
                            height: '8px',
                            borderRadius: '50%',
                            backgroundColor: '#2563eb',
                          },
                        },
                      },
                      'Gemini AI í™œìš©',
                    ],
                  },
                },
              ],
            },
          },
        ],
      },
    },
    {
      width: 1200,
      height: 630,
    }
  );

  const imageBuffer = await imageResponse.arrayBuffer();
  writeFileSync('public/opengraph-image.png', Buffer.from(imageBuffer));
  console.log('âœ… OG ì´ë¯¸ì§€ê°€ public/opengraph-image.pngì— ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
}

generateOGImage().catch(console.error);



================================================
FILE: src/app/globals.css
================================================
@import "tailwindcss";

@plugin "tailwindcss-animate";

@custom-variant dark (&:is(.dark *));

:root {
  --accent: oklch(0.97 0 0); /* gold */
  --muted: oklch(0.97 0 0);
  --card: oklch(1 0 0);
  --radius: 0.625rem;
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.85 0 0);
  --input: oklch(0.85 0 0);
  --ring: oklch(0.7 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-accent: var(--accent);
  --color-muted: var(--muted);
  --color-card: var(--card);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-muted-foreground: var(--muted-foreground);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

@media (prefers-color-scheme: dark) {
  :root {
    --accent: #d4af37;
    --muted: #121212;
    --card: #0f0f0f;
  }
}

/* Subtle transitions and selection styling */
* { transition: color 160ms ease, background-color 160ms ease, border-color 160ms ease; }

::selection { background: var(--accent); color: #000; }

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.205 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.205 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(0.4 0 0);
  --input: oklch(0.4 0 0);
  --ring: oklch(0.6 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.556 0 0);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
  
  /* ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ ê°œì„  */
  input, textarea, select {
    @apply bg-background border-border;
  }
  
  /* ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ ê°œì„  */
  .card {
    @apply bg-card text-card-foreground border-border;
  }
}



================================================
FILE: src/app/kakao-meta.tsx
================================================
export default function KakaoMeta() {
  return (
    <>
      <meta property="og:type" content="website" />
      <meta property="og:site_name" content="Teaboard Forms" />
      <meta property="og:title" content="Teaboard Forms - AI ê¸°ë°˜ êµ¬ê¸€í¼ ìë™ ìƒì„±" />
      <meta property="og:description" content="AIë¥¼ í™œìš©í•˜ì—¬ í€´ì¦ˆì™€ ì„¤ë¬¸ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  êµ¬ê¸€ í¼ìœ¼ë¡œ ì¦‰ì‹œ ë°°í¬í•˜ì„¸ìš”." />
      <meta property="og:image" content="https://forms.teaboard.link/opengraph-image.png" />
      <meta property="og:image:width" content="1200" />
      <meta property="og:image:height" content="630" />
      <meta property="og:url" content="https://forms.teaboard.link" />
      <meta property="og:locale" content="ko_KR" />
    </>
  );
}



================================================
FILE: src/app/layout.tsx
================================================
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import SessionWrapper from "@/components/session-provider";
import KakaoMeta from "./kakao-meta";
import { Navbar } from '@/components/Navbar';

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  metadataBase: new URL('https://forms.teaboard.link'),
  title: "Teaboard Forms - AI ê¸°ë°˜ êµ¬ê¸€í¼ ìë™ ìƒì„±",
  description: "AIë¥¼ í™œìš©í•˜ì—¬ í€´ì¦ˆì™€ ì„¤ë¬¸ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  êµ¬ê¸€ í¼ìœ¼ë¡œ ì¦‰ì‹œ ë°°í¬í•˜ì„¸ìš”. Gemini AIë¡œ êµìœ¡ìš© í€´ì¦ˆì™€ ì „ë¬¸ ì„¤ë¬¸ì¡°ì‚¬ë¥¼ ì†ì‰½ê²Œ ì œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
  keywords: ["êµ¬ê¸€í¼", "AI", "í€´ì¦ˆ ìƒì„±", "ì„¤ë¬¸ì¡°ì‚¬", "Gemini", "êµìœ¡", "ìë™í™”"],
  authors: [{ name: "Teaboard" }],
  creator: "Teaboard",
  publisher: "Teaboard",
  icons: {
    icon: [
      { url: "/favicon.svg", type: "image/svg+xml" },
      { url: "/favicon.ico", sizes: "any" }
    ],
    apple: "/apple-touch-icon.png",
  },
  openGraph: {
    type: "website",
    locale: "ko_KR",
    url: "https://forms.teaboard.link",
    title: "Teaboard Forms - AI ê¸°ë°˜ êµ¬ê¸€í¼ ìë™ ìƒì„±",
    description: "AIë¥¼ í™œìš©í•˜ì—¬ í€´ì¦ˆì™€ ì„¤ë¬¸ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  êµ¬ê¸€ í¼ìœ¼ë¡œ ì¦‰ì‹œ ë°°í¬í•˜ì„¸ìš”.",
    siteName: "Teaboard Forms",
    images: [
      {
        url: "https://forms.teaboard.link/opengraph-image.png",
        width: 1200,
        height: 630,
        alt: "Teaboard Forms - AI ê¸°ë°˜ êµ¬ê¸€í¼ ìë™ ìƒì„±",
      },
    ],
  },
  twitter: {
    card: "summary_large_image",
    title: "Teaboard Forms - AI ê¸°ë°˜ êµ¬ê¸€í¼ ìë™ ìƒì„±",
    description: "AIë¥¼ í™œìš©í•˜ì—¬ í€´ì¦ˆì™€ ì„¤ë¬¸ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  êµ¬ê¸€ í¼ìœ¼ë¡œ ì¦‰ì‹œ ë°°í¬í•˜ì„¸ìš”.",
    images: ["https://forms.teaboard.link/opengraph-image.png"],
  },
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="ko">
      <head>
        <KakaoMeta />
      </head>
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <SessionWrapper>
          <Navbar />
          {children}
        </SessionWrapper>
      </body>
    </html>
  );
}



================================================
FILE: src/app/opengraph-image.tsx
================================================
import { ImageResponse } from 'next/og';

export const runtime = 'edge';
export const alt = 'Teaboard Forms - AI ê¸°ë°˜ êµ¬ê¸€í¼ ìë™ ìƒì„±';
export const size = {
  width: 1200,
  height: 630,
};
export const contentType = 'image/png';

export default async function Image() {
  return new ImageResponse(
    (
      <div
        style={{
          height: '100%',
          width: '100%',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          backgroundColor: '#000000',
          backgroundImage: 'linear-gradient(135deg, #000000 0%, #1a1a1a 100%)',
        }}
      >
        {/* Main content */}
        <div
          style={{
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            padding: '80px',
          }}
        >
          {/* Icon */}
          <div
            style={{
              display: 'flex',
              width: '160px',
              height: '160px',
              backgroundColor: 'white',
              borderRadius: '32px',
              alignItems: 'center',
              justifyContent: 'center',
              marginBottom: '48px',
              boxShadow: '0 20px 50px rgba(37, 99, 235, 0.3)',
            }}
          >
            <svg
              width="100"
              height="100"
              viewBox="0 0 100 100"
              style={{
                fill: '#2563eb',
              }}
            >
              <rect x="20" y="10" width="60" height="80" rx="6" fill="#2563eb" />
              <rect x="30" y="25" width="40" height="5" rx="2" fill="white" />
              <rect x="30" y="40" width="40" height="5" rx="2" fill="white" />
              <rect x="30" y="55" width="40" height="5" rx="2" fill="white" />
              <circle cx="68" cy="78" r="12" fill="white" />
              <path
                d="M 64 78 L 67 81 L 72 76"
                stroke="#2563eb"
                strokeWidth="3"
                fill="none"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </svg>
          </div>

          {/* Title */}
          <div
            style={{
              fontSize: '72px',
              fontWeight: 'bold',
              color: 'white',
              marginBottom: '24px',
              textAlign: 'center',
              letterSpacing: '-0.02em',
            }}
          >
            Teaboard Forms
          </div>

          {/* Subtitle */}
          <div
            style={{
              fontSize: '36px',
              color: '#94a3b8',
              textAlign: 'center',
              maxWidth: '900px',
              lineHeight: 1.4,
            }}
          >
            AI ê¸°ë°˜ êµ¬ê¸€í¼ ìë™ ìƒì„±
          </div>

          {/* Features */}
          <div
            style={{
              display: 'flex',
              gap: '40px',
              marginTop: '48px',
            }}
          >
            <div
              style={{
                display: 'flex',
                alignItems: 'center',
                gap: '12px',
                fontSize: '24px',
                color: '#2563eb',
              }}
            >
              <div
                style={{
                  width: '8px',
                  height: '8px',
                  borderRadius: '50%',
                  backgroundColor: '#2563eb',
                }}
              />
              í€´ì¦ˆ ìë™ ìƒì„±
            </div>
            <div
              style={{
                display: 'flex',
                alignItems: 'center',
                gap: '12px',
                fontSize: '24px',
                color: '#2563eb',
              }}
            >
              <div
                style={{
                  width: '8px',
                  height: '8px',
                  borderRadius: '50%',
                  backgroundColor: '#2563eb',
                }}
              />
              ì„¤ë¬¸ì¡°ì‚¬ ìƒì„±
            </div>
            <div
              style={{
                display: 'flex',
                alignItems: 'center',
                gap: '12px',
                fontSize: '24px',
                color: '#2563eb',
              }}
            >
              <div
                style={{
                  width: '8px',
                  height: '8px',
                  borderRadius: '50%',
                  backgroundColor: '#2563eb',
                }}
              />
              Gemini AI í™œìš©
            </div>
          </div>
        </div>
      </div>
    ),
    {
      ...size,
    }
  );
}



================================================
FILE: src/app/page.tsx
================================================
'use client';

import { useSession, signIn } from 'next-auth/react';
import Link from 'next/link';
import { Sparkles, LayoutDashboard, Youtube, MessageCircle, FileText } from 'lucide-react';

export default function Home() {
  const { data: session, status } = useSession();

  return (
    <div className="min-h-screen flex flex-col bg-white">
      {/* Hero Section */}
      <main className="flex-1 flex items-center justify-center px-4 sm:px-6 lg:px-8">
        <div className="max-w-4xl w-full text-center space-y-8 py-12 sm:py-16">
          {/* Title */}
          <div className="space-y-4">
            <h1 className="text-5xl sm:text-6xl lg:text-7xl font-bold tracking-tight uppercase">
              TeaBoard Forms
            </h1>
            <p className="text-xl sm:text-2xl text-gray-600 font-medium">
              AI ê¸°ë°˜ í€´ì¦ˆ ë° ì„¤ë¬¸ ìƒì„±ê¸°ë¡œ ì—…ë¬´ ì‹œê°„ì„ 90% ì ˆê°í•˜ì„¸ìš”
            </p>
          </div>

          {/* Personalized Greeting or Login */}
          {status === 'loading' ? (
            <div className="py-4">
              <div className="h-8 w-48 mx-auto bg-gray-200 animate-pulse rounded"></div>
            </div>
          ) : session?.user ? (
            <div className="py-4">
              <p className="text-2xl font-semibold text-gray-800">
                {session.user.name || session.user.email}ë‹˜ ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹
              </p>
            </div>
          ) : null}

          {/* Action Buttons - Chanel Style */}
          <div className="flex flex-col sm:flex-row gap-4 justify-center items-center max-w-2xl mx-auto">
            {session?.user ? (
              <>
                {/* Dashboard Button */}
                <Link
                  href="/dashboard"
                  className="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 border-2 border-black bg-white text-black font-semibold uppercase tracking-wide hover:bg-black hover:text-white transition-all duration-200 rounded-none shadow-sm"
                >
                  <LayoutDashboard className="h-5 w-5" />
                  ëŒ€ì‹œë³´ë“œ
                </Link>

                {/* Create Form Button */}
                <Link
                  href="/create"
                  className="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 border-2 border-black bg-black text-white font-semibold uppercase tracking-wide hover:bg-white hover:text-black transition-all duration-200 rounded-none shadow-sm"
                >
                  <Sparkles className="h-5 w-5" />
                  í€´ì¦ˆ/ì„¤ë¬¸ ìƒì„±í•˜ê¸°
                </Link>
              </>
            ) : (
              <>
                {/* Login Button */}
                <button
                  onClick={() => signIn('google')}
                  className="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 border-2 border-black bg-white text-black font-semibold uppercase tracking-wide hover:bg-black hover:text-white transition-all duration-200 rounded-none shadow-sm"
                >
                  Googleë¡œ ë¡œê·¸ì¸
                </button>

                {/* Create Form Button (Guest) */}
                <Link
                  href="/create"
                  className="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 border-2 border-black bg-black text-white font-semibold uppercase tracking-wide hover:bg-white hover:text-black transition-all duration-200 rounded-none shadow-sm"
                >
                  <Sparkles className="h-5 w-5" />
                  í€´ì¦ˆ/ì„¤ë¬¸ ìƒì„±í•˜ê¸°
                </Link>
              </>
            )}
          </div>

          {/* Features Grid */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12 max-w-3xl mx-auto">
            <div className="p-6 border-2 border-black bg-white">
              <div className="text-4xl mb-3">âš¡</div>
              <h3 className="font-bold text-lg mb-2 uppercase tracking-wide">ë¹ ë¥¸ ìƒì„±</h3>
              <p className="text-sm text-gray-600">AIê°€ ìë™ìœ¼ë¡œ í€´ì¦ˆì™€ ì„¤ë¬¸ì„ ìƒì„±í•©ë‹ˆë‹¤</p>
            </div>
            <div className="p-6 border-2 border-black bg-white">
              <div className="text-4xl mb-3">ğŸ¯</div>
              <h3 className="font-bold text-lg mb-2 uppercase tracking-wide">ì •í™•í•œ ë¶„ì„</h3>
              <p className="text-sm text-gray-600">Gemini AI ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ ë¬¸í•­ ìƒì„±</p>
            </div>
            <div className="p-6 border-2 border-black bg-white">
              <div className="text-4xl mb-3">ğŸ“Š</div>
              <h3 className="font-bold text-lg mb-2 uppercase tracking-wide">ì¦‰ì‹œ ë°°í¬</h3>
              <p className="text-sm text-gray-600">Google Formsë¡œ ë°”ë¡œ ë‚´ë³´ë‚´ê¸°</p>
            </div>
          </div>
        </div>
      </main>

      {/* Footer - Chanel Style */}
      <footer className="border-t-2 border-black bg-white py-8 px-4">
        <div className="max-w-6xl mx-auto">
          <div className="flex flex-col md:flex-row justify-between items-center gap-6">
            {/* Copyright and Legal Links */}
            <div className="text-center md:text-left space-y-2">
              <p className="text-sm font-medium text-gray-800">
                Â© 2025 Moon-Jung Kim. All rights reserved.
              </p>
              <div className="flex gap-4 justify-center md:justify-start">
                <Link
                  href="/terms"
                  className="text-xs text-gray-600 hover:text-black underline underline-offset-2 transition-colors duration-200"
                >
                  ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€
                </Link>
                <span className="text-xs text-gray-400">|</span>
                <Link
                  href="/privacy"
                  className="text-xs text-gray-600 hover:text-black underline underline-offset-2 transition-colors duration-200"
                >
                  ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨
                </Link>
              </div>
            </div>

            {/* Links */}
            <div className="flex flex-col sm:flex-row gap-4 items-center">
              <a
                href="https://www.youtube.com/@%EB%B0%B0%EC%9B%80%EC%9D%98%EB%8B%AC%EC%9D%B8-p5v"
                target="_blank"
                rel="noopener noreferrer"
                className="inline-flex items-center gap-2 px-4 py-2 border-2 border-red-600 bg-white text-red-600 font-semibold text-sm uppercase tracking-wide hover:bg-red-600 hover:text-white transition-all duration-200 rounded-none"
              >
                <Youtube className="h-4 w-4" />
                ë°°ì›€ì˜ ë‹¬ì¸
              </a>
              <a
                href="https://open.kakao.com/o/gubGYQ7g"
                target="_blank"
                rel="noopener noreferrer"
                className="inline-flex items-center gap-2 px-4 py-2 border-2 border-yellow-500 bg-white text-yellow-600 font-semibold text-sm uppercase tracking-wide hover:bg-yellow-500 hover:text-white transition-all duration-200 rounded-none"
              >
                <MessageCircle className="h-4 w-4" />
                ê°œë°œì ì—°ë½í•˜ê¸°
              </a>
              <a
                href="https://pebble-stallion-abb.notion.site/2a010244f99780929827c7d2201f2d98"
                target="_blank"
                rel="noopener noreferrer"
                className="inline-flex items-center gap-2 px-4 py-2 border-2 border-green-600 bg-white text-green-600 font-semibold text-sm uppercase tracking-wide hover:bg-green-600 hover:text-white transition-all duration-200 rounded-none"
              >
                <FileText className="h-4 w-4" />
                í™œìš© ì‹ ì²­
              </a>
            </div>
          </div>
        </div>
      </footer>
    </div>
  );
}



================================================
FILE: src/app/api/ai/preview/route.ts
================================================
import { NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { getAdminDb } from "@/lib/firebase-admin";
import { decryptBYOK } from "@/lib/crypto";

export async function POST() {
  const session = await getServerSession(authOptions);
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const adminDb = getAdminDb();
  const docSnap = await adminDb
    .collection("users")
    .doc(session.user.email)
    .collection("secrets")
    .doc("gemini")
    .get();

  if (!docSnap.exists) {
    return NextResponse.json({ error: "BYOK not set" }, { status: 400 });
  }

  const payload = docSnap.data() as { iv: string; ciphertext: string; tag: string };
  try {
    decryptBYOK(payload);
  } catch {
    return NextResponse.json({ error: "Failed to decrypt BYOK" }, { status: 500 });
  }

  // TODO: Call Gemini API using BYOK and the request body prompt/spec.
  // For now, return a stub preview.
  return NextResponse.json({
    preview: {
      type: "survey",
      title: "ë¯¸ë¦¬ë³´ê¸°: ê³ ê° ë§Œì¡±ë„ ì„¤ë¬¸",
      questions: [
        { kind: "multiple_choice", title: "ì œí’ˆ ë§Œì¡±ë„ëŠ” ì–´ë– ì…¨ë‚˜ìš”?", options: ["ë§¤ìš° ë§Œì¡±", "ë§Œì¡±", "ë³´í†µ", "ë¶ˆë§Œ", "ë§¤ìš° ë¶ˆë§Œ"] },
      ],
    },
  });
}


================================================
FILE: src/app/api/auth/[...nextauth]/route.ts
================================================
import NextAuth from "next-auth";
import { authOptions } from "@/lib/auth";

const handler = NextAuth(authOptions);
export { handler as GET, handler as POST };


================================================
FILE: src/app/api/auth/firebase-token/route.ts
================================================
import { NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { getAdminAuth } from "@/lib/firebase-admin";

export async function POST() {
  const session = await getServerSession(authOptions);
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  try {
    const uid = `nextauth:${session.user.email}`;
    const adminAuth = getAdminAuth();
    const token = await adminAuth.createCustomToken(uid);
    return NextResponse.json({ token });
  } catch (e: unknown) {
    const errorMessage = e instanceof Error ? e.message : "Admin not configured";
    return NextResponse.json({ error: errorMessage }, { status: 500 });
  }
}


================================================
FILE: src/app/api/forms/create/route.ts
================================================
import { NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { google } from "googleapis";

import { authOptions } from "@/lib/auth";
import {
  buildBatchUpdateRequestsFromSpec,
  type FormSpec,
} from "@/lib/form-spec";
import {
  getGoogleTokens,
  upsertGoogleTokens,
} from "@/lib/google-tokens";
import { publishForm, updateAndEnsurePublished } from "@/lib/google-forms-api";

function assertGoogleOAuthConfig() {
  const clientId = process.env.GOOGLE_CLIENT_ID;
  const clientSecret = process.env.GOOGLE_CLIENT_SECRET;
  if (!clientId || !clientSecret) {
    throw new Error("Google OAuth í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
  }
  return { clientId, clientSecret };
}

async function ensureFreshAccessToken(
  client: InstanceType<typeof google.auth.OAuth2>,
  email: string,
) {
  const credentials = client.credentials;
  const shouldRefresh =
    !credentials.access_token ||
    (credentials.expiry_date !== undefined &&
      credentials.expiry_date !== null &&
      credentials.expiry_date <= Date.now() + 60_000);

  if (shouldRefresh) {
    const refreshed = await client.refreshAccessToken();
    const updated = refreshed.credentials;
    client.setCredentials(updated);
    await upsertGoogleTokens(email, {
      accessToken: updated.access_token ?? null,
      refreshToken: updated.refresh_token ?? credentials.refresh_token ?? null,
      expiresAt: updated.expiry_date ?? null,
    });
    return updated.access_token;
  }

  await upsertGoogleTokens(email, {
    accessToken: credentials.access_token ?? null,
    refreshToken: credentials.refresh_token ?? null,
    expiresAt: credentials.expiry_date ?? null,
  });
  return credentials.access_token;
}

function validateFormSpec(payload: unknown): FormSpec {
  if (
    !payload ||
    typeof payload !== "object" ||
    Array.isArray(payload)
  ) {
    throw new Error("FormSpec JSONì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
  }
  const spec = payload as Partial<FormSpec>;
  if (!spec.title || typeof spec.title !== "string") {
    throw new Error("í¼ ì œëª©(title)ì´ í•„ìš”í•©ë‹ˆë‹¤.");
  }
  if (!Array.isArray(spec.items) || spec.items.length === 0) {
    throw new Error("ìµœì†Œ 1ê°œì˜ ì§ˆë¬¸(items)ì´ í•„ìš”í•©ë‹ˆë‹¤.");
  }
  return spec as FormSpec;
}

export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤." }, { status: 401 });
  }

  let spec: FormSpec;
  try {
    const body = await req.json();
    spec = validateFormSpec(body);
  } catch (error) {
    return NextResponse.json(
      { error: error instanceof Error ? error.message : "ìœ íš¨í•˜ì§€ ì•Šì€ ìš”ì²­ì…ë‹ˆë‹¤." },
      { status: 400 },
    );
  }

  try {
    const storedTokens = await getGoogleTokens(session.user.email);
    if (!storedTokens?.refreshToken) {
      return NextResponse.json(
        {
          error:
            "Google ì¸ì¦ í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ì—¬ ê¶Œí•œì„ ë¶€ì—¬í•´ì£¼ì„¸ìš”.",
        },
        { status: 400 },
      );
    }

    const { clientId, clientSecret } = assertGoogleOAuthConfig();
    const oauth2Client = new google.auth.OAuth2(clientId, clientSecret);
    oauth2Client.setCredentials({
      access_token: session.accessToken ?? storedTokens.accessToken ?? undefined,
      refresh_token: storedTokens.refreshToken,
      expiry_date: storedTokens.expiresAt ?? undefined,
    });

    oauth2Client.on("tokens", async (tokens) => {
      await upsertGoogleTokens(session.user!.email!, {
        accessToken: tokens.access_token ?? storedTokens.accessToken ?? null,
        refreshToken: tokens.refresh_token ?? storedTokens.refreshToken ?? null,
        expiresAt: tokens.expiry_date ?? storedTokens.expiresAt ?? null,
      });
    });

    const accessToken = await ensureFreshAccessToken(
      oauth2Client,
      session.user.email,
    );

    if (!accessToken) {
      throw new Error("Google ì•¡ì„¸ìŠ¤ í† í°ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
    }

    const forms = google.forms({ version: "v1", auth: oauth2Client });

    // 1ë‹¨ê³„: í¼ ìƒì„±
    console.log("ğŸ“ Creating Google Form...");
    const createResponse = await forms.forms.create({
      requestBody: {
        info: {
          title: spec.title,
          documentTitle: spec.title,
        },
      },
    });

    const formId = createResponse.data.formId;
    if (!formId) {
      throw new Error("Google Forms APIì—ì„œ formIdë¥¼ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
    }
    console.log(`âœ… Form created with ID: ${formId}`);

    // 2ë‹¨ê³„: ë°°ì¹˜ ì—…ë°ì´íŠ¸ ì‹¤í–‰
    const requests = buildBatchUpdateRequestsFromSpec(spec);
    if (requests.length) {
      console.log(`ğŸ”„ Updating form ${formId} with ${requests.length} requests...`);
      await updateAndEnsurePublished(formId, requests, oauth2Client);
    } else {
      // ë°°ì¹˜ ì—…ë°ì´íŠ¸ê°€ ì—†ì–´ë„ ë°œí–‰ì€ í•„ìˆ˜ (2026.3.31+ ëŒ€ë¹„)
      console.log(`ğŸ“¤ Publishing form ${formId}...`);
      await publishForm(formId, oauth2Client);
    }

    return NextResponse.json({
      ok: true,
      formId,
      formUrl: `https://docs.google.com/forms/d/${formId}/edit`,
      responderUrl: `https://docs.google.com/forms/d/${formId}/viewform`,
    });
  } catch (error) {
    console.error(
      "[api/forms/create] Google Forms ìƒì„± ì‹¤íŒ¨:",
      error instanceof Error ? error.message : error,
    );
    return NextResponse.json(
      {
        error:
          error instanceof Error
            ? error.message
            : "í¼ ìƒì„± ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
      },
      { status: 500 },
    );
  }
}



================================================
FILE: src/app/api/generate/route.ts
================================================
import { NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { GoogleGenerativeAI } from "@google/generative-ai";

import { authOptions } from "@/lib/auth";
import type { FormSpec } from "@/lib/form-spec";

type GenerationSource = "gemini" | "template" | "gemini-fallback";

function clampQuestionCount(value: unknown, fallback: number) {
  const numeric = Number(value);
  if (Number.isFinite(numeric)) {
    return Math.max(1, Math.min(Math.trunc(numeric), 20));
  }
  return fallback;
}

function buildFallbackQuizSpec(data: Record<string, unknown> | null): FormSpec {
  const {
    title = "ìë™ ìƒì„± í€´ì¦ˆ",
    text = "",
    grade = "",
    count = 5,
    questionType = "mixed",
  } = data ?? {};

  const questionCount = clampQuestionCount(count, 5);
  // 100ì  ë§Œì  ì‹œìŠ¤í…œ: ë¬¸í•­ìˆ˜ì— ë”°ë¼ ë°°ì  ìë™ ê³„ì‚°
  const pointsPerQuestion = Math.round(100 / questionCount);

  const excerpt =
    typeof text === "string" && text.length > 0
      ? text.slice(0, 120)
      : undefined;

  const makeMultipleChoice = (index: number) => ({
    type: "multiple_choice" as const,
    title: `${index + 1}. ${title || "ë¬¸í•­"} (ê°ê´€ì‹)`,
    description: excerpt,
    required: true,
    options: ["ë³´ê¸° 1", "ë³´ê¸° 2", "ë³´ê¸° 3", "ë³´ê¸° 4", "ë³´ê¸° 5"],
    grading: {
      pointValue: pointsPerQuestion,
      correctAnswers: ["ë³´ê¸° 1"],
      explanation: "ì •ë‹µê³¼ í•´ì„¤ì€ ìƒì„± í›„ ììœ ë¡­ê²Œ ìˆ˜ì •í•˜ì„¸ìš”.",
    },
  });

  const makeShortAnswer = (index: number) => ({
    type: "short_answer" as const,
    title: `${index + 1}. ${title || "ë¬¸í•­"} (ë‹¨ë‹µí˜•)`,
    description: excerpt,
    required: true,
    grading: {
      pointValue: pointsPerQuestion,
      expectedAnswer: "ì •ë‹µ ì˜ˆì‹œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.",
      explanation: "ì •ë‹µ ê¸°ì¤€ì€ ìƒì„± í›„ ì§ì ‘ ë³´ì™„í•˜ì„¸ìš”.",
    },
  });

  const items = Array.from({ length: questionCount }).map((_, index) => {
    if (questionType === "multiple_choice") return makeMultipleChoice(index);
    if (questionType === "short_answer") return makeShortAnswer(index);
    return index % 2 === 0
      ? makeMultipleChoice(index)
      : makeShortAnswer(index);
  });

  return {
    title: (typeof title === "string" ? title : null) || "ìë™ ìƒì„± í€´ì¦ˆ",
    description: typeof grade === "string" && grade ? `${grade} ëŒ€ìƒ ê¸°ë³¸ í€´ì¦ˆ` : undefined,
    isQuiz: true,
    items,
  };
}

async function buildGeminiQuizSpec(
  data: Record<string, unknown> | null,
  apiKey: string,
): Promise<FormSpec> {
  const {
    title = "AI í€´ì¦ˆ",
    text = "",
    grade = "",
    count = 5,
    questionType = "mixed",
    difficulty = "medium",
    collectPersonalInfo = false,
  } = data ?? {};

  if (!text || typeof text !== "string" || text.trim().length === 0) {
    throw new Error("ì›ë³¸ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
  }

  const questionCount = clampQuestionCount(count, 5);

  let difficultyPrompt = "";
  switch (difficulty) {
    case "easy":
      difficultyPrompt =
        "ê¸°ë³¸ ê°œë…ì„ ì¤‘ì‹¬ìœ¼ë¡œ, ë‹¨ìˆœí•˜ê³  ëª…í™•í•œ ë¬¸ì œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.";
      break;
    case "hard":
      difficultyPrompt =
        "ê³ ê¸‰ ê°œë…ê³¼ ë³µí•©ì ì¸ ë¬¸ì œë¥¼ í¬í•¨í•˜ì—¬, ì‚¬ê³ ë ¥ì„ ìš”êµ¬í•˜ëŠ” ë¬¸ì œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.";
      break;
    default:
      difficultyPrompt =
        "ê¸°ë³¸ ê°œë…ê³¼ ì‘ìš© ë¬¸ì œë¥¼ ì ì ˆíˆ ì„ì–´ì„œ ìƒì„±í•´ì£¼ì„¸ìš”.";
  }

  let typePrompt = "";
  if (questionType === "mixed") {
    typePrompt =
      "ê°ê´€ì‹(ì„ íƒì§€ 5ê°œ, ì •ë‹µ í¬í•¨)ê³¼ ë‹¨ë‹µí˜• ë¬¸í•­ì„ ì ì ˆíˆ ì„ì–´ì„œ ë§Œë“¤ì–´ì¤˜. ê°ê´€ì‹ì€ ë°˜ë“œì‹œ 5ì§€ ì„ ë‹¤í˜•ì´ì–´ì•¼ í•´.";
  } else if (questionType === "multiple_choice") {
    typePrompt =
      "ëª¨ë“  ë¬¸í•­ì„ ê°ê´€ì‹(ì„ íƒì§€ 5ê°œ, ì •ë‹µ í¬í•¨)ìœ¼ë¡œ ë§Œë“¤ì–´ì¤˜. ë°˜ë“œì‹œ 5ì§€ ì„ ë‹¤í˜•ì´ì–´ì•¼ í•´.";
  } else if (questionType === "short_answer") {
    typePrompt = "ëª¨ë“  ë¬¸í•­ì„ ë‹¨ë‹µí˜•ìœ¼ë¡œ ë§Œë“¤ì–´ì¤˜.";
  }

  const genAI = new GoogleGenerativeAI(apiKey);
  const model = genAI.getGenerativeModel({
    model: "gemini-2.5-flash",
    generationConfig: {
      temperature: difficulty === "hard" ? 0.8 : 0.7,
      maxOutputTokens: 10000, // ğŸ”§ FIX: 8192 â†’ 10000 (ìµœëŒ€ 50ë¬¸ì œ ìƒì„± ì§€ì›, gemini-2.5-flash ìµœëŒ€ì¹˜ í™œìš©)
    }
  });

  const prompt = `
ë‹¤ìŒ í…ìŠ¤íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ '${grade}' ìˆ˜ì¤€ì— ë§ëŠ” í€´ì¦ˆë¥¼ ì´ ${questionCount}ê°œ ìƒì„±í•´ì¤˜.
í€´ì¦ˆ ì œëª©ì€ '${title}'ì´ì•¼.
ê° ë¬¸ì œë§ˆë‹¤ ë°˜ë“œì‹œ í•´ì„¤ì„ í¬í•¨í•´ì¤˜.

${difficultyPrompt}
${typePrompt}

í•„ìˆ˜ ìš”êµ¬ì‚¬í•­:
1. ë¬¸í•­ ê°œìˆ˜ëŠ” ì •í™•íˆ ${questionCount}ê°œì—¬ì•¼ í•´
2. ê°ê´€ì‹ ë¬¸í•­ì€ 5ê°œì˜ ì„ íƒì§€ë¥¼ í¬í•¨í•´ì•¼ í•´
3. ê° ë¬¸ì œë§ˆë‹¤ ê°„ê²°í•œ í•´ì„¤(1-2ë¬¸ì¥)ì„ ì‘ì„±í•´ì¤˜
4. í•´ì„¤ì€ 1-2ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ì •ë‹µ ì´ìœ ë§Œ ì„¤ëª…í•´ì¤˜ (ì˜¤ë‹µ ì„¤ëª…ì€ ë¶ˆí•„ìš”)

ê²°ê³¼ëŠ” ë°˜ë“œì‹œ ì•„ë˜ì™€ ê°™ì€ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•´ì•¼ í•´:
{
  "quizTitle": "${title}",
  "questions": [
    {
      "type": "multiple_choice",
      "question": "ì§ˆë¬¸",
      "options": ["ì„ íƒì§€1", "ì„ íƒì§€2", "ì„ íƒì§€3", "ì„ íƒì§€4", "ì •ë‹µ"],
      "correctAnswer": "ì •ë‹µ",
      "explanation": "ì •ë‹µì´ ì™œ ì •ë‹µì¸ì§€, ë‹¤ë¥¸ ì„ íƒì§€ê°€ ì™œ í‹€ë ¸ëŠ”ì§€ì— ëŒ€í•œ ìƒì„¸í•œ í•´ì„¤"
    },
    {
      "type": "short_answer",
      "question": "ì§ˆë¬¸",
      "expectedAnswer": "ì˜ˆìƒ ì •ë‹µ",
      "explanation": "ë‹µì•ˆ ì‘ì„± ì‹œ ìœ ì˜ì‚¬í•­ê³¼ ì±„ì  ê¸°ì¤€ì— ëŒ€í•œ ìƒì„¸í•œ í•´ì„¤"
    }
  ]
}

--- ì›ë³¸ í…ìŠ¤íŠ¸ ---
${text}
--- í…ìŠ¤íŠ¸ ë ---
`;

  console.log('[api/generate] Quiz - Gemini API í˜¸ì¶œ ì‹œì‘...');
  const result = await model.generateContent(prompt);
  console.log('[api/generate] Quiz - generateContent ì™„ë£Œ');

  const response = await result.response;
  console.log('[api/generate] Quiz - response ê°ì²´ íšë“');

  const generatedText = response.text();
  console.log('[api/generate] Quiz - ì‘ë‹µ í…ìŠ¤íŠ¸ ê¸¸ì´:', generatedText.length);
  console.log('[api/generate] Quiz - ì‘ë‹µ í…ìŠ¤íŠ¸ ì• 200ì:', generatedText.substring(0, 200));

  // ğŸ”§ ULTIMATE FIX: ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ ì™„ì „ ì œê±° + ê´„í˜¸ ë§¤ì¹­
  let jsonString = generatedText.trim();

  console.log('[api/generate] Quiz - ì›ë³¸ ì‘ë‹µ ì „ì²´ ì¶œë ¥ (ë””ë²„ê¹…):', generatedText);

  // Step 1: ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ ì œê±° (```json ë˜ëŠ” ``` ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°)
  if (jsonString.startsWith('```json')) {
    jsonString = jsonString.substring(7); // '```json' ì œê±°
    console.log('[api/generate] Quiz - ```json ì ‘ë‘ì‚¬ ì œê±°');
  } else if (jsonString.startsWith('```')) {
    jsonString = jsonString.substring(3); // '```' ì œê±°
    console.log('[api/generate] Quiz - ``` ì ‘ë‘ì‚¬ ì œê±°');
  }

  // Step 2: ë§ˆí¬ë‹¤ìš´ ë¸”ë¡ ì¢…ë£Œ ì œê±° (``` ë¡œ ëë‚˜ëŠ” ê²½ìš°)
  if (jsonString.endsWith('```')) {
    jsonString = jsonString.substring(0, jsonString.length - 3);
    console.log('[api/generate] Quiz - ``` ì ‘ë¯¸ì‚¬ ì œê±°');
  }

  jsonString = jsonString.trim();

  // Step 3: ì²« ë²ˆì§¸ { ë¶€í„° ì‹œì‘í•˜ë„ë¡ ë³´ì¥
  const firstBrace = jsonString.indexOf('{');
  if (firstBrace > 0) {
    jsonString = jsonString.substring(firstBrace);
    console.log('[api/generate] Quiz - ì²« ë²ˆì§¸ { ì´ì „ ë‚´ìš© ì œê±°');
  }

  // Step 4: ê´„í˜¸ ê· í˜• ë§ì¶”ê¸° - ë§ˆì§€ë§‰ ì™„ì „í•œ } ì°¾ê¸°
  let openBraces = 0;
  let lastValidIndex = -1;

  for (let i = 0; i < jsonString.length; i++) {
    if (jsonString[i] === '{') {
      openBraces++;
    } else if (jsonString[i] === '}') {
      openBraces--;
      if (openBraces === 0) {
        lastValidIndex = i;
        break; // ì²« ë²ˆì§¸ ì™„ì „í•œ JSON ê°ì²´ ì¢…ë£Œì  ë°œê²¬
      }
    }
  }

  if (lastValidIndex !== -1) {
    jsonString = jsonString.substring(0, lastValidIndex + 1);
    console.log('[api/generate] Quiz - ê´„í˜¸ ë§¤ì¹­ìœ¼ë¡œ JSON ì¶”ì¶œ ì™„ë£Œ');
  } else {
    console.log('[api/generate] Quiz - ê´„í˜¸ ë§¤ì¹­ ì‹¤íŒ¨, ì „ì²´ ë¬¸ìì—´ ì‚¬ìš©');
  }

  console.log('[api/generate] Quiz - ìµœì¢… ì¶”ì¶œëœ JSON ê¸¸ì´:', jsonString.length);
  console.log('[api/generate] Quiz - ìµœì¢… JSON ì• 200ì:', jsonString.substring(0, 200));
  console.log('[api/generate] Quiz - ìµœì¢… JSON ë’¤ 200ì:', jsonString.substring(Math.max(0, jsonString.length - 200)));

  let parsed;
  try {
    parsed = JSON.parse(jsonString);
    console.log('[api/generate] Quiz - JSON íŒŒì‹± ì„±ê³µ');
  } catch (parseError) {
    console.error('[api/generate] Quiz - JSON íŒŒì‹± ì‹¤íŒ¨');
    console.error('[api/generate] Quiz - íŒŒì‹± ì‹œë„í•œ ë¬¸ìì—´:', jsonString.substring(0, 500));
    throw new Error(`Gemini ì‘ë‹µì„ JSONìœ¼ë¡œ íŒŒì‹±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${parseError instanceof Error ? parseError.message : 'Unknown error'}`);
  }
  if (!parsed.questions || !Array.isArray(parsed.questions)) {
    throw new Error("Gemini ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
  }

  // ğŸš¨ ë¬¸í•­ ê°œìˆ˜ ì—„ê²© ê²€ì¦ (ì‚¬ìš©ì ìš”ì²­ì‚¬í•­ ë°˜ì˜)
  const actualQuestionCount = parsed.questions.length;
  if (actualQuestionCount !== questionCount) {
    throw new Error(
      `ìš”ì²­í•œ ë¬¸í•­ ê°œìˆ˜(${questionCount}ê°œ)ì™€ ìƒì„±ëœ ë¬¸í•­ ê°œìˆ˜(${actualQuestionCount}ê°œ)ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ` +
      `ë‹¤ì‹œ ìƒì„±í•´ì£¼ì„¸ìš”.`
    );
  }

  // ğŸš¨ í•´ì„¤ í•„ìˆ˜ ê²€ì¦ (í•™ìŠµ íš¨ê³¼ë¥¼ ìœ„í•œ í•„ìˆ˜ ìš”ì†Œ)
  for (let i = 0; i < parsed.questions.length; i++) {
    const question = parsed.questions[i];
    if (!question.explanation || typeof question.explanation !== 'string' || question.explanation.trim().length < 10) {
      throw new Error(
        `${i + 1}ë²ˆ ë¬¸í•­ì˜ í•´ì„¤ì´ ëˆ„ë½ë˜ì—ˆê±°ë‚˜ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ` +
        `ëª¨ë“  ë¬¸í•­ì—ëŠ” ìµœì†Œ 10ì ì´ìƒì˜ ìƒì„¸í•œ í•´ì„¤ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ì‹œ ìƒì„±í•´ì£¼ì„¸ìš”.`
      );
    }
  }

  // 100ì  ë§Œì  ì‹œìŠ¤í…œ: ë¬¸í•­ìˆ˜ì— ë”°ë¼ ë°°ì  ìë™ ê³„ì‚°
  const pointsPerQuestion = Math.round(100 / actualQuestionCount);

  const items = parsed.questions
    .map((question: Record<string, unknown>, index: number) => {
      if (question.type === "multiple_choice") {
        return {
          type: "multiple_choice" as const,
          title: `${index + 1}. ${question.question}`,
          required: true,
          options: question.options ?? [],
          shuffleOptions: true,
          grading: {
            pointValue: pointsPerQuestion,
            correctAnswers: [question.correctAnswer],
            explanation: question.explanation,
          },
        };
      }
      if (question.type === "short_answer") {
        return {
          type: "short_answer" as const,
          title: `${index + 1}. ${question.question}`,
          required: true,
          grading: {
            pointValue: pointsPerQuestion,
            expectedAnswer: question.expectedAnswer,
            explanation: question.explanation,
          },
        };
      }
      return null;
    })
    .filter(Boolean);

  if (!items.length) {
    throw new Error("ìƒì„±ëœ ë¬¸í•­ì´ ì—†ìŠµë‹ˆë‹¤.");
  }

  // ê°œì¸ì •ë³´ ìˆ˜ì§‘ í•„ë“œ ì¶”ê°€ (Apps Script íŒ¨í„´ ì ìš©)
  const personalInfoItems: FormSpec["items"] = [];

  if (collectPersonalInfo) {
    personalInfoItems.push(
      {
        type: "short_answer",
        title: "í•™ë…„",
        description: "ì˜ˆ: 3í•™ë…„, ì¤‘3, ê³ 2",
        required: true,
      },
      {
        type: "short_answer",
        title: "ë°˜",
        description: "ì˜ˆ: 1ë°˜, 2ë°˜",
        required: true,
      },
      {
        type: "short_answer",
        title: "ë²ˆí˜¸",
        description: "ì˜ˆ: 1ë²ˆ, 15ë²ˆ",
        required: true,
      },
      {
        type: "short_answer",
        title: "ì´ë¦„",
        required: true,
      }
    );
  }

  // ê°œì¸ì •ë³´ í•„ë“œë¥¼ í€´ì¦ˆ ë¬¸í•­ ì•ì— ë°°ì¹˜
  const finalItems = [...personalInfoItems, ...items];

  return {
    title: (typeof title === "string" ? title : null) || "AI í€´ì¦ˆ",
    description: typeof grade === "string" && grade ? `${grade} ëŒ€ìƒ ìë™ ìƒì„± í€´ì¦ˆ` : undefined,
    isQuiz: true,
    items: finalItems,
  };
}

function buildFallbackSurveySpec(data: Record<string, unknown> | null): FormSpec {
  const {
    title = "AI ì„¤ë¬¸",
    purpose = "",
    audience = "",
    numQuestions = 5,
    originalText = "",
    collectName = false,
    collectPhone = false,
    collectEmail = false,
  } = data ?? {};

  const questionCount = clampQuestionCount(numQuestions, 5);
  const contextSnippet =
    typeof originalText === "string" && originalText.length > 0
      ? originalText.slice(0, 160)
      : undefined;

  const templates = [
    {
      type: "multiple_choice" as const,
      title: "1. ì „ì²´ ë§Œì¡±ë„ëŠ” ì–´ëŠ ì •ë„ì˜€ë‚˜ìš”?",
      description: purpose ? `ëª©ì : ${purpose}` : undefined,
      required: true,
      options: [
        "ë§¤ìš° ë§Œì¡±",
        "ë§Œì¡±",
        "ë³´í†µ",
        "ë¶ˆë§Œì¡±",
        "ë§¤ìš° ë¶ˆë§Œì¡±",
      ],
    },
    {
      type: "paragraph" as const,
      title: "2. ê°€ì¥ ì¢‹ì•˜ë˜ ì ì€ ë¬´ì—‡ì¸ê°€ìš”?",
      description: audience ? `ëŒ€ìƒ: ${audience}` : undefined,
      required: false,
    },
    {
      type: "paragraph" as const,
      title: "3. ê°œì„ ì´ í•„ìš”í•˜ë‹¤ê³  ëŠë‚€ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ì•Œë ¤ì£¼ì„¸ìš”.",
      description: contextSnippet,
      required: false,
    },
    {
      type: "multiple_choice" as const,
      title: "4. ë‹¤ì‹œ ì°¸ì—¬í•˜ê±°ë‚˜ ì´ìš©í•  ì˜í–¥ì´ ìˆë‚˜ìš”?",
      required: true,
      options: [
        "ë§¤ìš° ê·¸ë ‡ë‹¤",
        "ê·¸ë ‡ë‹¤",
        "ì˜ ëª¨ë¥´ê² ë‹¤",
        "ê·¸ë ‡ì§€ ì•Šë‹¤",
        "ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤",
      ],
    },
    {
      type: "paragraph" as const,
      title: "5. ì¶”ê°€ë¡œ ê³µìœ í•˜ê³  ì‹¶ì€ ì˜ê²¬ì´ ìˆë‹¤ë©´ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.",
      required: false,
    },
    {
      type: "multiple_choice" as const,
      title: "6. ì§€ì¸ì—ê²Œ ì¶”ì²œí•˜ê³  ì‹¶ì€ê°€ìš”?",
      required: true,
      options: ["ë§¤ìš° ì¶”ì²œ", "ì¶”ì²œ", "ë³´í†µ", "ì¶”ì²œí•˜ì§€ ì•ŠìŒ", "ì ˆëŒ€ ì¶”ì²œí•˜ì§€ ì•ŠìŒ"],
    },
    {
      type: "paragraph" as const,
      title: "7. ì„œë¹„ìŠ¤/í”„ë¡œê·¸ë¨ì—ì„œ ê°€ì¥ ì–´ë ¤ì› ë˜ ë¶€ë¶„ì€ ë¬´ì—‡ì¸ê°€ìš”?",
      required: false,
    },
  ];

  const items: FormSpec["items"] = templates.slice(0, questionCount);

  if (collectName) {
    items.push({
      type: "short_answer",
      title: "ì´ë¦„",
      required: false,
    });
  }
  if (collectPhone) {
    items.push({
      type: "short_answer",
      title: "ì—°ë½ì²˜ (ì „í™”ë²ˆí˜¸)",
      required: false,
    });
  }
  if (collectEmail) {
    items.push({
      type: "short_answer",
      title: "ì´ë©”ì¼",
      required: false,
    });
  }

  return {
    title: (typeof title === "string" ? title : null) || "AI ì„¤ë¬¸",
    description: `${typeof purpose === "string" ? purpose : "ì„¤ë¬¸ ëª©ì "} / ëŒ€ìƒ: ${typeof audience === "string" ? audience : "ì „ì²´"}`,
    isQuiz: false,
    items,
  };
}

async function buildGeminiSurveySpec(
  data: Record<string, unknown> | null,
  apiKey: string,
): Promise<FormSpec> {
  const {
    title = "AI ì„¤ë¬¸",
    purpose = "",
    audience = "ì¼ë°˜ ì‚¬ìš©ì",
    numQuestions = 5,
    questionType = "ai_recommended",
    originalText = "",
    collectName = false,
    collectPhone = false,
    collectEmail = false,
  } = data ?? {};

  const questionCount = clampQuestionCount(numQuestions, 5);

  // Build question type instruction
  let typeInstruction = "";
  if (questionType === "multiple_choice") {
    typeInstruction = "ëª¨ë“  ì§ˆë¬¸ì„ ê°ê´€ì‹(multiple_choice)ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.";
  } else if (questionType === "checkbox") {
    typeInstruction = "ëª¨ë“  ì§ˆë¬¸ì„ ì²´í¬ë°•ìŠ¤(checkbox)ë¡œ ì‘ì„±í•˜ì„¸ìš”.";
  } else if (questionType === "dropdown") {
    typeInstruction = "ëª¨ë“  ì§ˆë¬¸ì„ ë“œë¡­ë‹¤ìš´(dropdown)ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.";
  } else if (questionType === "short_answer") {
    typeInstruction = "ëª¨ë“  ì§ˆë¬¸ì„ ë‹¨ë‹µí˜•(short_answer)ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.";
  } else if (questionType === "paragraph") {
    typeInstruction = "ëª¨ë“  ì§ˆë¬¸ì„ ì¥ë¬¸í˜•(paragraph)ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.";
  } else if (questionType === "linear_scale") {
    typeInstruction = `ëª¨ë“  ì§ˆë¬¸ì„ ì„ í˜• ë°°ìœ¨(linear_scale)ë¡œ ì‘ì„±í•˜ì„¸ìš”.
ì„ í˜• ë°°ìœ¨ ì§ˆë¬¸ ìƒì„± ì‹œ, ë°˜ë“œì‹œ options ë°°ì—´ì— ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”:
["1: ë§¤ìš° ê·¸ë ‡ì§€ ì•Šë‹¤", "2: ê·¸ë ‡ì§€ ì•Šë‹¤", "3: ë³´í†µ", "4: ê·¸ë ‡ë‹¤", "5: ë§¤ìš° ê·¸ë ‡ë‹¤"]
ì²™ë„ì˜ ìˆ«ìì™€ ë ˆì´ë¸”ì„ í•¨ê»˜ ì œê³µí•´ì£¼ì„¸ìš”.`;
  } else {
    typeInstruction = `**ë§¤ìš° ì¤‘ìš”**: ë°˜ë“œì‹œ ë‹¤ì–‘í•œ ì§ˆë¬¸ ìœ í˜•ì„ ê³¨ê³ ë£¨ ì‚¬ìš©í•˜ì„¸ìš”!

**í•„ìˆ˜ ì¤€ìˆ˜ ì‚¬í•­**:
- ${questionCount}ê°œ ì§ˆë¬¸ ì¤‘ ìµœì†Œ 3ê°€ì§€ ì´ìƒì˜ ì„œë¡œ ë‹¤ë¥¸ ìœ í˜•ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤
- ê°™ì€ ìœ í˜•ì´ 3ê°œ ì´ìƒ ì—°ì†ë˜ì§€ ì•Šë„ë¡ í•˜ì„¸ìš”
- ì„ í˜• ë°°ìœ¨(linear_scale) ì§ˆë¬¸ì„ ìµœì†Œ 1ê°œ ì´ìƒ ë°˜ë“œì‹œ í¬í•¨í•˜ì„¸ìš”

**ê° ìœ í˜•ë³„ ì‚¬ìš© ê°€ì´ë“œ**:
1. **ê°ê´€ì‹(multiple_choice)**: í•˜ë‚˜ë§Œ ì„ íƒí•˜ëŠ” ì§ˆë¬¸ (ì˜ˆ: ì„±ë³„, ì„ í˜¸ë„ ë“±)
2. **ì²´í¬ë°•ìŠ¤(checkbox)**: ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥í•œ ì§ˆë¬¸ (ì˜ˆ: ê´€ì‹¬ì‚¬, ê²½í—˜ ë“±)
3. **ì„ í˜• ë°°ìœ¨(linear_scale)**: ë§Œì¡±ë„, ë™ì˜ ì •ë„ ì¸¡ì • (1-5ì  ì²™ë„)
   - options ë°°ì—´ í˜•ì‹: ["1: ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤", "2: ê·¸ë ‡ì§€ ì•Šë‹¤", "3: ë³´í†µ", "4: ê·¸ë ‡ë‹¤", "5: ë§¤ìš° ê·¸ë ‡ë‹¤"]
4. **ë‹¨ë‹µí˜•(short_answer)**: ì§§ì€ í…ìŠ¤íŠ¸ ì‘ë‹µ (ì˜ˆ: ì´ë¦„, ê°„ë‹¨í•œ ì˜ê²¬)
5. **ì¥ë¬¸í˜•(paragraph)**: ììœ ë¡­ê²Œ ì˜ê²¬ì„ ì‘ì„±í•˜ëŠ” ì§ˆë¬¸

**ê¶Œì¥ ì§ˆë¬¸ êµ¬ì„± ì˜ˆì‹œ** (${questionCount}ë¬¸í•­ ê¸°ì¤€):
- ê°ê´€ì‹: ${Math.max(1, Math.floor(questionCount * 0.3))}ê°œ
- ì²´í¬ë°•ìŠ¤: ${Math.max(1, Math.floor(questionCount * 0.2))}ê°œ
- ì„ í˜• ë°°ìœ¨: ${Math.max(1, Math.floor(questionCount * 0.2))}ê°œ
- ë‹¨ë‹µí˜•: ${Math.max(1, Math.floor(questionCount * 0.15))}ê°œ
- ì¥ë¬¸í˜•: ${Math.max(1, Math.floor(questionCount * 0.15))}ê°œ`;
  }

  // ë””ë²„ê¹…: API í‚¤ í™•ì¸
  console.log('[api/generate] Survey - Gemini API í‚¤ ê¸¸ì´:', apiKey.length);
  console.log('[api/generate] Survey - API í‚¤ ì• 4ì:', apiKey.substring(0, 4));
  console.log('[api/generate] Survey - API í‚¤ ë’¤ 4ì:', apiKey.substring(apiKey.length - 4));

  const genAI = new GoogleGenerativeAI(apiKey);
  const model = genAI.getGenerativeModel({
    model: "gemini-2.5-flash",
    generationConfig: {
      temperature: 0.7,
      maxOutputTokens: 10000, // ğŸ”§ FIX: 8192 â†’ 10000 (ë§ì€ ë¬¸í•­ ìƒì„± ì§€ì›, gemini-2.5-flash ìµœëŒ€ì¹˜ í™œìš©)
    }
  });

  const prompt = `
# ì—­í• 
ë‹¹ì‹ ì€ [${audience}]ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ì„¤ë¬¸ ì¡°ì‚¬ ì„¤ê³„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. Google Formsì— ì‚¬ìš©í•  ì„¤ë¬¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ì„ë¬´ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.

# ì‘ì—… ì§€ì‹œ
ì•„ë˜ ì œê³µëœ 'ì„¤ë¬¸ ì£¼ì œ', 'ì„¤ë¬¸ ëª©ì ', 'ëŒ€ìƒ ì‘ë‹µì', 'ì›ë³¸ ìë£Œ'ë¥¼ ë°”íƒ•ìœ¼ë¡œ Google Formsì— ì í•©í•œ [${questionCount}]ê°œì˜ ì„¤ë¬¸ ì§ˆë¬¸ ì´ˆì•ˆì„ ìƒì„±í•´ì£¼ì„¸ìš”.
**ê° ì§ˆë¬¸ ì•ì—ëŠ” ë°˜ë“œì‹œ '1. ', '2. 'ì™€ ê°™ì´ ìˆœì„œëŒ€ë¡œ ë²ˆí˜¸ë¥¼ ë¶™ì—¬ì£¼ì„¸ìš”.**

# ë§¥ë½ ì •ë³´
- ì„¤ë¬¸ ì£¼ì œ: ${title}
- ì„¤ë¬¸ ëª©ì : ${purpose || "ì œê³µë˜ì§€ ì•ŠìŒ"}
- ëŒ€ìƒ ì‘ë‹µì: ${audience}
- ì›ë³¸ ìë£Œ: ${originalText || "ì œê³µë˜ì§€ ì•ŠìŒ"}

# ì§ˆë¬¸ ìƒì„± ê°€ì´ë“œë¼ì¸
${typeInstruction}
- ê°ê´€ì‹, ì²´í¬ë°•ìŠ¤, ë“œë¡­ë‹¤ìš´ ì§ˆë¬¸ ìƒì„± ì‹œ, ë‹µë³€ ì„ íƒì§€ë¥¼ 3~5ê°œ í¬í•¨í•´ì£¼ì„¸ìš”. í•„ìš” ì‹œ 'ê¸°íƒ€' ì˜µì…˜ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì„ í˜• ë°°ìœ¨ ì§ˆë¬¸ ìƒì„± ì‹œ, ì²™ë„ì˜ ì–‘ ë ê°’ì— ëŒ€í•œ ì„¤ëª…ì„ ë°˜ë“œì‹œ í¬í•¨í•´ì£¼ì„¸ìš” (ì˜ˆ: "1=ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤", "5=ë§¤ìš° ê·¸ë ‡ë‹¤").
- ëª¨ë“  ì§ˆë¬¸ì€ í•„ìˆ˜ ì‘ë‹µ(is_required: true)ìœ¼ë¡œ ì„¤ì •
- ê° ì§ˆë¬¸ì€ ëª…í™•í•˜ê³  ì´í•´í•˜ê¸° ì‰¬ì›Œì•¼ í•˜ë©°, ëŒ€ìƒ ì‘ë‹µìì˜ íŠ¹ì„±ì„ ê³ ë ¤í•´ì£¼ì„¸ìš”
- ì‘ë‹µìê°€ ì†”ì§í•˜ê³  êµ¬ì²´ì ìœ¼ë¡œ ë‹µë³€í•  ìˆ˜ ìˆë„ë¡ ì§ˆë¬¸ì„ êµ¬ì„±í•´ì£¼ì„¸ìš”
- ì§ˆë¬¸ ìˆœì„œëŠ” ì¼ë°˜ì /ì‰¬ìš´ ì§ˆë¬¸ì—ì„œ êµ¬ì²´ì /ê¹Šì´ ìˆëŠ” ì§ˆë¬¸ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì§„í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤

## ğŸ“‹ ìƒë‹´ ìë£Œ ìƒì„± ì‹œ ì¶”ê°€ ê°€ì´ë“œë¼ì¸ (purposeì— "ìƒë‹´" í‚¤ì›Œë“œ í¬í•¨ ì‹œ)
${purpose && (typeof purpose === 'string') && purpose.includes('ìƒë‹´') ? `
**ìƒë‹´ ì „ë¬¸ ì§ˆë¬¸ ì„¤ê³„ ì›ì¹™:**
1. **ê°ì • ìƒíƒœ í‰ê°€**: linear_scaleì„ í™œìš©í•˜ì—¬ í˜„ì¬ ê¸°ë¶„, ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€, ë§Œì¡±ë„ ì¸¡ì •
   ì˜ˆì‹œ: "ìµœê·¼ ì¼ì£¼ì¼ê°„ ê¸°ë¶„ ìƒíƒœëŠ” ì–´ë• ë‚˜ìš”?" (1: ë§¤ìš° ìš°ìš¸ ~ 5: ë§¤ìš° ì¢‹ìŒ)

2. **ê°œë°©í˜• ì‘ë‹µ**: paragraphë¥¼ í™œìš©í•˜ì—¬ ê¹Šì´ ìˆëŠ” ì˜ê²¬ ìˆ˜ì§‘
   ì˜ˆì‹œ: "ìµœê·¼ ê°€ì¥ í˜ë“¤ì—ˆë˜ ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”? ììœ ë¡­ê²Œ ì´ì•¼ê¸°í•´ì£¼ì„¸ìš”."

3. **êµ¬ì²´ì  í–‰ë™ íŒŒì•…**: multiple_choiceë¡œ ìƒí™œ íŒ¨í„´, ìŠµê´€, í–‰ë™ ì„ íƒ ì¡°ì‚¬
   ì˜ˆì‹œ: "í‰ì†Œ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ ë°©ë²•ì€?" (ìš´ë™, ëŒ€í™”, ì·¨ë¯¸ìƒí™œ, ìˆ˜ë©´, ê¸°íƒ€)

4. **ë‹¤ì¤‘ ì´ìŠˆ íŒŒì•…**: checkboxë¡œ ì—¬ëŸ¬ ë¬¸ì œ ë™ì‹œ ì„ íƒ ê°€ëŠ¥
   ì˜ˆì‹œ: "í˜„ì¬ ì–´ë ¤ì›€ì„ ê²ªê³  ìˆëŠ” ë¶€ë¶„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”" (í•™ì—…, ì¹œêµ¬ê´€ê³„, ê°€ì¡±ê´€ê³„, ì§„ë¡œ ë“±)

5. **ë‹¨ê³„ì  ì§ˆë¬¸ êµ¬ì„±**: ê°€ë²¼ìš´ ì§ˆë¬¸ â†’ ê¹Šì´ ìˆëŠ” ì§ˆë¬¸ ìˆœì„œë¡œ ë°°ì¹˜
   - 1-2ë²ˆ: ê¸°ë³¸ ì •ë³´ (ê°ê´€ì‹/ë‹¨ë‹µí˜•)
   - 3-4ë²ˆ: ê°ì •/ë§Œì¡±ë„ (ì„ í˜• ë°°ìœ¨)
   - 5-6ë²ˆ: êµ¬ì²´ì  ìƒí™© (ì²´í¬ë°•ìŠ¤/ê°ê´€ì‹)
   - ë§ˆì§€ë§‰: ê°œë°©í˜• ì˜ê²¬ (ì¥ë¬¸í˜•)

6. **ê¸ì •ì  ë§ˆë¬´ë¦¬**: ë§ˆì§€ë§‰ ì§ˆë¬¸ì€ í¬ë§ì ì´ê±°ë‚˜ ì§€ì› ë°©ì•ˆì„ ë¬»ëŠ” í˜•ì‹
   ì˜ˆì‹œ: "ì•ìœ¼ë¡œ ì–´ë–¤ ë„ì›€ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ë‚˜ìš”?"
` : ''}

# ì¶œë ¥ í˜•ì‹ (JSON)
ì‘ë‹µì€ ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ë°˜í™˜í•´ì£¼ì„¸ìš”:
{
  "surveyTitle": "${title}",
  "questions": [
    {
      "question_text": "1. ì§ˆë¬¸ ë‚´ìš© (ë²ˆí˜¸ í¬í•¨)",
      "question_type": "multiple_choice",
      "options": ["ì„ íƒì§€1", "ì„ íƒì§€2", "ì„ íƒì§€3", "ì„ íƒì§€4"],
      "is_required": true
    },
    {
      "question_text": "2. ì§ˆë¬¸ ë‚´ìš© (ë²ˆí˜¸ í¬í•¨)",
      "question_type": "linear_scale",
      "options": ["1: ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤", "2: ê·¸ë ‡ì§€ ì•Šë‹¤", "3: ë³´í†µ", "4: ê·¸ë ‡ë‹¤", "5: ë§¤ìš° ê·¸ë ‡ë‹¤"],
      "is_required": true
    }
  ]
}

question_typeì€ ë°˜ë“œì‹œ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤:
- multiple_choice (ê°ê´€ì‹)
- checkbox (ì²´í¬ë°•ìŠ¤)
- dropdown (ë“œë¡­ë‹¤ìš´)
- short_answer (ë‹¨ë‹µí˜•)
- paragraph (ì¥ë¬¸í˜•)
- linear_scale (ì„ í˜• ë°°ìœ¨)
`;

  console.log('[api/generate] Survey - Gemini API í˜¸ì¶œ ì‹œì‘...');
  console.log('[api/generate] Survey - í”„ë¡¬í”„íŠ¸ ê¸¸ì´:', prompt.length);

  const result = await model.generateContent(prompt);
  console.log('[api/generate] Survey - generateContent ì™„ë£Œ');

  const response = await result.response;
  console.log('[api/generate] Survey - response ê°ì²´ íšë“');
  console.log('[api/generate] Survey - response.candidates ì¡´ì¬ ì—¬ë¶€:', !!response.candidates);

  // Code.gs íŒ¨í„´: ì‘ë‹µ ìœ íš¨ì„± ê²€ì¦
  const candidates = response.candidates;
  if (!candidates || candidates.length === 0) {
    console.error('[api/generate] Gemini ì‘ë‹µì— í›„ë³´ê°€ ì—†ìŒ');
    throw new Error("Gemini API ì‘ë‹µì— ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.");
  }

  const candidate = candidates[0];
  const finishReason = candidate.finishReason;

  // ì¢…ë£Œ ì‚¬ìœ  í™•ì¸
  if (finishReason !== "STOP" && finishReason !== "MAX_TOKENS") {
    console.error(`[api/generate] ì˜ˆê¸°ì¹˜ ì•Šì€ ì¢…ë£Œ ì‚¬ìœ : ${finishReason}`);
    throw new Error(`ì½˜í…ì¸  ìƒì„±ì´ ì˜ˆê¸°ì¹˜ ì•Šê²Œ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ìœ : ${finishReason}`);
  }

  // ì‘ë‹µ í…ìŠ¤íŠ¸ ì¶”ì¶œ
  const responseText = response.text();
  console.log('[api/generate] Survey - ì‘ë‹µ í…ìŠ¤íŠ¸ ê¸¸ì´:', responseText.length);
  console.log('[api/generate] Survey - ì‘ë‹µ í…ìŠ¤íŠ¸ ì• 100ì:', responseText.substring(0, 100));

  // Code.gs íŒ¨í„´: JSON ë§ˆí¬ë‹¤ìš´ ë¸”ë¡ ì²˜ë¦¬
  let jsonString = responseText.trim();
  const jsonMatch = jsonString.match(/```(?:json)?\s*([\s\S]*?)\s*```/);
  if (jsonMatch && jsonMatch[1]) {
    jsonString = jsonMatch[1].trim();
    console.log('[api/generate] Survey - JSON ë§ˆí¬ë‹¤ìš´ ë¸”ë¡ ì¶”ì¶œ ì„±ê³µ');
  } else {
    console.log('[api/generate] Warning: JSON response not in markdown block');
  }

  // Code.gs íŒ¨í„´: ìƒì„¸í•œ ì—ëŸ¬ ë¡œê¹…ê³¼ í•¨ê»˜ JSON íŒŒì‹±
  let parsed;
  try {
    parsed = JSON.parse(jsonString);
    console.log('[api/generate] Survey - JSON íŒŒì‹± ì„±ê³µ');
  } catch (parseError) {
    console.error('[api/generate] JSON íŒŒì‹± ì‹¤íŒ¨');
    console.error('[api/generate] ì›ë³¸ ì‘ë‹µ:', responseText);
    console.error('[api/generate] íŒŒì‹± ì‹œë„í•œ JSON:', jsonString);
    throw new Error(`Gemini ì‘ë‹µì„ JSONìœ¼ë¡œ íŒŒì‹±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${parseError instanceof Error ? parseError.message : 'Unknown error'}`);
  }

  if (!parsed.questions || !Array.isArray(parsed.questions)) {
    console.error('[api/generate] ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜ - questions ë°°ì—´ ì—†ìŒ');
    console.error('[api/generate] íŒŒì‹±ëœ ê°ì²´:', JSON.stringify(parsed));
    throw new Error("Gemini ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤ (questions ë°°ì—´ì´ ì—†ìŒ).");
  }

  console.log(`[api/generate] íŒŒì‹± ì„±ê³µ: ${parsed.questions.length}ê°œ ì§ˆë¬¸ ìƒì„±ë¨`);


  const items: FormSpec["items"] = parsed.questions
    .map((question: Record<string, unknown>) => {
      const questionText = String(question.question_text || question.question || "");
      const questionType = String(question.question_type || "paragraph");
      const options = Array.isArray(question.options) ? question.options : [];
      const isRequired = question.is_required !== false;

      if (questionType === "multiple_choice") {
        return {
          type: "multiple_choice" as const,
          title: questionText,
          required: isRequired,
          options: options.map(String),
        };
      }
      if (questionType === "checkbox") {
        return {
          type: "checkbox" as const,
          title: questionText,
          required: isRequired,
          options: options.map(String),
        };
      }
      if (questionType === "dropdown") {
        return {
          type: "dropdown" as const,
          title: questionText,
          required: isRequired,
          options: options.map(String),
        };
      }
      if (questionType === "short_answer") {
        return {
          type: "short_answer" as const,
          title: questionText,
          required: isRequired,
        };
      }
      if (questionType === "paragraph") {
        return {
          type: "paragraph" as const,
          title: questionText,
          required: isRequired,
        };
      }
      if (questionType === "linear_scale") {
        // Parse scale settings from options array
        // Expected format: ["1: label1", "2: label2", ..., "5: label5"]
        let low = 1;
        let high = 5;
        let lowLabel = "";
        let highLabel = "";

        if (options.length > 0) {
          const parseScaleOption = (optStr: string) => {
            const match = String(optStr).match(/^(\d+)\s*[:=-]?\s*(.*)/);
            if (match) {
              return { bound: parseInt(match[1], 10), label: match[2].trim() };
            }
            return null;
          };

          const firstParsed = parseScaleOption(String(options[0]));
          const lastParsed = parseScaleOption(String(options[options.length - 1]));

          if (firstParsed) {
            low = firstParsed.bound;
            lowLabel = firstParsed.label;
          }
          if (lastParsed) {
            high = lastParsed.bound;
            highLabel = lastParsed.label;
          }
        }

        return {
          type: "linear_scale" as const,
          title: questionText,
          required: isRequired,
          scaleSettings: {
            low,
            high,
            lowLabel,
            highLabel,
          },
        };
      }
      return null;
    })
    .filter(Boolean);

  if (!items.length) {
    throw new Error("ìƒì„±ëœ ë¬¸í•­ì´ ì—†ìŠµë‹ˆë‹¤.");
  }

  // Add personal info fields at the BEGINNING (Apps Script pattern)
  const personalInfoItems: FormSpec["items"] = [];

  if (collectName) {
    personalInfoItems.push({
      type: "short_answer",
      title: "ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.",
      required: true,
    });
  }
  if (collectPhone) {
    personalInfoItems.push({
      type: "short_answer",
      title: "ì—°ë½ì²˜(íœ´ëŒ€ì „í™”ë²ˆí˜¸)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.",
      description: "'-' ì—†ì´ ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.",
      required: true,
    });
  }
  if (collectEmail) {
    personalInfoItems.push({
      type: "short_answer",
      title: "ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.",
      required: true,
    });
  }

  // Combine: personal info first, then survey questions
  const finalItems = [...personalInfoItems, ...items];

  return {
    title: (typeof title === "string" ? title : null) || "AI ì„¤ë¬¸",
    description: `${typeof purpose === "string" ? purpose : "ì„¤ë¬¸ ëª©ì "} / ëŒ€ìƒ: ${typeof audience === "string" ? audience : "ì „ì²´"}`,
    isQuiz: false,
    items: finalItems,
  };
}

export async function POST(request: Request) {
  const session = await getServerSession(authOptions);
  
  // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì¸ì¦ì„ ìš°íšŒ (ì„ì‹œ)
  const isDevelopment = process.env.NODE_ENV === 'development';
  
  if (!isDevelopment && (!session || !session.user?.email)) {
    return NextResponse.json({ error: "ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤." }, { status: 401 });
  }

  let payload: Record<string, unknown>;
  try {
    payload = await request.json();
  } catch {
    return NextResponse.json(
      { error: "ìœ íš¨í•œ JSONì„ ì „ë‹¬í•´ì£¼ì„¸ìš”." },
      { status: 400 },
    );
  }

  const formType = payload?.formType ?? payload?.type;
  if (formType !== "quiz" && formType !== "survey") {
    return NextResponse.json(
      { error: "formTypeì€ quiz ë˜ëŠ” survey ì—¬ì•¼ í•©ë‹ˆë‹¤." },
      { status: 400 },
    );
  }

  const geminiApiKey: string | undefined =
    typeof payload?.geminiApiKey === "string"
      ? payload.geminiApiKey.trim()
      : undefined;

  try {
    if (formType === "quiz") {
      if (geminiApiKey) {
        try {
          const spec = await buildGeminiQuizSpec(payload, geminiApiKey);
          return NextResponse.json({
            formSpec: spec,
            source: "gemini" as GenerationSource,
          });
        } catch (error) {
          console.warn(
            "[api/generate] Gemini ì‹¤íŒ¨, í…œí”Œë¦¿ìœ¼ë¡œ ëŒ€ì²´:",
            error instanceof Error ? error.message : error,
          );
          const spec = buildFallbackQuizSpec(payload);
          return NextResponse.json({
            formSpec: spec,
            source: "gemini-fallback" as GenerationSource,
          });
        }
      }

      const spec = buildFallbackQuizSpec(payload);
      return NextResponse.json({
        formSpec: spec,
        source: "template" as GenerationSource,
      });
    }

    // Survey generation
    if (geminiApiKey) {
      try {
        const spec = await buildGeminiSurveySpec(payload, geminiApiKey);
        return NextResponse.json({
          formSpec: spec,
          source: "gemini" as GenerationSource,
        });
      } catch (error) {
        console.warn(
          "[api/generate] Survey Gemini ì‹¤íŒ¨, í…œí”Œë¦¿ìœ¼ë¡œ ëŒ€ì²´:",
          error instanceof Error ? error.message : error,
        );
        const spec = buildFallbackSurveySpec(payload);
        return NextResponse.json({
          formSpec: spec,
          source: "gemini-fallback" as GenerationSource,
        });
      }
    }

    const spec = buildFallbackSurveySpec(payload);
    return NextResponse.json({
      formSpec: spec,
      source: "template" as GenerationSource,
    });
  } catch (error) {
    console.error(
      "[api/generate] FormSpec ìƒì„± ì˜¤ë¥˜:",
      error instanceof Error ? error.message : error,
    );
    return NextResponse.json(
      {
        error:
          error instanceof Error
            ? error.message
            : "FormSpec ìƒì„± ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
      },
      { status: 500 },
    );
  }
}



================================================
FILE: src/app/api/secrets/get/route.ts
================================================
import { NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { getAdminDb } from "@/lib/firebase-admin";
import { decryptBYOK } from "@/lib/crypto";

export async function GET() {
  const session = await getServerSession(authOptions);
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  try {
    const adminDb = getAdminDb();
    const docRef = adminDb
      .collection("users")
      .doc(session.user.email)
      .collection("secrets")
      .doc("gemini");

    const docSnap = await docRef.get();

    if (!docSnap.exists) {
      return NextResponse.json({ exists: false });
    }

    const data = docSnap.data();
    if (!data || !data.ciphertext || !data.iv || !data.tag) {
      return NextResponse.json({ exists: false });
    }

    // Decrypt the API key
    const decrypted = decryptBYOK({
      ciphertext: data.ciphertext,
      iv: data.iv,
      tag: data.tag,
    });

    return NextResponse.json({
      exists: true,
      key: decrypted,
      createdAt: data.createdAt
    });
  } catch (e: unknown) {
    console.error("Error loading Gemini API key:", e);
    const errorMessage = e instanceof Error ? e.message : "Internal error";
    return NextResponse.json({ error: errorMessage }, { status: 500 });
  }
}



================================================
FILE: src/app/api/secrets/set/route.ts
================================================
import { NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { getAdminDb } from "@/lib/firebase-admin";
import { encryptBYOK } from "@/lib/crypto";

export async function POST(req: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  
  const body = await req.json().catch(() => null);
  const { key } = (body ?? {}) as { key?: string };
  if (!key) {
    return NextResponse.json({ error: "Missing 'key' in body" }, { status: 400 });
  }

  try {
    const enc = encryptBYOK(key);
    const adminDb = getAdminDb();
    const docRef = adminDb.collection("users").doc(session.user.email).collection("secrets").doc("gemini");
    await docRef.set({ ...enc, createdAt: Date.now() }, { merge: true });
    return NextResponse.json({ ok: true });
  } catch (e: unknown) {
    console.error("Error saving Gemini API key:", e);
    const errorMessage = e instanceof Error ? e.message : "Internal error";
    return NextResponse.json({ error: errorMessage }, { status: 500 });
  }
}


================================================
FILE: src/app/create/page.tsx
================================================
'use client';

import { useState, useEffect } from 'react';
import { useSession } from 'next-auth/react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Checkbox } from '@/components/ui/checkbox';
import { Loader2, Sparkles, FileText, HelpCircle, ExternalLink, CheckCircle } from 'lucide-react';
import GeminiKeyInput from '@/components/GeminiKeyInput';
import type { FormSpec } from '@/lib/form-spec';

export default function CreatePage() {
  const { data: session, status } = useSession();
  const [isGenerating, setIsGenerating] = useState(false);
  const [creatingForm, setCreatingForm] = useState(false);
  const [formType, setFormType] = useState<'quiz' | 'survey'>('quiz');
  const [geminiApiKey, setGeminiApiKey] = useState('');
  const [creationResult, setCreationResult] = useState<{
    formId: string;
    formUrl: string;
    responderUrl: string;
  } | null>(null);
  const [errorMessage, setErrorMessage] = useState<string | null>(null);
  const [statusMessage, setStatusMessage] = useState<string | null>(null);
  const [needsReauth, setNeedsReauth] = useState(false);

  // Load existing API key on mount
  useEffect(() => {
    async function loadApiKey() {
      if (!session?.user?.email) return;

      try {
        const res = await fetch("/api/secrets/get");
        const json = await res.json();

        if (res.ok && json.exists && json.key) {
          setGeminiApiKey(json.key);
        }
      } catch (e) {
        console.error("Failed to load API key:", e);
      }
    }

    loadApiKey();
  }, [session]);

  // í€´ì¦ˆ ìƒíƒœ
  const [quizData, setQuizData] = useState({
    title: '',
    text: '',
    grade: 'ì´ˆë“±í•™êµ 3í•™ë…„',
    count: 5,
    questionType: 'mixed',
    difficulty: 'medium',
    timeLimit: false,
    timeLimitMinutes: 10,
    collectPersonalInfo: false
  });

  // ë¬¸í•­ ìˆ˜ ì»¤ìŠ¤í…€ ì…ë ¥ ìƒíƒœ (í€´ì¦ˆìš©)
  const [useCustomCount, setUseCustomCount] = useState(false);
  const [customCount, setCustomCount] = useState('');

  // ì„¤ë¬¸ ë¬¸í•­ ìˆ˜ ì»¤ìŠ¤í…€ ì…ë ¥ ìƒíƒœ
  const [useCustomSurveyCount, setUseCustomSurveyCount] = useState(false);
  const [customSurveyCount, setCustomSurveyCount] = useState('');

  // ì„¤ë¬¸ ìƒíƒœ
  const [surveyData, setSurveyData] = useState({
    title: '',
    purpose: '',
    audience: '',
    numQuestions: 5,
    questionType: 'ai_recommended',
    originalText: '',
    collectName: false,
    collectPhone: false,
    collectEmail: false
  });

  if (status === 'loading') {
    return (
      <div className="flex min-h-screen items-center justify-center">
        <Loader2 className="h-8 w-8 animate-spin" />
      </div>
    );
  }

  const handleGenerate = async () => {
    setErrorMessage(null);
    setCreationResult(null);
    setStatusMessage('í¼ ì´ˆì•ˆì„ ìƒì„±í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...');
    setIsGenerating(true);

    const payload =
      formType === 'quiz'
        ? {
            formType: 'quiz',
            geminiApiKey: geminiApiKey || undefined,
            ...quizData,
          }
        : {
            formType: 'survey',
            geminiApiKey: geminiApiKey || undefined,
            ...surveyData,
          };

    try {
      const response = await fetch('/api/generate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(payload),
      });

      const result = await response.json();
      if (!response.ok) {
        throw new Error(result.error || 'í¼ ìŠ¤í™ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }

      const spec = result.formSpec as FormSpec | undefined;
      if (!spec) {
        throw new Error('í¼ ìŠ¤í™ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }

      setStatusMessage('Google Formsë¡œ ë‚´ë³´ë‚´ëŠ” ì¤‘ì…ë‹ˆë‹¤...');
      setCreatingForm(true);

      const createResponse = await fetch('/api/forms/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(spec),
      });
      const created = await createResponse.json();
      if (!createResponse.ok) {
        // Google OAuth í† í° ì˜¤ë¥˜ ê°ì§€
        if (created.error && created.error.includes('Google ì¸ì¦ í† í°')) {
          setNeedsReauth(true);
        }
        throw new Error(created.error || 'Google Forms ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }

      setCreationResult({
        formId: created.formId,
        formUrl: created.formUrl,
        responderUrl: created.responderUrl,
      });
      setStatusMessage(null);
    } catch (error) {
      const message =
        error instanceof Error ? error.message : 'ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
      setErrorMessage(message);
    } finally {
      setIsGenerating(false);
      setCreatingForm(false);
      setStatusMessage(null);
    }
  };


  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50">
      {/* Header - ëª¨ë°”ì¼ ìµœì í™” */}
      <header className="sticky top-0 z-50 border-b border-gray-100 bg-white/90 backdrop-blur-md shadow-sm">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-3 sm:py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-2">
              <div className="text-xl sm:text-2xl font-bold text-blue-600">TeaBoard</div>
              <div className="text-lg sm:text-xl font-semibold text-gray-800">Forms</div>
            </div>
            <div className="text-xs sm:text-sm text-gray-500 hidden sm:block">
              AI ê¸°ë°˜ í€´ì¦ˆ/ì„¤ë¬¸ ìƒì„±
            </div>
          </div>
        </div>
      </header>

      <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 max-w-5xl">
        {/* í—¤ë” - ëª¨ë°”ì¼ ìµœì í™” */}
        <div className="mb-6 sm:mb-8 text-center">
          <h1 className="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-3 sm:mb-4">
            TeaBoard Forms
          </h1>
          <p className="text-base sm:text-lg text-gray-600 px-4 sm:px-0">
            AIë¡œ í€´ì¦ˆë‚˜ ì„¤ë¬¸ì„ ìë™ ìƒì„±í•˜ê³  Google Formsë¡œ ë§Œë“¤ì–´ë³´ì„¸ìš”
          </p>
        </div>

        {/* Gemini API í‚¤ ì…ë ¥ */}
        <div className="mb-6">
          <GeminiKeyInput onKeySet={setGeminiApiKey} />
        </div>

        {/* í¼ íƒ€ì… ì„ íƒ - Chanel ìŠ¤íƒ€ì¼ */}
        <Card className="mb-6 border-2 border-black shadow-sm bg-white hover:shadow-md transition-shadow duration-200">
          <CardHeader className="pb-4 border-b-2 border-black">
            <CardTitle className="flex items-center gap-2 text-black text-lg sm:text-xl font-bold uppercase tracking-wide">
              <Sparkles className="h-5 w-5 sm:h-6 sm:w-6 text-black" />
              í¼ ìœ í˜• ì„ íƒ
            </CardTitle>
            <CardDescription className="text-sm sm:text-base text-gray-700 mt-2">
              ë§Œë“¤ê³  ì‹¶ì€ í¼ì˜ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Tabs value={formType} onValueChange={(value) => setFormType(value as 'quiz' | 'survey')}>
              <TabsList className="grid w-full grid-cols-2 bg-white border-2 border-black p-0 rounded-none h-auto">
                <TabsTrigger
                  value="quiz"
                  className="flex items-center justify-center gap-2 border-r-2 border-black data-[state=active]:bg-black data-[state=active]:text-white data-[state=inactive]:bg-white data-[state=inactive]:text-black rounded-none transition-all duration-200 py-3 sm:py-4 font-semibold"
                >
                  <HelpCircle className="h-4 w-4 sm:h-5 sm:w-5" />
                  <span className="text-sm sm:text-base uppercase tracking-wide">í€´ì¦ˆ</span>
                </TabsTrigger>
                <TabsTrigger
                  value="survey"
                  className="flex items-center justify-center gap-2 data-[state=active]:bg-black data-[state=active]:text-white data-[state=inactive]:bg-white data-[state=inactive]:text-black rounded-none transition-all duration-200 py-3 sm:py-4 font-semibold"
                >
                  <FileText className="h-4 w-4 sm:h-5 sm:w-5" />
                  <span className="text-sm sm:text-base uppercase tracking-wide">ì„¤ë¬¸</span>
                </TabsTrigger>
              </TabsList>

              {/* í€´ì¦ˆ ìƒì„± - ëª¨ë°”ì¼ ìµœì í™” */}
              <TabsContent value="quiz" className="space-y-4 sm:space-y-5 mt-6">
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-5">
                  <div className="space-y-2">
                    <Label htmlFor="quiz-title" className="text-sm sm:text-base font-medium text-gray-700">
                      í€´ì¦ˆ ì œëª© <span className="text-red-500">*</span>
                    </Label>
                    <Input
                      id="quiz-title"
                      placeholder="ì˜ˆ: 3í•™ë…„ ìˆ˜í•™ ë‹¨ì›í‰ê°€"
                      value={quizData.title}
                      onChange={(e: React.ChangeEvent<HTMLInputElement>) => setQuizData({...quizData, title: e.target.value})}
                      className="h-10 sm:h-11 text-sm sm:text-base"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="grade" className="text-sm sm:text-base font-medium text-gray-700">
                      ëŒ€ìƒ í•™ë…„
                    </Label>
                    <Select value={quizData.grade} onValueChange={(value) => setQuizData({...quizData, grade: value})}>
                      <SelectTrigger className="h-10 sm:h-11 text-sm sm:text-base">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent className="max-h-[280px] sm:max-h-[340px]">
                        <SelectItem value="ì´ˆë“±í•™êµ 1í•™ë…„">ì´ˆë“±í•™êµ 1í•™ë…„</SelectItem>
                        <SelectItem value="ì´ˆë“±í•™êµ 2í•™ë…„">ì´ˆë“±í•™êµ 2í•™ë…„</SelectItem>
                        <SelectItem value="ì´ˆë“±í•™êµ 3í•™ë…„">ì´ˆë“±í•™êµ 3í•™ë…„</SelectItem>
                        <SelectItem value="ì´ˆë“±í•™êµ 4í•™ë…„">ì´ˆë“±í•™êµ 4í•™ë…„</SelectItem>
                        <SelectItem value="ì´ˆë“±í•™êµ 5í•™ë…„">ì´ˆë“±í•™êµ 5í•™ë…„</SelectItem>
                        <SelectItem value="ì´ˆë“±í•™êµ 6í•™ë…„">ì´ˆë“±í•™êµ 6í•™ë…„</SelectItem>
                        <SelectItem value="ì¤‘í•™êµ 1í•™ë…„">ì¤‘í•™êµ 1í•™ë…„</SelectItem>
                        <SelectItem value="ì¤‘í•™êµ 2í•™ë…„">ì¤‘í•™êµ 2í•™ë…„</SelectItem>
                        <SelectItem value="ì¤‘í•™êµ 3í•™ë…„">ì¤‘í•™êµ 3í•™ë…„</SelectItem>
                        <SelectItem value="ê³ ë“±í•™êµ 1í•™ë…„">ê³ ë“±í•™êµ 1í•™ë…„</SelectItem>
                        <SelectItem value="ê³ ë“±í•™êµ 2í•™ë…„">ê³ ë“±í•™êµ 2í•™ë…„</SelectItem>
                        <SelectItem value="ê³ ë“±í•™êµ 3í•™ë…„">ê³ ë“±í•™êµ 3í•™ë…„</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                <div className="space-y-2">
                  <Label htmlFor="quiz-text" className="text-sm sm:text-base font-medium text-gray-700">
                    ì›ë³¸ í…ìŠ¤íŠ¸ <span className="text-red-500">*</span>
                  </Label>
                  <Textarea
                    id="quiz-text"
                    placeholder="í€´ì¦ˆë¥¼ ë§Œë“¤ ì›ë³¸ í…ìŠ¤íŠ¸ë‚˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
                    className="min-h-[120px] sm:min-h-[140px] text-sm sm:text-base resize-none"
                    value={quizData.text}
                    onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => setQuizData({...quizData, text: e.target.value})}
                  />
                  <p className="text-xs sm:text-sm text-gray-500 mt-1">
                    êµê³¼ì„œ ë‚´ìš©ì´ë‚˜ í•™ìŠµ ìë£Œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”
                  </p>
                </div>

                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                  <div className="space-y-2">
                    <Label htmlFor="question-count" className="text-sm sm:text-base font-medium text-gray-700">
                      ë¬¸í•­ ìˆ˜
                    </Label>
                    {!useCustomCount ? (
                      <Select
                        value={quizData.count.toString()}
                        onValueChange={(value) => {
                          if (value === 'custom') {
                            setUseCustomCount(true);
                            setCustomCount('');
                          } else {
                            setQuizData({...quizData, count: parseInt(value)});
                          }
                        }}
                      >
                        <SelectTrigger className="h-10 sm:h-11 text-sm sm:text-base">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent className="max-h-[280px] sm:max-h-[340px]">
                          <SelectItem value="3">3ë¬¸í•­</SelectItem>
                          <SelectItem value="5">5ë¬¸í•­</SelectItem>
                          <SelectItem value="10">10ë¬¸í•­</SelectItem>
                          <SelectItem value="15">15ë¬¸í•­</SelectItem>
                          <SelectItem value="20">20ë¬¸í•­</SelectItem>
                          <SelectItem value="custom">ì§ì ‘ ì…ë ¥</SelectItem>
                        </SelectContent>
                      </Select>
                    ) : (
                      <div className="flex gap-2">
                        <Input
                          type="number"
                          min="1"
                          max="30"
                          placeholder="ë¬¸í•­ ìˆ˜ ì…ë ¥"
                          value={customCount}
                          onChange={(e) => {
                            const value = e.target.value;
                            setCustomCount(value);
                            const num = parseInt(value);
                            if (num >= 1 && num <= 30) {
                              setQuizData({...quizData, count: num});
                            }
                          }}
                          className="h-10 sm:h-11 text-sm sm:text-base flex-1"
                        />
                        <Button
                          type="button"
                          variant="outline"
                          size="sm"
                          onClick={() => {
                            setUseCustomCount(false);
                            setCustomCount('');
                            setQuizData({...quizData, count: 5});
                          }}
                          className="h-10 sm:h-11 text-xs sm:text-sm"
                        >
                          ì·¨ì†Œ
                        </Button>
                      </div>
                    )}
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="question-type" className="text-sm sm:text-base font-medium text-gray-700">
                      ë¬¸í•­ ìœ í˜•
                    </Label>
                    <Select value={quizData.questionType} onValueChange={(value) => setQuizData({...quizData, questionType: value})}>
                      <SelectTrigger className="h-10 sm:h-11 text-sm sm:text-base">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent className="max-h-[280px] sm:max-h-[340px]">
                        <SelectItem value="mixed">í˜¼í•©í˜•</SelectItem>
                        <SelectItem value="multiple_choice">ê°ê´€ì‹ë§Œ</SelectItem>
                        <SelectItem value="short_answer">ë‹¨ë‹µí˜•ë§Œ</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="difficulty" className="text-sm sm:text-base font-medium text-gray-700">
                      ë‚œì´ë„
                    </Label>
                    <Select value={quizData.difficulty} onValueChange={(value) => setQuizData({...quizData, difficulty: value})}>
                      <SelectTrigger className="h-10 sm:h-11 text-sm sm:text-base">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent className="max-h-[280px] sm:max-h-[340px]">
                        <SelectItem value="easy">ì‰¬ì›€ â­</SelectItem>
                        <SelectItem value="medium">ë³´í†µ â­â­</SelectItem>
                        <SelectItem value="hard">ì–´ë ¤ì›€ â­â­â­</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                <div className="flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                  <div className="flex items-center space-x-2">
                    <Checkbox
                      id="time-limit"
                      checked={quizData.timeLimit}
                      onCheckedChange={(checked: boolean) => setQuizData({...quizData, timeLimit: !!checked})}
                      className="h-5 w-5"
                    />
                    <Label htmlFor="time-limit" className="text-sm sm:text-base font-medium text-gray-700 cursor-pointer">
                      ì‹œê°„ ì œí•œ ì„¤ì •
                    </Label>
                  </div>
                  {quizData.timeLimit && (
                    <div className="flex items-center gap-2">
                      <Input
                        type="number"
                        className="w-20 h-9 text-sm sm:text-base"
                        value={quizData.timeLimitMinutes}
                        onChange={(e: React.ChangeEvent<HTMLInputElement>) => setQuizData({...quizData, timeLimitMinutes: parseInt(e.target.value)})}
                        min="1"
                        max="120"
                      />
                      <span className="text-sm sm:text-base text-gray-600">ë¶„</span>
                    </div>
                  )}
                </div>

                <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                  <div className="flex items-center space-x-2">
                    <Checkbox
                      id="collect-personal-info"
                      checked={quizData.collectPersonalInfo}
                      onCheckedChange={(checked: boolean) => setQuizData({...quizData, collectPersonalInfo: !!checked})}
                      className="h-5 w-5"
                    />
                    <Label htmlFor="collect-personal-info" className="text-sm sm:text-base font-medium text-gray-700 cursor-pointer">
                      í•™ìƒ ì •ë³´ ìˆ˜ì§‘ (í•™ë…„, ë°˜, ë²ˆí˜¸, ì´ë¦„)
                    </Label>
                  </div>
                  {quizData.collectPersonalInfo && (
                    <p className="mt-2 text-xs sm:text-sm text-gray-600">
                      í€´ì¦ˆ ì‹œì‘ ì „ì— í•™ë…„, ë°˜, ë²ˆí˜¸, ì´ë¦„ ì…ë ¥ í•„ë“œê°€ ì¶”ê°€ë©ë‹ˆë‹¤.
                    </p>
                  )}
                </div>
              </TabsContent>

              {/* ì„¤ë¬¸ ìƒì„± - ëª¨ë°”ì¼ ìµœì í™” */}
              <TabsContent value="survey" className="space-y-4 sm:space-y-5 mt-6">
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-5">
                  <div className="space-y-2 sm:col-span-2">
                    <Label htmlFor="survey-title" className="text-sm sm:text-base font-medium text-gray-700">
                      ì„¤ë¬¸ ì œëª© <span className="text-red-500">*</span>
                    </Label>
                    <Input
                      id="survey-title"
                      placeholder="ì˜ˆ: ê³ ê° ë§Œì¡±ë„ ì¡°ì‚¬"
                      value={surveyData.title}
                      onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSurveyData({...surveyData, title: e.target.value})}
                      className="h-10 sm:h-11 text-sm sm:text-base"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="survey-questions" className="text-sm sm:text-base font-medium text-gray-700">
                      ì§ˆë¬¸ ìˆ˜
                    </Label>
                    {!useCustomSurveyCount ? (
                      <Select
                        value={surveyData.numQuestions.toString()}
                        onValueChange={(value) => {
                          if (value === 'custom') {
                            setUseCustomSurveyCount(true);
                            setCustomSurveyCount('');
                          } else {
                            setSurveyData({...surveyData, numQuestions: parseInt(value)});
                          }
                        }}
                      >
                        <SelectTrigger className="h-10 sm:h-11 text-sm sm:text-base">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent className="max-h-[280px] sm:max-h-[340px]">
                          <SelectItem value="3">3ë¬¸í•­</SelectItem>
                          <SelectItem value="5">5ë¬¸í•­</SelectItem>
                          <SelectItem value="10">10ë¬¸í•­</SelectItem>
                          <SelectItem value="15">15ë¬¸í•­</SelectItem>
                          <SelectItem value="20">20ë¬¸í•­</SelectItem>
                          <SelectItem value="custom">ì§ì ‘ ì…ë ¥</SelectItem>
                        </SelectContent>
                      </Select>
                    ) : (
                      <div className="flex gap-2">
                        <Input
                          type="number"
                          min="1"
                          max="50"
                          placeholder="ì§ˆë¬¸ ìˆ˜ ì…ë ¥"
                          value={customSurveyCount}
                          onChange={(e) => {
                            const value = e.target.value;
                            setCustomSurveyCount(value);
                            const num = parseInt(value);
                            if (num >= 1 && num <= 50) {
                              setSurveyData({...surveyData, numQuestions: num});
                            }
                          }}
                          className="h-10 sm:h-11 text-sm sm:text-base flex-1"
                        />
                        <Button
                          type="button"
                          variant="outline"
                          size="sm"
                          onClick={() => {
                            setUseCustomSurveyCount(false);
                            setCustomSurveyCount('');
                            setSurveyData({...surveyData, numQuestions: 5});
                          }}
                          className="h-10 sm:h-11 text-xs sm:text-sm"
                        >
                          ì·¨ì†Œ
                        </Button>
                      </div>
                    )}
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="survey-question-type" className="text-sm sm:text-base font-medium text-gray-700">
                      ë¬¸í•­ ìœ í˜•
                    </Label>
                    <Select value={surveyData.questionType} onValueChange={(value) => setSurveyData({...surveyData, questionType: value})}>
                      <SelectTrigger className="h-10 sm:h-11 text-sm sm:text-base">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent className="max-h-[280px] sm:max-h-[340px]">
                        <SelectItem value="ai_recommended">AI ì¶”ì²œ (ê¸°ë³¸ê°’)</SelectItem>
                        <SelectItem value="multiple_choice">ê°ê´€ì‹</SelectItem>
                        <SelectItem value="checkbox">ì²´í¬ë°•ìŠ¤</SelectItem>
                        <SelectItem value="dropdown">ë“œë¡­ë‹¤ìš´</SelectItem>
                        <SelectItem value="short_answer">ë‹¨ë‹µí˜•</SelectItem>
                        <SelectItem value="paragraph">ì¥ë¬¸í˜•</SelectItem>
                        <SelectItem value="linear_scale">ì„ í˜• ë°°ìœ¨</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                <div className="space-y-2">
                  <Label htmlFor="survey-purpose" className="text-sm sm:text-base font-medium text-gray-700">
                    ì„¤ë¬¸ ëª©ì  <span className="text-red-500">*</span>
                  </Label>
                  <Textarea
                    id="survey-purpose"
                    placeholder="ì˜ˆ: ì„œë¹„ìŠ¤ ê°œì„ ì„ ìœ„í•œ ê³ ê° ì˜ê²¬ ìˆ˜ë ´"
                    value={surveyData.purpose}
                    onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => setSurveyData({...surveyData, purpose: e.target.value})}
                    className="min-h-[80px] sm:min-h-[90px] text-sm sm:text-base resize-none"
                  />
                </div>

                <div className="space-y-2">
                  <Label htmlFor="survey-audience" className="text-sm sm:text-base font-medium text-gray-700">
                    ëŒ€ìƒ ì‘ë‹µì <span className="text-red-500">*</span>
                  </Label>
                  <Textarea
                    id="survey-audience"
                    placeholder="ì˜ˆ: 20-30ëŒ€ ì§ì¥ì¸, í•™ë¶€ëª¨ ë“±"
                    value={surveyData.audience}
                    onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => setSurveyData({...surveyData, audience: e.target.value})}
                    className="min-h-[80px] sm:min-h-[90px] text-sm sm:text-base resize-none"
                  />
                </div>

                <div className="space-y-2">
                  <Label htmlFor="survey-text" className="text-sm sm:text-base font-medium text-gray-700">
                    ì°¸ê³  í…ìŠ¤íŠ¸ (ì„ íƒì‚¬í•­)
                  </Label>
                  <Textarea
                    id="survey-text"
                    placeholder="ì„¤ë¬¸ ì‘ì„±ì— ì°¸ê³ í•  ë‚´ìš©ì´ë‚˜ ë°°ê²½ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                    className="min-h-[100px] sm:min-h-[120px] text-sm sm:text-base resize-none"
                    value={surveyData.originalText}
                    onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => setSurveyData({...surveyData, originalText: e.target.value})}
                  />
                  <p className="text-xs sm:text-sm text-gray-500 mt-1">
                    ê´€ë ¨ ìë£Œë‚˜ ë°°ê²½ ì •ë³´ê°€ ìˆìœ¼ë©´ ë” ì •í™•í•œ ì„¤ë¬¸ì´ ìƒì„±ë©ë‹ˆë‹¤
                  </p>
                </div>

                <div className="space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-200">
                  <Label className="text-sm sm:text-base font-medium text-gray-700">
                    ê°œì¸ì •ë³´ ìˆ˜ì§‘ (ì„ íƒ)
                  </Label>
                  <div className="flex flex-col sm:flex-row flex-wrap gap-3 sm:gap-4">
                    <div className="flex items-center space-x-2">
                      <Checkbox
                        id="collect-name"
                        checked={surveyData.collectName}
                        onCheckedChange={(checked: boolean) => setSurveyData({...surveyData, collectName: !!checked})}
                        className="h-5 w-5"
                      />
                      <Label htmlFor="collect-name" className="text-sm sm:text-base cursor-pointer">
                        ì´ë¦„
                      </Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox
                        id="collect-phone"
                        checked={surveyData.collectPhone}
                        onCheckedChange={(checked: boolean) => setSurveyData({...surveyData, collectPhone: !!checked})}
                        className="h-5 w-5"
                      />
                      <Label htmlFor="collect-phone" className="text-sm sm:text-base cursor-pointer">
                        ì „í™”ë²ˆí˜¸
                      </Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox
                        id="collect-email"
                        checked={surveyData.collectEmail}
                        onCheckedChange={(checked: boolean) => setSurveyData({...surveyData, collectEmail: !!checked})}
                        className="h-5 w-5"
                      />
                      <Label htmlFor="collect-email" className="text-sm sm:text-base cursor-pointer">
                        ì´ë©”ì¼
                      </Label>
                    </div>
                  </div>
                </div>
              </TabsContent>
            </Tabs>
          </CardContent>
        </Card>

        {/* ìƒì„± ë²„íŠ¼ - ëª¨ë°”ì¼ ìµœì í™” */}
        <div className="flex flex-col items-center gap-3 sm:gap-4">
          <Button
            onClick={handleGenerate}
            disabled={
              isGenerating ||
              creatingForm ||
              (formType === 'quiz'
                ? !quizData.title || !quizData.text
                : !surveyData.title || !surveyData.purpose || !surveyData.audience)
            }
            size="lg"
            className="w-full sm:w-auto px-6 sm:px-8 py-4 sm:py-5 bg-blue-600 hover:bg-blue-700 text-white font-semibold text-base sm:text-lg rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed"
          >
            {isGenerating || creatingForm ? (
              <>
                <Loader2 className="mr-2 h-5 w-5 sm:h-6 sm:w-6 animate-spin" />
                <span className="text-sm sm:text-base">
                  {creatingForm ? 'Google Forms ìƒì„± ì¤‘...' : 'AI ì´ˆì•ˆ ìƒì„± ì¤‘...'}
                </span>
              </>
            ) : (
              <>
                <Sparkles className="mr-2 h-5 w-5 sm:h-6 sm:w-6" />
                <span className="text-sm sm:text-base">Google Formsë¡œ ë§Œë“¤ê¸°</span>
              </>
            )}
          </Button>

          {statusMessage && (
            <div className="w-full max-w-md px-4">
              <div className="flex items-center justify-center gap-2 text-sm sm:text-base text-gray-600 bg-blue-50 py-2 px-4 rounded-lg border border-blue-200">
                <Loader2 className="h-4 w-4 animate-spin text-blue-600" />
                <p>{statusMessage}</p>
              </div>
            </div>
          )}
        </div>

        {errorMessage && (
          <div className="mt-6 rounded-xl border border-red-200 bg-red-50 p-6">
            <div className="flex items-start gap-3">
              <div className="flex-shrink-0">
                <svg className="h-5 w-5 text-red-600" viewBox="0 0 20 20" fill="currentColor">
                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                </svg>
              </div>
              <div className="flex-1">
                <h3 className="text-sm font-medium text-red-800">ì˜¤ë¥˜ ë°œìƒ</h3>
                <p className="mt-1 text-sm text-red-700">{errorMessage}</p>
                {needsReauth && (
                  <div className="mt-4 space-y-3">
                    <p className="text-sm font-medium text-red-800">
                      Google Forms ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤
                    </p>
                    <p className="text-sm text-red-600">
                      ë¡œê·¸ì•„ì›ƒ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ë©´ Google Forms ì ‘ê·¼ ê¶Œí•œì´ ìƒˆë¡œ ë¶€ì—¬ë©ë‹ˆë‹¤.
                    </p>
                    <Button
                      onClick={() => {
                        // ë¡œê·¸ì•„ì›ƒí•˜ê³  ì¦‰ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
                        window.location.href = '/api/auth/signout?callbackUrl=/';
                      }}
                      className="bg-red-600 hover:bg-red-700 text-white"
                    >
                      ë¡œê·¸ì•„ì›ƒ í›„ ì¬ë¡œê·¸ì¸í•˜ê¸°
                    </Button>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}

        {creationResult && (
          <Card className="mt-6 sm:mt-8 border-[1.5px] border-black shadow-md hover:shadow-lg transition-shadow duration-200">
            <CardHeader className="pb-4 sm:pb-6">
              <CardTitle className="flex items-center gap-2 text-black text-lg sm:text-xl">
                <CheckCircle className="h-5 w-5 sm:h-6 sm:w-6 text-emerald-600 flex-shrink-0" />
                <span>Google Forms ìƒì„± ì™„ë£Œ!</span>
              </CardTitle>
              <CardDescription className="text-sm sm:text-base mt-2">
                ìƒì„±ëœ í¼ì€ ë‚´ ë“œë¼ì´ë¸Œì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë°”ë¡œ í¸ì§‘í•˜ê±°ë‚˜ ì‘ë‹µ ë§í¬ë¥¼ ê³µìœ í•´ë³´ì„¸ìš”.
              </CardDescription>
              <div className="mt-3 px-4 py-3 bg-yellow-50 border-2 border-yellow-400 rounded-lg">
                <p className="text-sm font-semibold text-yellow-800 text-center">
                  âš ï¸ AIëŠ” ì‹¤ìˆ˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ê³µìœ  ì „ ë°˜ë“œì‹œ í™•ì¸í•˜ì„¸ìš”!
                </p>
              </div>
            </CardHeader>
            <CardContent className="space-y-4 sm:space-y-5">
              <div className="flex flex-col gap-3 sm:flex-row sm:gap-4">
                <Button
                  onClick={() => window.open(creationResult.formUrl, '_blank')}
                  className="flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white h-11 sm:h-12 text-sm sm:text-base font-medium rounded-lg shadow-sm hover:shadow-md transition-all duration-200"
                >
                  <FileText className="h-4 w-4 sm:h-5 sm:w-5" />
                  <span>í¸ì§‘ í™”ë©´ ì—´ê¸°</span>
                </Button>
                <Button
                  variant="outline"
                  onClick={() => window.open(creationResult.responderUrl, '_blank')}
                  className="flex items-center justify-center gap-2 border-blue-600 text-blue-600 hover:bg-blue-50 h-11 sm:h-12 text-sm sm:text-base font-medium rounded-lg shadow-sm hover:shadow-md transition-all duration-200"
                >
                  <ExternalLink className="h-4 w-4 sm:h-5 sm:w-5" />
                  <span>ì‘ë‹µ ë§í¬ ì—´ê¸°</span>
                </Button>
              </div>
              <div className="rounded-lg bg-gray-50 border border-gray-200 p-4 sm:p-5 text-xs sm:text-sm text-gray-700 space-y-3">
                <div>
                  <span className="font-semibold text-gray-900">í¼ ID:</span>{' '}
                  <span className="font-mono text-gray-600 break-all">{creationResult.formId}</span>
                </div>
                <div className="pt-2 border-t border-gray-300">
                  <span className="font-semibold text-gray-900 block mb-1">ê³µìœ  ë§í¬:</span>
                  <a
                    href={creationResult.responderUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-blue-600 hover:text-blue-800 hover:underline break-all inline-block"
                  >
                    {creationResult.responderUrl}
                  </a>
                </div>
              </div>
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  );
}


================================================
FILE: src/app/dashboard/page.tsx
================================================
"use client";
import { useSession, signOut } from "next-auth/react";
import { useRouter } from "next/navigation";
import { useState, useEffect } from "react";

export default function Dashboard() {
  const { data: session, status } = useSession();
  const router = useRouter();
  const [byok, setByok] = useState("");
  const [saving, setSaving] = useState(false);
  const [hasExistingKey, setHasExistingKey] = useState(false);
  const [loadingKey, setLoadingKey] = useState(true);
  interface PreviewData {
    title: string;
    questions?: Array<{
      title: string;
      options?: string[];
    }>;
  }
  const [preview, setPreview] = useState<PreviewData | null>(null);
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState<string | null>(null);

  // Load existing API key on mount
  useEffect(() => {
    async function loadApiKey() {
      if (!session?.user?.email) {
        setLoadingKey(false);
        return;
      }

      try {
        const res = await fetch("/api/secrets/get");
        const json = await res.json();

        if (res.ok && json.exists && json.key) {
          setByok(json.key);
          setHasExistingKey(true);
          setSuccess("âœ… ì €ì¥ëœ Gemini API í‚¤ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.");
        }
      } catch (e) {
        console.error("Failed to load API key:", e);
      } finally {
        setLoadingKey(false);
      }
    }

    loadApiKey();
  }, [session]);

  async function saveBYOK() {
    setSaving(true);
    setError(null);
    setSuccess(null);
    try {
      const res = await fetch("/api/secrets/set", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ key: byok.trim() }),
      });
      const json = await res.json();
      if (!res.ok) throw new Error(json.error || "ì €ì¥ ì‹¤íŒ¨");
      setHasExistingKey(true);
      setSuccess("âœ… Gemini API í‚¤ë¥¼ ì•ˆì „í•˜ê²Œ ì €ì¥í–ˆì–´ìš”!");
    } catch (e: unknown) {
      setError(e instanceof Error ? e.message : String(e));
    } finally {
      setSaving(false);
    }
  }

  async function generatePreview() {
    setError(null);
    setSuccess(null);
    try {
      const res = await fetch("/api/ai/preview", { method: "POST" });
      const json = await res.json();
      if (!res.ok) throw new Error(json.error || "ë¯¸ë¦¬ë³´ê¸° ì‹¤íŒ¨");
      setPreview(json.preview);
    } catch (e: unknown) {
      setError(e instanceof Error ? e.message : String(e));
    }
  }

  if (status === "loading") return <div className="p-8">ë¡œë”© ì¤‘â€¦</div>;
  if (!session)
    return (
      <div className="flex min-h-screen items-center justify-center p-8 text-center">
        <div className="max-w-md space-y-4">
          <h1 className="text-2xl font-semibold">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h1>
          <p className="text-zinc-600">í™ˆ í™”ë©´ì—ì„œ Googleë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
        </div>
      </div>
    );

  return (
    <div className="mx-auto max-w-2xl space-y-8 p-6">
      <header className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-semibold">TeaBoard Forms</h1>
          <p className="text-sm text-zinc-600">{session.user?.email}</p>
        </div>
        <button
          onClick={() => signOut({ callbackUrl: "/" })}
          className="rounded-full border px-4 py-2 text-sm hover:bg-zinc-100"
        >
          ë¡œê·¸ì•„ì›ƒ
        </button>
      </header>

      <section className="space-y-3 rounded-2xl border-[1.5px] border-black bg-white p-6 shadow-sm">
        <h2 className="text-lg font-medium">í•„ìˆ˜ ì¤€ë¹„ í•œëˆˆì—</h2>
        <p className="text-sm text-zinc-600">
          Google ë¡œê·¸ì¸ìœ¼ë¡œ Forms ê¶Œí•œì€ ì´ë¯¸ ì—°ê²°ëì–´ìš”. ì•„ë˜ ë‘ ê°€ì§€ë§Œ ì™„ë£Œí•˜ë©´ ë°”ë¡œ í¼ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        <ul className="space-y-2 text-sm text-zinc-700">
          <li>â€¢ Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ë©´ AI ë¯¸ë¦¬ë³´ê¸°ì™€ ìë™ ìƒì„± ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.</li>
          <li>â€¢ ì›í•˜ëŠ” í¼ ì´ˆì•ˆì„ ì‘ì„±í•œ ë’¤, Google Formsë¡œ í•œ ë²ˆì— ë‚´ë³´ë‚´ë©´ ë©ë‹ˆë‹¤.</li>
        </ul>
        <button
          onClick={() => router.push('/create')}
          className="mt-4 w-full rounded-md bg-blue-600 px-4 py-3 text-white font-medium hover:bg-blue-700 transition-colors"
        >
          ğŸ¯ í€´ì¦ˆ/ì„¤ë¬¸ ìƒì„±í•˜ê¸°
        </button>
      </section>

      <section className="space-y-4 rounded-2xl border-[1.5px] border-black bg-white p-6 shadow-sm">
        <div className="flex items-center justify-between">
          <h2 className="text-lg font-medium">Gemini BYOK ì…ë ¥</h2>
          {loadingKey && (
            <span className="text-sm text-zinc-500">í‚¤ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
          )}
          {!loadingKey && hasExistingKey && (
            <span className="text-sm text-emerald-600">âœ“ í‚¤ ì €ì¥ë¨</span>
          )}
        </div>
        <input
          type="password"
          placeholder="Gemini API Key"
          value={byok}
          onChange={(e) => setByok(e.target.value)}
          className="w-full rounded-md border px-3 py-2"
          disabled={loadingKey}
        />
        <div className="flex gap-2">
          <button
            onClick={saveBYOK}
            disabled={saving || !byok.trim() || loadingKey}
            className="rounded-md bg-black px-4 py-2 text-white disabled:opacity-50"
          >
            {saving ? "ì €ì¥ ì¤‘â€¦" : hasExistingKey ? "í‚¤ ì—…ë°ì´íŠ¸" : "í‚¤ ì €ì¥"}
          </button>
          <button
            onClick={generatePreview}
            className="rounded-md border px-4 py-2"
            disabled={loadingKey}
          >
            ì„¤ë¬¸ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
          </button>
        </div>
        {success && <p className="text-sm text-emerald-600">{success}</p>}
        {error && <p className="text-sm text-red-600">{error}</p>}
      </section>

      {preview && (
        <section className="space-y-3 rounded-2xl border-[1.5px] border-black bg-white p-6 shadow-sm">
          <h2 className="text-lg font-medium">ë¯¸ë¦¬ë³´ê¸°</h2>
          <p className="text-zinc-700">{preview.title}</p>
          <ul className="list-disc pl-5 text-zinc-700">
            {preview.questions?.map((q, idx: number) => (
              <li key={idx}>
                <strong>{q.title}</strong>
                {q.options && (
                  <ul className="mt-1 list-disc pl-5 text-sm">
                    {q.options.map((o: string, i: number) => (
                      <li key={i}>{o}</li>
                    ))}
                  </ul>
                )}
              </li>
            ))}
          </ul>
        </section>
      )}
    </div>
  );
}



================================================
FILE: src/app/privacy/page.tsx
================================================
[Binary file]


================================================
FILE: src/app/privacy/en/page.tsx
================================================
import Link from 'next/link';
import { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'Privacy Policy | Teaboard Forms',
  description: 'Teaboard Forms data collection, usage, and protection policy - OAuth Verified',
};

export default function PrivacyPageEN() {
  return (
    <div className="min-h-screen bg-white py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-4xl mx-auto">
        <div className="flex justify-between items-center mb-6">
          <Link href="/" className="text-blue-600 hover:text-blue-800 font-medium">
            â† Back to Home
          </Link>
          <Link href="/privacy" className="text-sm text-gray-600 hover:text-gray-900">
            ğŸ‡°ğŸ‡· í•œêµ­ì–´
          </Link>
        </div>
        <div className="border-2 border-black p-8">
          <h1 className="text-3xl font-bold text-black mb-2 uppercase tracking-wide">
            Privacy Policy
          </h1>
          <p className="text-sm text-gray-600 mb-8">Last Updated: November 7, 2025 | Google OAuth Verified</p>

          <div className="space-y-8">
            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                1. Information We Collect
              </h2>
              <p className="text-gray-700 mb-3">
                Teaboard Forms collects the following information through Google OAuth authentication:
              </p>

              <div className="bg-gray-50 border-2 border-gray-300 p-4 mb-4">
                <h3 className="font-bold text-black mb-2">ğŸ“Š Data Collection Details</h3>
                <table className="w-full text-sm">
                  <thead className="bg-gray-200">
                    <tr>
                      <th className="border border-gray-300 p-2 text-left">Data Type</th>
                      <th className="border border-gray-300 p-2 text-left">Required/Optional</th>
                      <th className="border border-gray-300 p-2 text-left">Purpose</th>
                      <th className="border border-gray-300 p-2 text-left">Retention Period</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td className="border border-gray-300 p-2">Email Address</td>
                      <td className="border border-gray-300 p-2">Required</td>
                      <td className="border border-gray-300 p-2">User identification, authentication</td>
                      <td className="border border-gray-300 p-2">Until account deletion</td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 p-2">Name</td>
                      <td className="border border-gray-300 p-2">Optional</td>
                      <td className="border border-gray-300 p-2">Service personalization</td>
                      <td className="border border-gray-300 p-2">Until account deletion</td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 p-2">Profile Information</td>
                      <td className="border border-gray-300 p-2">Optional</td>
                      <td className="border border-gray-300 p-2">User experience enhancement</td>
                      <td className="border border-gray-300 p-2">Until account deletion</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <p className="text-gray-700 mb-2">
                <strong>Collection Method:</strong> Google OAuth 2.0 authentication process
              </p>
              <p className="text-gray-700">
                <strong>Storage Location:</strong> Firebase Realtime Database (US servers, encrypted storage)
              </p>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                2. Purpose of Collection and Use
              </h2>
              <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                <li>User identification and authentication</li>
                <li>Automated Google Forms generation service</li>
                <li>Management of user-created quizzes and surveys</li>
                <li>Service improvement and statistical analysis</li>
              </ul>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                3. Google API Scopes and Data Protection
              </h2>
              <p className="text-gray-700 mb-3">
                This service requests the following Google API permissions:
              </p>

              <div className="bg-blue-50 border-2 border-blue-300 p-4 mb-4">
                <h3 className="font-bold text-black mb-3">ğŸ” OAuth Scopes Details</h3>
                <table className="w-full text-sm">
                  <thead className="bg-blue-200">
                    <tr>
                      <th className="border border-blue-300 p-2 text-left">OAuth Scope</th>
                      <th className="border border-blue-300 p-2 text-left">Classification</th>
                      <th className="border border-blue-300 p-2 text-left">Purpose</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td className="border border-blue-300 p-2"><code className="text-xs">openid</code></td>
                      <td className="border border-blue-300 p-2">Non-sensitive</td>
                      <td className="border border-blue-300 p-2">OpenID Connect authentication</td>
                    </tr>
                    <tr>
                      <td className="border border-blue-300 p-2"><code className="text-xs">email</code></td>
                      <td className="border border-blue-300 p-2">Non-sensitive</td>
                      <td className="border border-blue-300 p-2">User email verification</td>
                    </tr>
                    <tr>
                      <td className="border border-blue-300 p-2"><code className="text-xs">profile</code></td>
                      <td className="border border-blue-300 p-2">Non-sensitive</td>
                      <td className="border border-blue-300 p-2">Basic profile information (name)</td>
                    </tr>
                    <tr>
                      <td className="border border-blue-300 p-2"><code className="text-xs">forms.body</code></td>
                      <td className="border border-blue-300 p-2">Restricted</td>
                      <td className="border border-blue-300 p-2">Create and edit Google Forms (user-initiated only)</td>
                    </tr>
                    <tr>
                      <td className="border border-blue-300 p-2"><code className="text-xs">drive.file</code></td>
                      <td className="border border-blue-300 p-2">Non-sensitive</td>
                      <td className="border border-blue-300 p-2">Access only app-created Forms files</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div className="bg-yellow-50 border-2 border-yellow-400 p-4">
                <h3 className="font-bold text-black mb-2">âš ï¸ Important Notice</h3>
                <ul className="list-disc list-inside space-y-1 text-gray-700 ml-2">
                  <li>These permissions are used exclusively for creating user-requested quizzes/surveys in Google Forms.</li>
                  <li>The <code>drive.file</code> permission only accesses files created by this app, not your other Drive files.</li>
                  <li>Collected data will not be shared with third parties without user consent.</li>
                  <li>All data transmission is protected through TLS 1.3 encryption.</li>
                </ul>
              </div>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                4. Sensitive Data Protection Mechanisms
              </h2>
              <p className="text-gray-700 mb-4">
                Teaboard Forms protects user personal information and sensitive data through the following technical and administrative safeguards:
              </p>

              <div className="space-y-4">
                <div className="bg-green-50 border-2 border-green-400 p-4">
                  <h3 className="font-bold text-black mb-3">ğŸ”’ 1. Encryption in Transit</h3>
                  <ul className="list-disc list-inside space-y-1 text-gray-700 ml-2">
                    <li><strong>TLS 1.3 Encryption:</strong> All data transmission uses the latest TLS 1.3 protocol for encryption.</li>
                    <li><strong>HTTPS Enforcement:</strong> All HTTP requests are automatically redirected to HTTPS via Vercel platform.</li>
                    <li><strong>Certificate Management:</strong> Secure connection guaranteed through Let&apos;s Encrypt SSL/TLS certificates</li>
                  </ul>
                </div>

                <div className="bg-green-50 border-2 border-green-400 p-4">
                  <h3 className="font-bold text-black mb-3">ğŸ›¡ï¸ 2. Encryption at Rest</h3>
                  <ul className="list-disc list-inside space-y-1 text-gray-700 ml-2">
                    <li><strong>AES-256 Encryption:</strong> All user data stored in Firebase Realtime Database is encrypted with AES-256 algorithm.</li>
                    <li><strong>Automatic Backups:</strong> Daily automatic backups prevent data loss (backup data is also encrypted)</li>
                    <li><strong>Secure Storage:</strong> Stored in certified Google Cloud Platform data centers</li>
                  </ul>
                </div>

                <div className="bg-green-50 border-2 border-green-400 p-4">
                  <h3 className="font-bold text-black mb-3">ğŸ‘¤ 3. Access Control</h3>
                  <ul className="list-disc list-inside space-y-1 text-gray-700 ml-2">
                    <li><strong>Role-Based Access Control (RBAC):</strong> User-specific data access management through Firebase Security Rules</li>
                    <li><strong>Principle of Least Privilege:</strong> Each user can only access their own data</li>
                    <li><strong>Admin Restrictions:</strong> System administrators cannot directly access user data (exists only in encrypted state)</li>
                    <li><strong>Multi-Factor Authentication (MFA):</strong> Two-factor authentication required for admin console access</li>
                  </ul>
                </div>

                <div className="bg-green-50 border-2 border-green-400 p-4">
                  <h3 className="font-bold text-black mb-3">ğŸ“Š 4. Logging & Auditing</h3>
                  <ul className="list-disc list-inside space-y-1 text-gray-700 ml-2">
                    <li><strong>Access Logs:</strong> All data access attempts are recorded and monitored.</li>
                    <li><strong>Anomaly Detection:</strong> Automatic detection and alerts for abnormal access patterns</li>
                    <li><strong>Log Retention:</strong> Security logs are securely stored for at least 1 year</li>
                    <li><strong>Real-time Monitoring:</strong> Real-time system status monitoring via Vercel Analytics</li>
                  </ul>
                </div>

                <div className="bg-green-50 border-2 border-green-400 p-4">
                  <h3 className="font-bold text-black mb-3">ğŸš¨ 5. Incident Response</h3>
                  <ul className="list-disc list-inside space-y-1 text-gray-700 ml-2">
                    <li><strong>24/7 Monitoring:</strong> Real-time security incident detection system</li>
                    <li><strong>Immediate Response Process:</strong> User notification within 72 hours of incident discovery</li>
                    <li><strong>Incident Investigation:</strong> Root cause analysis and recurrence prevention measures for all security incidents</li>
                    <li><strong>Recovery Procedures:</strong> Automated recovery system to ensure data integrity</li>
                  </ul>
                </div>

                <div className="bg-green-50 border-2 border-green-400 p-4">
                  <h3 className="font-bold text-black mb-3">ğŸ¢ 6. Infrastructure Security</h3>
                  <ul className="list-disc list-inside space-y-1 text-gray-700 ml-2">
                    <li><strong>Certified Cloud:</strong> Google Cloud Platform (ISO 27001, SOC 2 Type II certified)</li>
                    <li><strong>DDoS Protection:</strong> Enterprise-grade DDoS attack defense by Vercel</li>
                    <li><strong>Firewall:</strong> Network-level intrusion prevention system</li>
                    <li><strong>Regular Security Updates:</strong> Automated security patches for all system components</li>
                  </ul>
                </div>

                <div className="bg-blue-50 border-2 border-blue-300 p-4">
                  <h3 className="font-bold text-black mb-3">ğŸ“œ 7. Compliance</h3>
                  <ul className="list-disc list-inside space-y-1 text-gray-700 ml-2">
                    <li><strong>GDPR Compliance:</strong> Complies with European General Data Protection Regulation</li>
                    <li><strong>Korean Privacy Law:</strong> Complies with Korean Personal Information Protection Act</li>
                    <li><strong>OWASP Top 10:</strong> Defends against web application security vulnerabilities</li>
                    <li><strong>Regular Security Audits:</strong> Vulnerability assessments by external security experts twice a year</li>
                  </ul>
                </div>
              </div>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                5. Data Retention Period
              </h2>
              <p className="text-gray-700 mb-3">
                Personal information is immediately destroyed upon account deletion or when a deletion request is made.
                However, data may be retained for legally required periods as stipulated by relevant laws.
              </p>

              <div className="bg-gray-50 border-2 border-gray-300 p-4">
                <h3 className="font-bold text-black mb-3">ğŸ“… Detailed Retention Periods</h3>
                <table className="w-full text-sm">
                  <thead className="bg-gray-200">
                    <tr>
                      <th className="border border-gray-300 p-2 text-left">Data Type</th>
                      <th className="border border-gray-300 p-2 text-left">Retention Period</th>
                      <th className="border border-gray-300 p-2 text-left">Legal Basis</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td className="border border-gray-300 p-2">Account information (email, name)</td>
                      <td className="border border-gray-300 p-2">Until account deletion</td>
                      <td className="border border-gray-300 p-2">User consent</td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 p-2">Created Google Forms data</td>
                      <td className="border border-gray-300 p-2">Until user deletion</td>
                      <td className="border border-gray-300 p-2">Service provision</td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 p-2">Access logs (security purposes)</td>
                      <td className="border border-gray-300 p-2">1 year</td>
                      <td className="border border-gray-300 p-2">Communications Privacy Law</td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 p-2">Payment information (if applicable)</td>
                      <td className="border border-gray-300 p-2">5 years</td>
                      <td className="border border-gray-300 p-2">E-Commerce Act</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <p className="text-gray-700 mt-3">
                <strong>Automatic Deletion:</strong> Personal information is permanently deleted in an irrecoverable manner immediately after account deletion.
              </p>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                6. Third-Party Data Sharing
              </h2>
              <p className="text-gray-700 mb-3">
                Teaboard Forms does not sell or arbitrarily provide user personal information to third parties.
                Data is shared only in the following limited cases:
              </p>

              <div className="bg-purple-50 border-2 border-purple-300 p-4">
                <h3 className="font-bold text-black mb-3">ğŸ”— Third-Party Service Providers</h3>
                <table className="w-full text-sm">
                  <thead className="bg-purple-200">
                    <tr>
                      <th className="border border-purple-300 p-2 text-left">Recipient</th>
                      <th className="border border-purple-300 p-2 text-left">Purpose</th>
                      <th className="border border-purple-300 p-2 text-left">Data Provided</th>
                      <th className="border border-purple-300 p-2 text-left">Retention Period</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td className="border border-purple-300 p-2">Google LLC</td>
                      <td className="border border-purple-300 p-2">OAuth authentication, Forms/Drive API</td>
                      <td className="border border-purple-300 p-2">Email, Name (optional)</td>
                      <td className="border border-purple-300 p-2">Until user consent withdrawal</td>
                    </tr>
                    <tr>
                      <td className="border border-purple-300 p-2">Vercel Inc.</td>
                      <td className="border border-purple-300 p-2">Hosting, CDN, performance monitoring</td>
                      <td className="border border-purple-300 p-2">Access logs, IP addresses</td>
                      <td className="border border-purple-300 p-2">Service provision period</td>
                    </tr>
                    <tr>
                      <td className="border border-purple-300 p-2">Google (Gemini AI)</td>
                      <td className="border border-purple-300 p-2">Quiz generation AI</td>
                      <td className="border border-purple-300 p-2">User-entered text</td>
                      <td className="border border-purple-300 p-2">Immediately deleted after processing</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div className="bg-yellow-50 border-2 border-yellow-400 p-4 mt-4">
                <h3 className="font-bold text-black mb-2">ğŸŒ International Data Transfer</h3>
                <ul className="list-disc list-inside space-y-1 text-gray-700 ml-2">
                  <li><strong>Transfer Countries:</strong> United States (Google Cloud Platform, Vercel)</li>
                  <li><strong>Transfer Purpose:</strong> Cloud service provision and data storage</li>
                  <li><strong>Protection Measures:</strong> EU-US Privacy Shield certification, Standard Contractual Clauses (SCC)</li>
                  <li><strong>Security:</strong> Maintained at protection level equal to or higher than domestic laws</li>
                </ul>
              </div>

              <p className="text-gray-700 mt-3">
                <strong>Consent Withdrawal:</strong> Users can revoke app access permissions at any time through Google Account settings.
              </p>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                7. Data Deletion Procedures
              </h2>
              <p className="text-gray-700 mb-3">
                When users request account deletion or personal information removal,
                we follow these procedures to destroy personal information:
              </p>
              <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                <li>Deletion Process: Account deletion request received â†’ Immediate personal information deletion</li>
                <li>Deletion Method: Electronic file information is permanently deleted using irrecoverable methods</li>
              </ul>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                8. User Rights and How to Exercise Them
              </h2>
              <p className="text-gray-700 mb-3">
                Users (data subjects) can exercise the following rights at any time:
              </p>

              <div className="space-y-3">
                <div className="bg-blue-50 border-l-4 border-blue-500 p-3">
                  <h3 className="font-bold text-black mb-1">ğŸ‘ï¸ 1. Right to Access</h3>
                  <p className="text-sm text-gray-700">Right to verify how your personal information is collected and used</p>
                  <p className="text-xs text-gray-600 mt-1"><strong>Method:</strong> Check on your profile page after login</p>
                </div>

                <div className="bg-blue-50 border-l-4 border-blue-500 p-3">
                  <h3 className="font-bold text-black mb-1">âœï¸ 2. Right to Rectification</h3>
                  <p className="text-sm text-gray-700">Right to request correction if your personal information is inaccurate or incomplete</p>
                  <p className="text-xs text-gray-600 mt-1"><strong>Method:</strong> Edit directly on your profile page or request from administrator</p>
                </div>

                <div className="bg-blue-50 border-l-4 border-blue-500 p-3">
                  <h3 className="font-bold text-black mb-1">ğŸ—‘ï¸ 3. Right to Erasure (Right to Be Forgotten)</h3>
                  <p className="text-sm text-gray-700">Right to request deletion of personal information when processing purpose is achieved or consent is withdrawn</p>
                  <p className="text-xs text-gray-600 mt-1"><strong>Method:</strong> Automatic deletion upon account deletion or request deletion from administrator</p>
                </div>

                <div className="bg-blue-50 border-l-4 border-blue-500 p-3">
                  <h3 className="font-bold text-black mb-1">â¸ï¸ 4. Right to Restriction of Processing</h3>
                  <p className="text-sm text-gray-700">Right to withdraw consent or request suspension of personal information processing</p>
                  <p className="text-xs text-gray-600 mt-1"><strong>Method:</strong> Revoke app access permissions in Google Account settings</p>
                </div>

                <div className="bg-blue-50 border-l-4 border-blue-500 p-3">
                  <h3 className="font-bold text-black mb-1">ğŸ“¦ 5. Right to Data Portability</h3>
                  <p className="text-sm text-gray-700">Right to receive your personal information in a machine-readable format</p>
                  <p className="text-xs text-gray-600 mt-1"><strong>Method:</strong> Request data download from administrator (provided in JSON format)</p>
                </div>

                <div className="bg-blue-50 border-l-4 border-blue-500 p-3">
                  <h3 className="font-bold text-black mb-1">ğŸš« 6. Right to Withdraw Consent</h3>
                  <p className="text-sm text-gray-700">Right to withdraw consent for collection and use of personal information at any time</p>
                  <p className="text-xs text-gray-600 mt-1"><strong>Method:</strong> Google Account &gt; Security &gt; Remove Teaboard Forms access permissions</p>
                </div>
              </div>

              <div className="bg-gray-100 border-2 border-gray-400 p-4 mt-4">
                <h3 className="font-bold text-black mb-2">ğŸ“ Rights Exercise Procedure</h3>
                <ol className="list-decimal list-inside space-y-1 text-sm text-gray-700 ml-2">
                  <li>Contact the Data Protection Officer below by mail, phone, or email</li>
                  <li>Identity verification process (email address verification)</li>
                  <li>Review of request (verification of legal restrictions)</li>
                  <li>Notification of action results within 10 days</li>
                  <li>Immediate action when there is a legitimate reason (immediate deletion for erasure requests)</li>
                </ol>
              </div>

              <p className="text-gray-700 mt-3 text-sm">
                <strong>âš ï¸ Notice:</strong> Rights exercise may be limited when required by law or necessary for legal obligations.
                In such cases, we will clearly inform you of the reasons.
              </p>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                9. Data Protection Officer and Complaints
              </h2>
              <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-400 p-6">
                <h3 className="font-bold text-black mb-4 text-lg">ğŸ‘¤ Data Protection Officer (DPO)</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <p className="text-gray-700 mb-1"><strong>Name:</strong> Moon-Jung Kim</p>
                    <p className="text-gray-700 mb-1"><strong>Organization:</strong> Teaboard Forms / Anyang Bakdal Elementary School</p>
                    <p className="text-gray-700 mb-1"><strong>Position:</strong> Developer and Operator</p>
                  </div>
                  <div>
                    <p className="text-gray-700 mb-1">
                      <strong>Contact Methods:</strong>
                    </p>
                    <ul className="list-disc list-inside ml-4 text-sm text-gray-700">
                      <li>
                        <a
                          href="https://open.kakao.com/o/gubGYQ7g"
                          target="_blank"
                          rel="noopener noreferrer"
                          className="text-blue-600 underline hover:text-blue-800"
                        >
                          KakaoTalk Open Chat (24/7)
                        </a>
                      </li>
                      <li>Email: usmjkim23@gmail.com</li>
                    </ul>
                  </div>
                </div>

                <div className="mt-4 pt-4 border-t border-blue-300">
                  <h4 className="font-bold text-black mb-2">âš–ï¸ Privacy Violation Remedy and Reporting</h4>
                  <p className="text-sm text-gray-700 mb-2">
                    If you need to report or consult about privacy violations, you can contact the following organizations:
                  </p>
                  <ul className="list-disc list-inside ml-4 text-xs text-gray-700 space-y-1">
                    <li><strong>Privacy Complaint Center (Korea):</strong> 118 | <a href="https://privacy.kisa.or.kr" className="text-blue-600 underline">privacy.kisa.or.kr</a></li>
                    <li><strong>Personal Information Dispute Mediation Committee:</strong> 1833-6972 | <a href="https://www.kopico.go.kr" className="text-blue-600 underline">www.kopico.go.kr</a></li>
                    <li><strong>Supreme Prosecutors&apos; Office Cybercrime Investigation Division:</strong> 1301 | <a href="https://www.spo.go.kr" className="text-blue-600 underline">www.spo.go.kr</a></li>
                    <li><strong>Korean National Police Agency Cyber Bureau:</strong> 182 | <a href="https://cyberbureau.police.go.kr" className="text-blue-600 underline">cyberbureau.police.go.kr</a></li>
                  </ul>
                </div>
              </div>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                10. Privacy Policy Changes
              </h2>
              <p className="text-gray-700 mb-3">
                This privacy policy may be modified to reflect changes in laws and services,
                and changes will be announced through the website.
              </p>

              <div className="bg-yellow-50 border-2 border-yellow-400 p-4">
                <h3 className="font-bold text-black mb-2">ğŸ“¢ Change Notification Method</h3>
                <ul className="list-disc list-inside space-y-1 text-sm text-gray-700 ml-2">
                  <li>Posted on homepage notice board 7 days before changes</li>
                  <li>Individual email notification for significant changes</li>
                  <li>Changes can be confirmed by the &quot;Last Updated&quot; date at the top of this page</li>
                </ul>
              </div>

              <div className="mt-4 bg-gray-100 border border-gray-300 p-4">
                <h3 className="font-bold text-black mb-2">ğŸ“œ Revision History</h3>
                <table className="w-full text-xs">
                  <thead className="bg-gray-200">
                    <tr>
                      <th className="border border-gray-300 p-2 text-left">Version</th>
                      <th className="border border-gray-300 p-2 text-left">Date</th>
                      <th className="border border-gray-300 p-2 text-left">Major Changes</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td className="border border-gray-300 p-2">v2.0</td>
                      <td className="border border-gray-300 p-2">2025-11-07</td>
                      <td className="border border-gray-300 p-2">
                        Google OAuth verification compliance: Detailed specification of sensitive data protection mechanisms,
                        expanded explanation of user rights, clarification of third-party sharing
                      </td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 p-2">v1.0</td>
                      <td className="border border-gray-300 p-2">2025-11-03</td>
                      <td className="border border-gray-300 p-2">Initial version</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>
          </div>

          <div className="mt-12 pt-6 border-t-2 border-black bg-gray-50 p-6">
            <div className="text-center mb-4">
              <p className="text-sm font-bold text-gray-800 mb-2">
                This Privacy Policy is effective from November 7, 2025.
              </p>
              <p className="text-xs text-gray-600">
                (Google OAuth Verification Compliant - Version v2.0)
              </p>
            </div>

            <div className="bg-white border border-gray-300 p-4 mt-4">
              <h4 className="font-bold text-black mb-2 text-sm">âœ… Google OAuth Verification Requirements Met</h4>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-2 text-xs">
                <div className="flex items-start">
                  <span className="text-green-600 mr-1">âœ“</span>
                  <span>Sensitive data protection mechanisms specified</span>
                </div>
                <div className="flex items-start">
                  <span className="text-green-600 mr-1">âœ“</span>
                  <span>TLS 1.3 / AES-256 encryption</span>
                </div>
                <div className="flex items-start">
                  <span className="text-green-600 mr-1">âœ“</span>
                  <span>RBAC access control system</span>
                </div>
                <div className="flex items-start">
                  <span className="text-green-600 mr-1">âœ“</span>
                  <span>Logging and real-time monitoring</span>
                </div>
                <div className="flex items-start">
                  <span className="text-green-600 mr-1">âœ“</span>
                  <span>Incident response processes</span>
                </div>
                <div className="flex items-start">
                  <span className="text-green-600 mr-1">âœ“</span>
                  <span>ISO 27001, SOC 2 certified infrastructure</span>
                </div>
                <div className="flex items-start">
                  <span className="text-green-600 mr-1">âœ“</span>
                  <span>User rights and exercise methods</span>
                </div>
                <div className="flex items-start">
                  <span className="text-green-600 mr-1">âœ“</span>
                  <span>Detailed third-party sharing disclosure</span>
                </div>
                <div className="flex items-start">
                  <span className="text-green-600 mr-1">âœ“</span>
                  <span>GDPR/CCPA compliance</span>
                </div>
              </div>
            </div>

            <p className="text-xs text-gray-500 text-center mt-4">
              Â© 2025 Teaboard Forms. All rights reserved. |
              <Link href="/privacy" className="text-blue-600 hover:underline ml-1">í•œêµ­ì–´ ë²„ì „</Link>
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}



================================================
FILE: src/app/terms/page.tsx
================================================
export default function TermsPage() {
  return (
    <div className="min-h-screen bg-white py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-4xl mx-auto">
        <div className="border-2 border-black p-8">
          <h1 className="text-3xl font-bold text-black mb-2 uppercase tracking-wide">
            ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€
          </h1>
          <p className="text-sm text-gray-600 mb-8">ìµœì¢… ì—…ë°ì´íŠ¸: 2025ë…„ 11ì›” 3ì¼</p>

          <div className="space-y-8">
            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                ì œ1ì¡° (ëª©ì )
              </h2>
              <p className="text-gray-700">
                ë³¸ ì•½ê´€ì€ Teaboard Forms(ì´í•˜ &quot;ì„œë¹„ìŠ¤&quot;)ê°€ ì œê³µí•˜ëŠ”
                AI ê¸°ë°˜ Google Forms ìë™ ìƒì„± ì„œë¹„ìŠ¤ì˜ ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬
                ì„œë¹„ìŠ¤ ì œê³µìì™€ ì´ìš©ìì˜ ê¶Œë¦¬, ì˜ë¬´ ë° ì±…ì„ì‚¬í•­ì„ ê·œì •í•¨ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.
              </p>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                ì œ2ì¡° (ì •ì˜)
              </h2>
              <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                <li>
                  <strong>&quot;ì„œë¹„ìŠ¤&quot;</strong>ë€ Teaboard Formsê°€ ì œê³µí•˜ëŠ”
                  AI ê¸°ë°˜ í€´ì¦ˆ ë° ì„¤ë¬¸ ìë™ ìƒì„± ë° Google Forms ì—°ë™ ì„œë¹„ìŠ¤ë¥¼ ë§í•©ë‹ˆë‹¤.
                </li>
                <li>
                  <strong>&quot;ì´ìš©ì&quot;</strong>ë€ ë³¸ ì•½ê´€ì— ë”°ë¼ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” íšŒì› ë° ë¹„íšŒì›ì„ ë§í•©ë‹ˆë‹¤.
                </li>
                <li>
                  <strong>&quot;íšŒì›&quot;</strong>ë€ Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ìë¥¼ ë§í•©ë‹ˆë‹¤.
                </li>
              </ul>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                ì œ3ì¡° (ì•½ê´€ì˜ íš¨ë ¥ ë° ë³€ê²½)
              </h2>
              <ol className="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                <li>ë³¸ ì•½ê´€ì€ ì„œë¹„ìŠ¤ í™”ë©´ì— ê²Œì‹œí•˜ê±°ë‚˜ ê¸°íƒ€ì˜ ë°©ë²•ìœ¼ë¡œ ê³µì§€í•¨ìœ¼ë¡œì¨ íš¨ë ¥ì´ ë°œìƒí•©ë‹ˆë‹¤.</li>
                <li>
                  ì„œë¹„ìŠ¤ëŠ” í•„ìš”í•œ ê²½ìš° ê´€ë ¨ ë²•ë ¹ì„ ìœ„ë°°í•˜ì§€ ì•ŠëŠ” ë²”ìœ„ì—ì„œ ë³¸ ì•½ê´€ì„ ë³€ê²½í•  ìˆ˜ ìˆìœ¼ë©°,
                  ë³€ê²½ëœ ì•½ê´€ì€ ì œ1í•­ê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ê³µì§€í•©ë‹ˆë‹¤.
                </li>
                <li>
                  ì´ìš©ìê°€ ë³€ê²½ëœ ì•½ê´€ì— ë™ì˜í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì„œë¹„ìŠ¤ ì´ìš©ì„ ì¤‘ë‹¨í•˜ê³  íƒˆí‡´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                ì œ4ì¡° (ì„œë¹„ìŠ¤ì˜ ì œê³µ)
              </h2>
              <p className="text-gray-700 mb-3">ì„œë¹„ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:</p>
              <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                <li>AI ê¸°ë°˜ í€´ì¦ˆ ìë™ ìƒì„±</li>
                <li>AI ê¸°ë°˜ ì„¤ë¬¸ì¡°ì‚¬ ìë™ ìƒì„±</li>
                <li>Google Formsë¡œ ìë™ ë‚´ë³´ë‚´ê¸°</li>
                <li>ìƒì„±ëœ í¼ì˜ ê´€ë¦¬ ë° ìˆ˜ì •</li>
              </ul>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                ì œ5ì¡° (Google API ì‚¬ìš©)
              </h2>
              <ol className="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                <li>
                  ì„œë¹„ìŠ¤ëŠ” Google Forms ìƒì„±ì„ ìœ„í•´ Google APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                </li>
                <li>
                  ì´ìš©ìëŠ” ì„œë¹„ìŠ¤ ì´ìš© ì‹œ Google ê³„ì • ì—°ë™ ë° í•„ìš”í•œ ê¶Œí•œ ì œê³µì— ë™ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
                </li>
                <li>
                  ì„œë¹„ìŠ¤ëŠ” ì´ìš©ìì˜ Google ê³„ì • ì •ë³´ë¥¼ ì„œë¹„ìŠ¤ ì œê³µ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ë©°,
                  ì œ3ìì—ê²Œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                ì œ6ì¡° (ì´ìš©ìì˜ ì˜ë¬´)
              </h2>
              <p className="text-gray-700 mb-3">ì´ìš©ìëŠ” ë‹¤ìŒ í–‰ìœ„ë¥¼ í•˜ì—¬ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤:</p>
              <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                <li>íƒ€ì¸ì˜ ê°œì¸ì •ë³´ë¥¼ ë„ìš©í•˜ê±°ë‚˜ ë¶€ì •í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” í–‰ìœ„</li>
                <li>ì„œë¹„ìŠ¤ì˜ ì •ìƒì ì¸ ìš´ì˜ì„ ë°©í•´í•˜ëŠ” í–‰ìœ„</li>
                <li>ê³µê³µì§ˆì„œ ë° ë¯¸í’ì–‘ì†ì— ìœ„ë°°ë˜ëŠ” ë‚´ìš©ì˜ í€´ì¦ˆ/ì„¤ë¬¸ ìƒì„±</li>
                <li>ì €ì‘ê¶Œ ë“± íƒ€ì¸ì˜ ê¶Œë¦¬ë¥¼ ì¹¨í•´í•˜ëŠ” ì½˜í…ì¸  ìƒì„±</li>
                <li>ì„œë¹„ìŠ¤ë¥¼ ìƒì—…ì  ëª©ì ìœ¼ë¡œ ë¬´ë‹¨ ì´ìš©í•˜ëŠ” í–‰ìœ„</li>
              </ul>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                ì œ7ì¡° (ì €ì‘ê¶Œ ë° ì§€ì ì¬ì‚°ê¶Œ)
              </h2>
              <ol className="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                <li>
                  ì„œë¹„ìŠ¤ê°€ ì œê³µí•˜ëŠ” ëª¨ë“  ì½˜í…ì¸ (ë””ìì¸, ë¡œê³ , ì†Œí”„íŠ¸ì›¨ì–´ ë“±)ì— ëŒ€í•œ
                  ì €ì‘ê¶Œ ë° ì§€ì ì¬ì‚°ê¶Œì€ Teaboard Formsì— ìˆìŠµë‹ˆë‹¤.
                </li>
                <li>
                  ì´ìš©ìê°€ ìƒì„±í•œ í€´ì¦ˆ ë° ì„¤ë¬¸ì˜ ì €ì‘ê¶Œì€ ì´ìš©ìì—ê²Œ ìˆìœ¼ë©°,
                  ì„œë¹„ìŠ¤ëŠ” ì´ë¥¼ ì„œë¹„ìŠ¤ ê°œì„  ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                ì œ8ì¡° (ë©´ì±… ì¡°í•­)
              </h2>
              <ol className="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                <li>
                  ì„œë¹„ìŠ¤ëŠ” AI ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ ì½˜í…ì¸ ë¥¼ ìƒì„±í•˜ë©°,
                  ìƒì„±ëœ ë‚´ìš©ì˜ ì •í™•ì„±ê³¼ ì ì ˆì„±ì— ëŒ€í•´ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </li>
                <li>
                  ì´ìš©ìëŠ” AIê°€ ìƒì„±í•œ ì½˜í…ì¸ ë¥¼ ì‚¬ìš©í•˜ê¸° ì „ ë°˜ë“œì‹œ ê²€í† í•˜ê³  ìˆ˜ì •í•´ì•¼ í•˜ë©°,
                  ì´ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ë¬¸ì œì— ëŒ€í•œ ì±…ì„ì€ ì´ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.
                </li>
                <li>
                  ì„œë¹„ìŠ¤ëŠ” ì²œì¬ì§€ë³€, ì‹œìŠ¤í…œ ì¥ì• , Google API ì¥ì•  ë“±
                  ë¶ˆê°€í•­ë ¥ì ì¸ ì‚¬ìœ ë¡œ ì¸í•œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì— ëŒ€í•´ ì±…ì„ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                ì œ9ì¡° (ì„œë¹„ìŠ¤ì˜ ë³€ê²½ ë° ì¤‘ë‹¨)
              </h2>
              <p className="text-gray-700">
                ì„œë¹„ìŠ¤ëŠ” ìš´ì˜ìƒ ë˜ëŠ” ê¸°ìˆ ìƒì˜ í•„ìš”ì— ë”°ë¼ ì œê³µí•˜ê³  ìˆëŠ” ì„œë¹„ìŠ¤ì˜ ì „ë¶€ ë˜ëŠ” ì¼ë¶€ë¥¼
                ë³€ê²½í•˜ê±°ë‚˜ ì¤‘ë‹¨í•  ìˆ˜ ìˆìœ¼ë©°, ì´ ê²½ìš° ì‚¬ì „ì— ê³µì§€í•©ë‹ˆë‹¤.
              </p>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                ì œ10ì¡° (ë¶„ìŸ í•´ê²°)
              </h2>
              <ol className="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                <li>
                  ë³¸ ì•½ê´€ì— ëª…ì‹œë˜ì§€ ì•Šì€ ì‚¬í•­ì€ ê´€ë ¨ ë²•ë ¹ ë° ìƒê´€ë¡€ì— ë”°ë¦…ë‹ˆë‹¤.
                </li>
                <li>
                  ì„œë¹„ìŠ¤ ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ ë°œìƒí•œ ë¶„ìŸì— ëŒ€í•´ì„œëŠ” ëŒ€í•œë¯¼êµ­ ë²•ë¥ ì„ ì ìš©í•©ë‹ˆë‹¤.
                </li>
              </ol>
            </section>

            <section>
              <h2 className="text-xl font-bold text-black mb-4 border-b-2 border-black pb-2">
                ì œ11ì¡° (ë¬¸ì˜ ë° ì—°ë½ì²˜)
              </h2>
              <div className="bg-gray-50 border-2 border-black p-6">
                <p className="text-gray-700">
                  <strong>ì„œë¹„ìŠ¤ ì œê³µì:</strong> Teaboard Forms
                </p>
                <p className="text-gray-700">
                  <strong>ì±…ì„ì:</strong> ê¹€ë¬¸ì • (Moon-Jung Kim)
                </p>
                <p className="text-gray-700">
                  <strong>ì´ë©”ì¼:</strong> usmjkim23@gmail.com
                </p>
                <p className="text-gray-700">
                  <strong>ì¹´ì¹´ì˜¤í†¡ ë¬¸ì˜:</strong>{' '}
                  <a
                    href="https://open.kakao.com/o/gubGYQ7g"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-blue-600 underline hover:text-blue-800"
                  >
                    ê°œë°œì ì—°ë½í•˜ê¸°
                  </a>
                </p>
              </div>
            </section>
          </div>

          <div className="mt-12 pt-6 border-t-2 border-black">
            <p className="text-sm text-gray-600 text-center">
              ë³¸ ì•½ê´€ì€ 2025ë…„ 11ì›” 3ì¼ë¶€í„° ì ìš©ë©ë‹ˆë‹¤.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}



================================================
FILE: src/components/GeminiKeyInput.tsx
================================================
'use client';

import { useState, useEffect } from 'react';
import { useSession } from 'next-auth/react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Key, Eye, EyeOff, Loader2 } from 'lucide-react';

interface GeminiKeyInputProps {
  onKeySet: (key: string) => void;
}

export default function GeminiKeyInput({ onKeySet }: GeminiKeyInputProps) {
  const { data: session } = useSession();
  const [apiKey, setApiKey] = useState('');
  const [showKey, setShowKey] = useState(false);
  const [isStored, setIsStored] = useState(false);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);

  useEffect(() => {
    // Firebaseì—ì„œ API í‚¤ í™•ì¸
    async function loadApiKey() {
      if (!session?.user?.email) {
        setLoading(false);
        return;
      }

      try {
        const res = await fetch("/api/secrets/get");
        const json = await res.json();

        if (res.ok && json.exists && json.key) {
          setApiKey(json.key);
          setIsStored(true);
          onKeySet(json.key);
        }
      } catch (e) {
        console.error("Failed to load API key:", e);
      } finally {
        setLoading(false);
      }
    }

    loadApiKey();
  }, [session, onKeySet]);

  const handleSaveKey = async () => {
    if (!apiKey.trim()) return;

    setSaving(true);
    try {
      const res = await fetch("/api/secrets/set", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ key: apiKey.trim() }),
      });
      const json = await res.json();

      if (!res.ok) {
        throw new Error(json.error || "ì €ì¥ ì‹¤íŒ¨");
      }

      setIsStored(true);
      onKeySet(apiKey.trim());
    } catch (error) {
      console.error("Failed to save API key:", error);
      alert(error instanceof Error ? error.message : "API í‚¤ ì €ì¥ ì‹¤íŒ¨");
    } finally {
      setSaving(false);
    }
  };

  const handleClearKey = () => {
    setApiKey('');
    setIsStored(false);
    onKeySet('');
  };

  if (loading) {
    return (
      <Card className="shadow-md">
        <CardContent className="py-8 flex items-center justify-center">
          <Loader2 className="h-6 w-6 animate-spin text-blue-600" />
          <span className="ml-2 text-sm text-zinc-600">API í‚¤ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
        </CardContent>
      </Card>
    );
  }

  if (isStored) {
    return (
      <Card className="shadow-md border-green-200 bg-green-50">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-black">
            <Key className="h-5 w-5 text-green-600" />
            Gemini API í‚¤ âœ“
          </CardTitle>
          <CardDescription className="text-zinc-600">
            ëŒ€ì‹œë³´ë“œì—ì„œ ì €ì¥í•œ API í‚¤ê°€ ìë™ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex items-center gap-2">
            <Input
              type={showKey ? 'text' : 'password'}
              value={apiKey}
              readOnly
              className="flex-1 bg-white"
            />
            <Button
              variant="outline"
              size="icon"
              onClick={() => setShowKey(!showKey)}
              className="border-green-600 text-green-600 hover:bg-green-100"
            >
              {showKey ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
            </Button>
            <Button
              variant="outline"
              onClick={handleClearKey}
              className="border-green-600 text-green-600 hover:bg-green-100"
            >
              ë³€ê²½
            </Button>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card className="shadow-md">
      <CardHeader>
        <CardTitle className="flex items-center gap-2 text-black">
          <Key className="h-5 w-5 text-blue-600" />
          Gemini API í‚¤ ì„¤ì •
        </CardTitle>
        <CardDescription className="text-zinc-600">
          AI ë³´ì¡° ìƒì„±ì„ ìœ„í•´ Gemini API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. ì…ë ¥í•˜ì§€ ì•Šë”ë¼ë„ ê¸°ë³¸ í…œí”Œë¦¿ìœ¼ë¡œ í¼ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          <a 
            href="https://aistudio.google.com/app/apikey" 
            target="_blank" 
            rel="noopener noreferrer"
            className="text-blue-600 hover:underline ml-1"
          >
            ì—¬ê¸°ì„œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </a>
        </CardDescription>
      </CardHeader>
      <CardContent>
        <div className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="gemini-key" className="text-gray-700 font-medium">API í‚¤</Label>
            <div className="flex items-center gap-2">
              <Input
                id="gemini-key"
                type={showKey ? 'text' : 'password'}
                placeholder="AIza..."
                value={apiKey}
                onChange={(e) => setApiKey(e.target.value)}
                className="flex-1"
              />
              <Button
                variant="outline"
                size="icon"
                onClick={() => setShowKey(!showKey)}
                className="border-black text-black hover:bg-zinc-100"
              >
                {showKey ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
              </Button>
            </div>
          </div>
          <Button
            onClick={handleSaveKey}
            disabled={!apiKey.trim() || saving}
            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 disabled:opacity-50"
          >
            {saving ? (
              <>
                <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                ì €ì¥ ì¤‘...
              </>
            ) : (
              "API í‚¤ ì €ì¥"
            )}
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}



================================================
FILE: src/components/login-button.tsx
================================================
"use client";
import { signIn } from "next-auth/react";

export default function LoginButton() {
  return (
    <button
      onClick={() => signIn("google", { callbackUrl: "/dashboard" })}
      className="inline-flex items-center rounded-full bg-black px-5 py-3 text-white transition-colors hover:bg-zinc-800 dark:bg-white dark:text-black dark:hover:bg-zinc-200"
    >
      Googleë¡œ ë¡œê·¸ì¸
    </button>
  );
}


================================================
FILE: src/components/Navbar.tsx
================================================
'use client';

import { useSession, signOut } from 'next-auth/react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { Button } from '@/components/ui/button';
import {
  Sheet,
  SheetContent,
  SheetHeader,
  SheetTitle,
  SheetTrigger,
} from '@/components/ui/sheet';
import {
  NavigationMenu,
  NavigationMenuContent,
  NavigationMenuItem,
  NavigationMenuList,
  NavigationMenuTrigger,
} from '@/components/ui/navigation-menu';
import { Menu, Sparkles, LayoutDashboard, LogOut, User, FileText } from 'lucide-react';
import { useState } from 'react';

export function Navbar() {
  const { data: session } = useSession();
  const pathname = usePathname();
  const [isOpen, setIsOpen] = useState(false);

  const isActive = (path: string) => pathname === path;

  const closeSheet = () => setIsOpen(false);

  return (
    <nav className="border-b-2 border-black bg-white sticky top-0 z-50">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between items-center h-16">
          {/* Logo */}
          <Link href="/" className="flex items-center">
            <h1 className="text-xl sm:text-2xl font-bold uppercase tracking-wide hover:text-gray-700 transition-colors">
              TeaBoard Forms
            </h1>
          </Link>

          {/* Desktop Navigation */}
          <div className="hidden md:flex items-center gap-4">
            {session?.user ? (
              <>
                <Link href="/dashboard">
                  <Button
                    variant={isActive('/dashboard') ? 'default' : 'outline'}
                    className="border-2 border-black rounded-none uppercase tracking-wide font-semibold"
                  >
                    <LayoutDashboard className="h-4 w-4 mr-2" />
                    ëŒ€ì‹œë³´ë“œ
                  </Button>
                </Link>

                <Link href="/create">
                  <Button
                    variant={isActive('/create') ? 'default' : 'outline'}
                    className="border-2 border-black rounded-none uppercase tracking-wide font-semibold"
                  >
                    <Sparkles className="h-4 w-4 mr-2" />
                    ìƒì„±í•˜ê¸°
                  </Button>
                </Link>

                <Link
                  href="https://pebble-stallion-abb.notion.site/2a010244f99780929827c7d2201f2d98"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <Button
                    variant="outline"
                    className="border-2 border-green-600 text-green-600 hover:bg-green-600 hover:text-white rounded-none uppercase tracking-wide font-semibold"
                  >
                    <FileText className="h-4 w-4 mr-2" />
                    í™œìš© ì‹ ì²­
                  </Button>
                </Link>

                {/* User Menu */}
                <NavigationMenu>
                  <NavigationMenuList>
                    <NavigationMenuItem>
                      <NavigationMenuTrigger className="border-2 border-black rounded-none uppercase tracking-wide font-semibold">
                        <User className="h-4 w-4 mr-2" />
                        {session.user.name?.split(' ')[0] || 'ì‚¬ìš©ì'}
                      </NavigationMenuTrigger>
                      <NavigationMenuContent>
                        <div className="w-48 p-2 space-y-2">
                          <div className="px-3 py-2 text-sm text-gray-600 border-b border-gray-200">
                            {session.user.email}
                          </div>
                          <Button
                            variant="ghost"
                            className="w-full justify-start rounded-none uppercase tracking-wide font-semibold"
                            onClick={() => signOut()}
                          >
                            <LogOut className="h-4 w-4 mr-2" />
                            ë¡œê·¸ì•„ì›ƒ
                          </Button>
                        </div>
                      </NavigationMenuContent>
                    </NavigationMenuItem>
                  </NavigationMenuList>
                </NavigationMenu>
              </>
            ) : (
              <>
                <Link href="/create">
                  <Button
                    variant="outline"
                    className="border-2 border-black rounded-none uppercase tracking-wide font-semibold"
                  >
                    <Sparkles className="h-4 w-4 mr-2" />
                    ìƒì„±í•˜ê¸°
                  </Button>
                </Link>

                <Link
                  href="https://pebble-stallion-abb.notion.site/2a010244f99780929827c7d2201f2d98"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <Button
                    variant="outline"
                    className="border-2 border-green-600 text-green-600 hover:bg-green-600 hover:text-white rounded-none uppercase tracking-wide font-semibold"
                  >
                    <FileText className="h-4 w-4 mr-2" />
                    í™œìš© ì‹ ì²­
                  </Button>
                </Link>
              </>
            )}
          </div>

          {/* Mobile Menu - Hamburger */}
          <div className="md:hidden">
            <Sheet open={isOpen} onOpenChange={setIsOpen}>
              <SheetTrigger asChild>
                <Button
                  variant="outline"
                  size="icon"
                  className="border-2 border-black rounded-none"
                >
                  <Menu className="h-6 w-6" />
                  <span className="sr-only">ë©”ë‰´ ì—´ê¸°</span>
                </Button>
              </SheetTrigger>
              <SheetContent
                side="right"
                className="w-[300px] sm:w-[400px] border-l-2 border-black rounded-none bg-white"
              >
                <SheetHeader className="border-b-2 border-black pb-4">
                  <SheetTitle className="text-left uppercase tracking-wide font-bold">
                    ë©”ë‰´
                  </SheetTitle>
                </SheetHeader>

                <div className="mt-6 space-y-4">
                  {session?.user ? (
                    <>
                      {/* User Info */}
                      <div className="px-3 py-3 border-2 border-black bg-gray-50">
                        <div className="flex items-center gap-2 mb-1">
                          <User className="h-4 w-4" />
                          <span className="font-semibold uppercase text-sm">
                            {session.user.name?.split(' ')[0] || 'ì‚¬ìš©ì'}
                          </span>
                        </div>
                        <div className="text-xs text-gray-600 pl-6">
                          {session.user.email}
                        </div>
                      </div>

                      {/* Menu Items */}
                      <Link href="/dashboard" onClick={closeSheet}>
                        <Button
                          variant={isActive('/dashboard') ? 'default' : 'outline'}
                          className="w-full justify-start border-2 border-black rounded-none uppercase tracking-wide font-semibold"
                        >
                          <LayoutDashboard className="h-4 w-4 mr-2" />
                          ëŒ€ì‹œë³´ë“œ
                        </Button>
                      </Link>

                      <Link href="/create" onClick={closeSheet}>
                        <Button
                          variant={isActive('/create') ? 'default' : 'outline'}
                          className="w-full justify-start border-2 border-black rounded-none uppercase tracking-wide font-semibold"
                        >
                          <Sparkles className="h-4 w-4 mr-2" />
                          ìƒì„±í•˜ê¸°
                        </Button>
                      </Link>

                      <Link
                        href="https://pebble-stallion-abb.notion.site/2a010244f99780929827c7d2201f2d98"
                        target="_blank"
                        rel="noopener noreferrer"
                        onClick={closeSheet}
                      >
                        <Button
                          variant="outline"
                          className="w-full justify-start border-2 border-green-600 text-green-600 hover:bg-green-600 hover:text-white rounded-none uppercase tracking-wide font-semibold"
                        >
                          <FileText className="h-4 w-4 mr-2" />
                          í™œìš© ì‹ ì²­
                        </Button>
                      </Link>

                      {/* Logout */}
                      <div className="pt-4 border-t-2 border-black">
                        <Button
                          variant="outline"
                          className="w-full justify-start border-2 border-red-600 text-red-600 hover:bg-red-600 hover:text-white rounded-none uppercase tracking-wide font-semibold"
                          onClick={() => {
                            closeSheet();
                            signOut();
                          }}
                        >
                          <LogOut className="h-4 w-4 mr-2" />
                          ë¡œê·¸ì•„ì›ƒ
                        </Button>
                      </div>
                    </>
                  ) : (
                    <>
                      <Link href="/create" onClick={closeSheet}>
                        <Button
                          variant="outline"
                          className="w-full justify-start border-2 border-black rounded-none uppercase tracking-wide font-semibold"
                        >
                          <Sparkles className="h-4 w-4 mr-2" />
                          ìƒì„±í•˜ê¸°
                        </Button>
                      </Link>

                      <Link
                        href="https://pebble-stallion-abb.notion.site/2a010244f99780929827c7d2201f2d98"
                        target="_blank"
                        rel="noopener noreferrer"
                        onClick={closeSheet}
                      >
                        <Button
                          variant="outline"
                          className="w-full justify-start border-2 border-green-600 text-green-600 hover:bg-green-600 hover:text-white rounded-none uppercase tracking-wide font-semibold"
                        >
                          <FileText className="h-4 w-4 mr-2" />
                          í™œìš© ì‹ ì²­
                        </Button>
                      </Link>
                    </>
                  )}
                </div>
              </SheetContent>
            </Sheet>
          </div>
        </div>
      </div>
    </nav>
  );
}



================================================
FILE: src/components/session-provider.tsx
================================================
"use client";
import { SessionProvider } from "next-auth/react";
import { ReactNode } from "react";

export default function SessionWrapper({ children }: { children: ReactNode }) {
  return <SessionProvider>{children}</SessionProvider>;
}


================================================
FILE: src/components/ui/button.tsx
================================================
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default:
          "bg-primary text-primary-foreground shadow hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",
        outline:
          "border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2",
        sm: "h-8 rounded-md px-3 text-xs",
        lg: "h-10 rounded-md px-8",
        icon: "h-9 w-9",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }



================================================
FILE: src/components/ui/card.tsx
================================================
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-xl border-[1.5px] border-black bg-white text-black shadow-sm dark:border-black dark:bg-white dark:text-black",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("font-semibold leading-none tracking-tight", className)}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }



================================================
FILE: src/components/ui/checkbox.tsx
================================================
"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("grid place-content-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }



================================================
FILE: src/components/ui/input.tsx
================================================
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-9 w-full rounded-md border border-black bg-white px-3 py-1 text-base text-black shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-black placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-black disabled:cursor-not-allowed disabled:opacity-50 md:text-sm dark:border-black dark:bg-white dark:text-black",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }



================================================
FILE: src/components/ui/label.tsx
================================================
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }



================================================
FILE: src/components/ui/navigation-menu.tsx
================================================
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}



================================================
FILE: src/components/ui/select.tsx
================================================
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-black bg-white px-3 py-2 text-sm text-black shadow-sm ring-offset-background data-[placeholder]:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-black disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:border-black dark:bg-white dark:text-black",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border border-black bg-white text-black shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin] dark:border-black dark:bg-white dark:text-black",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("px-2 py-1.5 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm text-black outline-none focus:bg-zinc-100 focus:text-black data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:text-black",
      className
    )}
    {...props}
  >
    <span className="absolute right-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>
    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}



================================================
FILE: src/components/ui/sheet.tsx
================================================
"use client"

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {}

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
      {children}
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet,
  SheetPortal,
  SheetOverlay,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}



================================================
FILE: src/components/ui/tabs.tsx
================================================
"use client"

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }



================================================
FILE: src/components/ui/textarea.tsx
================================================
import * as React from "react"

import { cn } from "@/lib/utils"

const Textarea = React.forwardRef<
  HTMLTextAreaElement,
  React.ComponentProps<"textarea">
>(({ className, ...props }, ref) => {
  return (
    <textarea
      className={cn(
        "flex min-h-[60px] w-full rounded-md border border-black bg-white px-3 py-2 text-base text-black shadow-sm placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-black disabled:cursor-not-allowed disabled:opacity-50 md:text-sm dark:border-black dark:bg-white dark:text-black",
        className
      )}
      ref={ref}
      {...props}
    />
  )
})
Textarea.displayName = "Textarea"

export { Textarea }



================================================
FILE: src/lib/auth.ts
================================================
import type { NextAuthOptions } from "next-auth";
import Google from "next-auth/providers/google";
import { upsertGoogleTokens, getGoogleTokens } from "@/lib/google-tokens";

async function refreshGoogleAccessToken(refreshToken: string) {
  const clientId = process.env.GOOGLE_CLIENT_ID;
  const clientSecret = process.env.GOOGLE_CLIENT_SECRET;

  if (!clientId || !clientSecret) {
    throw new Error("Google OAuth client credentials are not configured");
  }

  const result = await fetch("https://oauth2.googleapis.com/token", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams({
      client_id: clientId,
      client_secret: clientSecret,
      grant_type: "refresh_token",
      refresh_token: refreshToken,
    }),
  });

  if (!result.ok) {
    const body = await result.text();
    throw new Error(`Failed to refresh Google access token: ${body}`);
  }

  const payload = (await result.json()) as {
    access_token: string;
    expires_in: number;
    refresh_token?: string;
  };

  return {
    accessToken: payload.access_token,
    expiresAt: Date.now() + (payload.expires_in ?? 0) * 1000,
    refreshToken: payload.refresh_token ?? refreshToken,
  };
}

export const authOptions: NextAuthOptions = {
  providers: [
    Google({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
      authorization: {
        params: {
          scope: "openid email profile https://www.googleapis.com/auth/forms.body https://www.googleapis.com/auth/drive.file",
          prompt: "consent", // í•­ìƒ ë™ì˜ í™”ë©´ í‘œì‹œí•˜ì—¬ refresh_token í™•ë³´
          access_type: "offline", // ì˜¤í”„ë¼ì¸ ì•¡ì„¸ìŠ¤ë¡œ refresh_token ìš”ì²­
          response_type: "code", // authorization code flow ëª…ì‹œ
        },
      },
    }),
  ],
  session: { strategy: "jwt" },
  callbacks: {
    async signIn({ user, account }) {
      if (user?.email && account?.provider === "google") {
        await upsertGoogleTokens(user.email, {
          accessToken: account.access_token ?? undefined,
          refreshToken: account.refresh_token ?? undefined,
          expiresAt: account.expires_at ? account.expires_at * 1000 : undefined,
        });
      }
      return true;
    },
    async redirect({ url, baseUrl }) {
      if (url.startsWith("/")) return `${baseUrl}${url}`;
      if (new URL(url).origin === baseUrl) return url;
      return baseUrl;
    },
    async session({ session, token }) {
      if (token.accessToken) {
        session.accessToken = token.accessToken as string;
      }
      if (token.accessTokenExpires) {
        session.accessTokenExpires = token.accessTokenExpires as number;
      }
      if (token.error) {
        session.error = token.error as string;
      }
      return session;
    },
    async jwt({ token, account, user }) {
      if (user?.email && !token.email) {
        token.email = user.email;
      }

      if (account?.provider === "google") {
        token.accessToken = account.access_token ?? token.accessToken;
        token.refreshToken = account.refresh_token ?? token.refreshToken;
        token.accessTokenExpires = account.expires_at
          ? account.expires_at * 1000
          : Date.now() + 3600 * 1000;

        if (!token.refreshToken && user?.email) {
          const saved = await getGoogleTokens(user.email);
          if (saved?.refreshToken) {
            token.refreshToken = saved.refreshToken;
          }
        }

        if (user?.email) {
          await upsertGoogleTokens(user.email, {
            accessToken: token.accessToken as string | undefined,
            refreshToken: token.refreshToken as string | undefined,
            expiresAt: token.accessTokenExpires as number | undefined,
          });
        }

        return token;
      }

      if (!token.refreshToken && token.email) {
        const saved = await getGoogleTokens(token.email);
        if (saved?.refreshToken) {
          token.refreshToken = saved.refreshToken;
        }
      }

      if (
        token.accessToken &&
        token.accessTokenExpires &&
        Date.now() < token.accessTokenExpires - 60_000
      ) {
        return token;
      }

      if (!token.refreshToken) {
        token.error = "MissingRefreshToken";
        return token;
      }

      try {
        const refreshed = await refreshGoogleAccessToken(
          token.refreshToken as string,
        );
        token.accessToken = refreshed.accessToken;
        token.accessTokenExpires = refreshed.expiresAt;
        token.refreshToken = refreshed.refreshToken ?? token.refreshToken;

        if (token.email) {
          await upsertGoogleTokens(token.email, {
            accessToken: token.accessToken as string | undefined,
            refreshToken: token.refreshToken as string | undefined,
            expiresAt: token.accessTokenExpires as number | undefined,
          });
        }
      } catch (error: unknown) {
        token.error = error instanceof Error ? error.message : "RefreshAccessTokenError";
      }

      return token;
    },
  },
};



================================================
FILE: src/lib/crypto.ts
================================================
import { createCipheriv, createDecipheriv, randomBytes, createHash } from "crypto";

function getKey(): Buffer {
  const secret = process.env.BYOK_ENCRYPTION_KEY || "";
  if (!secret) throw new Error("BYOK_ENCRYPTION_KEY is not set");
  // Derive a 32-byte key from provided secret string
  return createHash("sha256").update(secret).digest();
}

export function encryptBYOK(plain: string) {
  const iv = randomBytes(12);
  const key = getKey();
  const cipher = createCipheriv("aes-256-gcm", key, iv);
  const enc = Buffer.concat([cipher.update(Buffer.from(plain, "utf8")), cipher.final()]);
  const tag = cipher.getAuthTag();
  return {
    iv: iv.toString("base64"),
    ciphertext: enc.toString("base64"),
    tag: tag.toString("base64"),
  };
}

export function decryptBYOK(payload: { iv: string; ciphertext: string; tag: string }) {
  const key = getKey();
  const iv = Buffer.from(payload.iv, "base64");
  const tag = Buffer.from(payload.tag, "base64");
  const enc = Buffer.from(payload.ciphertext, "base64");
  const decipher = createDecipheriv("aes-256-gcm", key, iv);
  decipher.setAuthTag(tag);
  const dec = Buffer.concat([decipher.update(enc), decipher.final()]);
  return dec.toString("utf8");
}


================================================
FILE: src/lib/firebase-admin.ts
================================================
import { cert, getApp, getApps, initializeApp } from "firebase-admin/app";
import { getFirestore } from "firebase-admin/firestore";
import { getAuth } from "firebase-admin/auth";

const projectId = process.env.FIREBASE_ADMIN_PROJECT_ID;
const clientEmail = process.env.FIREBASE_ADMIN_CLIENT_EMAIL;
const privateKey = process.env.FIREBASE_ADMIN_PRIVATE_KEY?.replace(/\\n/g, "\n");

function ensureApp() {
  if (!projectId || !clientEmail || !privateKey) {
    const missing = [];
    if (!projectId) missing.push("FIREBASE_ADMIN_PROJECT_ID");
    if (!clientEmail) missing.push("FIREBASE_ADMIN_CLIENT_EMAIL");
    if (!privateKey) missing.push("FIREBASE_ADMIN_PRIVATE_KEY");
    throw new Error(`Firebase Admin credentials are not configured. Missing: ${missing.join(", ")}`);
  }
  return getApps().length ? getApp() : initializeApp({ credential: cert({ projectId, clientEmail, privateKey }) });
}

export function getAdminDb() {
  const app = ensureApp();
  return getFirestore(app);
}

export function getAdminAuth() {
  const app = ensureApp();
  return getAuth(app);
}


================================================
FILE: src/lib/firebase-client.ts
================================================
import { initializeApp, getApps, getApp } from "firebase/app";
import { getAuth } from "firebase/auth";
import { getFirestore } from "firebase/firestore";

const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY!,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN!,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID!,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET!,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID!,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID!,
  measurementId: process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID!,
};

export const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
export const firebaseAuth = getAuth(app);
export const db = getFirestore(app);


================================================
FILE: src/lib/form-spec.ts
================================================
import type { forms_v1 } from "googleapis";

export type FormItemType =
  | "multiple_choice"
  | "checkbox"
  | "dropdown"
  | "short_answer"
  | "paragraph"
  | "linear_scale";

export interface FormItem {
  type: FormItemType;
  title: string;
  description?: string;
  required?: boolean;
  options?: string[];
  shuffleOptions?: boolean;
  scaleSettings?: {
    low: number;
    high: number;
    lowLabel?: string;
    highLabel?: string;
  };
  grading?: {
    pointValue?: number;
    correctAnswers?: string[];
    expectedAnswer?: string;
    explanation?: string;
  };
}

export interface FormSpec {
  title: string;
  description?: string;
  isQuiz?: boolean;
  items: FormItem[];
}

function buildGrading(
  isQuiz: boolean,
  item: FormItem,
): forms_v1.Schema$Grading | undefined {
  if (!isQuiz || !item.grading) return undefined;

  const grading: forms_v1.Schema$Grading = {};
  if (typeof item.grading.pointValue === "number") {
    grading.pointValue = item.grading.pointValue;
  }

  const answers: forms_v1.Schema$CorrectAnswer[] = [];
  if (item.grading.correctAnswers?.length) {
    for (const answer of item.grading.correctAnswers) {
      answers.push({ value: answer });
    }
  }
  if (item.grading.expectedAnswer) {
    answers.push({ value: item.grading.expectedAnswer });
  }
  if (answers.length) {
    grading.correctAnswers = { answers };
  }

  // í•´ì„¤(explanation)ì´ ìˆìœ¼ë©´ í”¼ë“œë°± ì¶”ê°€
  if (item.grading.explanation) {
    if (item.type === "multiple_choice") {
      // ê°ê´€ì‹: whenRight/whenWrong í”¼ë“œë°±
      grading.whenRight = {
        text: `âœ… ì •ë‹µì…ë‹ˆë‹¤!\n\n${item.grading.explanation}`,
      };
      grading.whenWrong = {
        text: `âŒ í‹€ë ¸ìŠµë‹ˆë‹¤.\n\n${item.grading.explanation}`,
      };
    } else if (item.type === "short_answer" || item.type === "paragraph") {
      // ë‹¨ë‹µí˜•/ì„œìˆ í˜•: generalFeedbackë§Œ ì§€ì›
      grading.generalFeedback = {
        text: `ì •ë‹µ: ${item.grading.expectedAnswer}\n\n[í•´ì„¤]\n${item.grading.explanation}`,
      };
    }
  }

  return grading;
}

function buildQuestionItem(
  spec: FormSpec,
  item: FormItem,
): forms_v1.Schema$Item | null {
  const grading = buildGrading(Boolean(spec.isQuiz), item);
  const baseQuestion: forms_v1.Schema$Question = {
    required: item.required ?? false,
    grading,
  };

  if (item.type === "multiple_choice" || item.type === "checkbox") {
    if (!item.options?.length) return null;
    baseQuestion.choiceQuestion = {
      options: item.options.map((value) => ({ value })),
      shuffle: Boolean(item.shuffleOptions),
      type: item.type === "checkbox" ? "CHECKBOX" : "RADIO",
    };
  } else if (item.type === "dropdown") {
    if (!item.options?.length) return null;
    baseQuestion.choiceQuestion = {
      options: item.options.map((value) => ({ value })),
      shuffle: Boolean(item.shuffleOptions),
      type: "DROP_DOWN",
    };
  } else if (item.type === "short_answer" || item.type === "paragraph") {
    baseQuestion.textQuestion = {
      paragraph: item.type === "paragraph",
    };
  } else if (item.type === "linear_scale") {
    if (!item.scaleSettings) return null;
    baseQuestion.scaleQuestion = {
      low: item.scaleSettings.low,
      high: item.scaleSettings.high,
      lowLabel: item.scaleSettings.lowLabel,
      highLabel: item.scaleSettings.highLabel,
    };
  } else {
    return null;
  }

  return {
    title: item.title,
    description: item.description,
    questionItem: {
      question: baseQuestion,
    },
  };
}

export function buildBatchUpdateRequestsFromSpec(
  spec: FormSpec,
): forms_v1.Schema$Request[] {
  const requests: forms_v1.Schema$Request[] = [];

  if (spec.isQuiz) {
    requests.push({
      updateSettings: {
        settings: {
          quizSettings: { isQuiz: true },
        },
        updateMask: "quizSettings.isQuiz",
      },
    });
  }

  if (spec.description) {
    requests.push({
      updateFormInfo: {
        info: { description: spec.description },
        updateMask: "description",
      },
    });
  }

  spec.items.forEach((item, index) => {
    const questionItem = buildQuestionItem(spec, item);
    if (!questionItem) return;

    requests.push({
      createItem: {
        item: questionItem,
        location: { index },
      },
    });
  });

  return requests;
}



================================================
FILE: src/lib/google-forms-api.ts
================================================
/**
 * Google Forms API Utility
 *
 * 2026ë…„ 3ì›” 31ì¼ë¶€í„° Forms APIë¡œ ìƒì„±ëœ í¼ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë¹„ê³µê°œ ìƒíƒœì…ë‹ˆë‹¤.
 * ì´ ìœ í‹¸ë¦¬í‹°ëŠ” í¼ì„ ìƒì„±í•œ í›„ ìë™ìœ¼ë¡œ ë°œí–‰(publish) ì²˜ë¦¬í•©ë‹ˆë‹¤.
 *
 * @see https://developers.google.com/forms/api/guides/publishing
 */

import { google } from 'googleapis';
import type { forms_v1 } from 'googleapis';

type OAuth2Client = InstanceType<typeof google.auth.OAuth2>;

/**
 * Google Formsë¥¼ ë°œí–‰(publish) ìƒíƒœë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
 * 2026ë…„ 3ì›” 31ì¼ ì´í›„ í•„ìˆ˜ì ìœ¼ë¡œ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.
 *
 * @param formId - ë°œí–‰í•  Google Forms ID
 * @param oauth2Client - Google OAuth2 í´ë¼ì´ì–¸íŠ¸
 * @throws {Error} ë°œí–‰ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë°œìƒ
 */
export async function publishForm(
  formId: string,
  oauth2Client: OAuth2Client
): Promise<void> {
  const forms = google.forms({ version: 'v1', auth: oauth2Client });

  try {
    await forms.forms.setPublishSettings({
      formId: formId,
      requestBody: {
        publishSettings: {
          publishState: {
            isPublished: true,
            isAcceptingResponses: true,
          }
        }
      }
    });

    console.log(`âœ… Form ${formId} successfully published`);
  } catch (error) {
    const errorMessage = error instanceof Error ? error.message : 'Unknown error';
    console.error(`âŒ Failed to publish form ${formId}:`, error);
    throw new Error(`Form publishing failed: ${errorMessage}`);
  }
}

/**
 * Google Formsë¥¼ ìƒì„±í•˜ê³  ì¦‰ì‹œ ë°œí–‰(publish) ì²˜ë¦¬í•©ë‹ˆë‹¤.
 * 2026ë…„ 3ì›” 31ì¼ ì´í›„ë¥¼ ëŒ€ë¹„í•œ í†µí•© í•¨ìˆ˜ì…ë‹ˆë‹¤.
 *
 * @param formSpec - Google Forms API ìš”ì²­ ìŠ¤í™
 * @param oauth2Client - Google OAuth2 í´ë¼ì´ì–¸íŠ¸
 * @returns ìƒì„±ëœ í¼ì˜ ID
 * @throws {Error} ìƒì„± ë˜ëŠ” ë°œí–‰ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë°œìƒ
 */
export async function createAndPublishForm(
  formSpec: { info: { title: string; documentTitle: string } },
  oauth2Client: OAuth2Client
): Promise<string> {
  const forms = google.forms({ version: 'v1', auth: oauth2Client });

  try {
    // 1ë‹¨ê³„: í¼ ìƒì„±
    console.log('ğŸ“ Creating Google Form...');
    const createResponse = await forms.forms.create({
      requestBody: formSpec
    });

    const formId = createResponse.data.formId;
    if (!formId) {
      throw new Error('Form ID not returned from API');
    }

    console.log(`âœ… Form created with ID: ${formId}`);

    // 2ë‹¨ê³„: í¼ ë°œí–‰ (2026.3.31+ í•„ìˆ˜)
    console.log(`ğŸ“¤ Publishing form ${formId}...`);
    await publishForm(formId, oauth2Client);

    return formId;

  } catch (error) {
    const errorMessage = error instanceof Error ? error.message : 'Unknown error';
    console.error('âŒ Form creation or publishing failed:', error);
    throw new Error(`Failed to create and publish form: ${errorMessage}`);
  }
}

/**
 * ê¸°ì¡´ í¼ì„ ë°°ì¹˜ ì—…ë°ì´íŠ¸í•˜ê³  ë°œí–‰ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
 *
 * @param formId - ì—…ë°ì´íŠ¸í•  í¼ ID
 * @param updates - ë°°ì¹˜ ì—…ë°ì´íŠ¸ ìš”ì²­ ë°°ì—´
 * @param oauth2Client - Google OAuth2 í´ë¼ì´ì–¸íŠ¸
 * @returns ì—…ë°ì´íŠ¸ëœ í¼ ì •ë³´
 */
export async function updateAndEnsurePublished(
  formId: string,
  updates: forms_v1.Schema$Request[],
  oauth2Client: OAuth2Client
): Promise<Record<string, unknown>> {
  const forms = google.forms({ version: 'v1', auth: oauth2Client });

  try {
    // ë°°ì¹˜ ì—…ë°ì´íŠ¸ ì‹¤í–‰
    console.log(`ğŸ”„ Updating form ${formId}...`);
    const updateResponse = await forms.forms.batchUpdate({
      formId: formId,
      requestBody: {
        requests: updates,
      }
    });

    console.log(`âœ… Form ${formId} updated successfully`);

    // ë°œí–‰ ìƒíƒœ ì¬í™•ì¸ (ì•ˆì „ì¥ì¹˜)
    await publishForm(formId, oauth2Client);

    return updateResponse.data as Record<string, unknown>;

  } catch (error) {
    const errorMessage = error instanceof Error ? error.message : 'Unknown error';
    console.error(`âŒ Failed to update form ${formId}:`, error);
    throw new Error(`Form update failed: ${errorMessage}`);
  }
}



================================================
FILE: src/lib/google-forms.ts
================================================
[Binary file]


================================================
FILE: src/lib/google-tokens.ts
================================================
import { getAdminDb } from "@/lib/firebase-admin";

type TokenPayload = {
  accessToken?: string | null;
  refreshToken?: string | null;
  expiresAt?: number | null;
};

type StoredTokens = {
  accessToken?: string;
  refreshToken?: string;
  expiresAt?: number;
};

function sanitizePayload(payload: TokenPayload) {
  const data: Record<string, unknown> = {
    updatedAt: Date.now(),
  };
  // accessTokenê³¼ expiresAtì€ í•­ìƒ ì—…ë°ì´íŠ¸ (null/undefinedë¼ë„)
  if (payload.accessToken !== undefined) data.accessToken = payload.accessToken;
  if (payload.expiresAt !== undefined) data.expiresAt = payload.expiresAt;

  // refreshTokenì€ ìƒˆ ê°’ì´ ìˆì„ ë•Œë§Œ ì—…ë°ì´íŠ¸ (ê¸°ì¡´ ê°’ ë³´ì¡´)
  if (payload.refreshToken) data.refreshToken = payload.refreshToken;

  return data;
}

export async function upsertGoogleTokens(email: string, payload: TokenPayload) {
  try {
    const adminDb = getAdminDb();
    const docRef = adminDb
      .collection("users")
      .doc(email)
      .collection("auth")
      .doc("google");
    await docRef.set(sanitizePayload(payload), { merge: true });
  } catch (error) {
    console.warn(
      "[google-tokens] Failed to upsert Google tokens for user.",
      (error as Error)?.message ?? error,
    );
  }
}

export async function getGoogleTokens(
  email: string,
): Promise<StoredTokens | null> {
  try {
    const adminDb = getAdminDb();
    const docSnap = await adminDb
      .collection("users")
      .doc(email)
      .collection("auth")
      .doc("google")
      .get();
    if (!docSnap.exists) return null;
    return docSnap.data() as StoredTokens;
  } catch (error) {
    console.warn(
      "[google-tokens] Failed to read Google tokens for user.",
      (error as Error)?.message ?? error,
    );
    return null;
  }
}



================================================
FILE: src/lib/utils.ts
================================================
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}



================================================
FILE: src/types/next-auth.d.ts
================================================
import { DefaultSession } from "next-auth";

declare module "next-auth" {
  interface Session extends DefaultSession {
    user: {
      name?: string | null;
      email?: string | null;
      image?: string | null;
    };
    accessToken?: string;
    accessTokenExpires?: number;
    error?: string;
  }
}

declare module "next-auth/jwt" {
  interface JWT {
    accessToken?: string;
    refreshToken?: string;
    accessTokenExpires?: number;
    email?: string;
    error?: string;
  }
}


